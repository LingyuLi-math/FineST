<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LRI and CCC discovery in super-resolved NPC data &mdash; FineST 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="FineST in CRC Visium HD data" href="CRC16_Train_Impute.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            FineST
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Main</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="StarDist_demo.html">Nuclei segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="HIPT_demo.html">Geometric segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="release.html">Release History</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Between_spot_demo.html">Interpolate between-spots</a></li>
<li class="toctree-l1"><a class="reference internal" href="Crop_ROI_image.html">Crop image of ROI</a></li>
<li class="toctree-l1"><a class="reference internal" href="NPC_Train_Impute.html">FineST in NPC Visium data</a></li>
<li class="toctree-l1"><a class="reference internal" href="CRC16_Train_Impute.html">FineST in CRC Visium HD data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">LRI and CCC discovery in super-resolved NPC data</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">FineST</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">LRI and CCC discovery in super-resolved NPC data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/NPC_LRI_CCC.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="LRI-and-CCC-discovery-in-super-resolved-NPC-data">
<h1>LRI and CCC discovery in super-resolved NPC data<a class="headerlink" href="#LRI-and-CCC-discovery-in-super-resolved-NPC-data" title="Permalink to this heading"></a></h1>
<section id="Main-functions">
<h2>Main functions<a class="headerlink" href="#Main-functions" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Function 1: SpatialDM: identify spatially co-expressed ligand-receptor interaction</p></li>
<li><p>Function 2: SpatialDE: get spatial clustering of local spots, if spot number &lt; 5000</p></li>
<li><p>Function 3: SparseAEH: get spatial clustering of local sub-spots or single-cells (large samples)</p></li>
<li><p>Function 4: Pathway enrichment analysis based on the database <a class="reference external" href="https://github.com/sqjin/CellChat/tree/master/data">CellChatDB (version.1.1.3)</a>)</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">spatialdm</span> <span class="k">as</span> <span class="nn">sdm</span>
<span class="kn">from</span> <span class="nn">spatialdm.datasets</span> <span class="kn">import</span> <span class="n">dataset</span>
<span class="kn">import</span> <span class="nn">spatialdm.plottings</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SpatailDM version: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="k">sdm</span>.__version__)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/mnt/lingyu/nfs_share2/env/envs/FineST/lib/python3.8/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;
(function(root) {
  function now() {
    return new Date();
  }

  var force = true;
  var py_version = '3.1.1'.replace('rc', '-rc.').replace('.dev', '-dev.');
  var is_dev = py_version.indexOf("+") !== -1 || py_version.indexOf("-") !== -1;
  var reloading = false;
  var Bokeh = root.Bokeh;
  var bokeh_loaded = Bokeh != null && (Bokeh.version === py_version || (Bokeh.versions !== undefined && Bokeh.versions.has(py_version)));

  if (typeof (root._bokeh_timeout) === "undefined" || force) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks;
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, js_modules, js_exports, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];
    if (js_modules == null) js_modules = [];
    if (js_exports == null) js_exports = {};

    root._bokeh_onload_callbacks.push(callback);

    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls.length === 0 && js_modules.length === 0 && Object.keys(js_exports).length === 0) {
      run_callbacks();
      return null;
    }
    if (!reloading) {
      console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    }

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }
    window._bokeh_on_load = on_load

    function on_error() {
      console.error("failed to load " + url);
    }

    var skip = [];
    if (window.requirejs) {
      window.requirejs.config({'packages': {}, 'paths': {'jspanel': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/jspanel', 'jspanel-modal': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/modal/jspanel.modal', 'jspanel-tooltip': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/tooltip/jspanel.tooltip', 'jspanel-hint': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/hint/jspanel.hint', 'jspanel-layout': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/layout/jspanel.layout', 'jspanel-contextmenu': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/contextmenu/jspanel.contextmenu', 'jspanel-dock': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/dock/jspanel.dock', 'gridstack': 'https://cdn.jsdelivr.net/npm/gridstack@7.2.3/dist/gridstack-all', 'notyf': 'https://cdn.jsdelivr.net/npm/notyf@3/notyf.min'}, 'shim': {'jspanel': {'exports': 'jsPanel'}, 'gridstack': {'exports': 'GridStack'}}});
      require(["jspanel"], function(jsPanel) {
    window.jsPanel = jsPanel
    on_load()
      })
      require(["jspanel-modal"], function() {
    on_load()
      })
      require(["jspanel-tooltip"], function() {
    on_load()
      })
      require(["jspanel-hint"], function() {
    on_load()
      })
      require(["jspanel-layout"], function() {
    on_load()
      })
      require(["jspanel-contextmenu"], function() {
    on_load()
      })
      require(["jspanel-dock"], function() {
    on_load()
      })
      require(["gridstack"], function(GridStack) {
    window.GridStack = GridStack
    on_load()
      })
      require(["notyf"], function() {
    on_load()
      })
      root._bokeh_is_loading = css_urls.length + 9;
    } else {
      root._bokeh_is_loading = css_urls.length + js_urls.length + js_modules.length + Object.keys(js_exports).length;
    }

    var existing_stylesheets = []
    var links = document.getElementsByTagName('link')
    for (var i = 0; i < links.length; i++) {
      var link = links[i]
      if (link.href != null) {
    existing_stylesheets.push(link.href)
      }
    }
    for (var i = 0; i < css_urls.length; i++) {
      var url = css_urls[i];
      if (existing_stylesheets.indexOf(url) !== -1) {
    on_load()
    continue;
      }
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error;
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }    if (((window['jsPanel'] !== undefined) && (!(window['jsPanel'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/jspanel.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/modal/jspanel.modal.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/tooltip/jspanel.tooltip.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/hint/jspanel.hint.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/layout/jspanel.layout.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/contextmenu/jspanel.contextmenu.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/dock/jspanel.dock.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    if (((window['GridStack'] !== undefined) && (!(window['GridStack'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/1.2.3/dist/bundled/gridstack/gridstack@7.2.3/dist/gridstack-all.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    if (((window['Notyf'] !== undefined) && (!(window['Notyf'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/1.2.3/dist/bundled/notificationarea/notyf@3/notyf.min.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    var existing_scripts = []
    var scripts = document.getElementsByTagName('script')
    for (var i = 0; i < scripts.length; i++) {
      var script = scripts[i]
      if (script.src != null) {
    existing_scripts.push(script.src)
      }
    }
    for (var i = 0; i < js_urls.length; i++) {
      var url = js_urls[i];
      if (skip.indexOf(url) !== -1 || existing_scripts.indexOf(url) !== -1) {
    if (!window.requirejs) {
      on_load();
    }
    continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (var i = 0; i < js_modules.length; i++) {
      var url = js_modules[i];
      if (skip.indexOf(url) !== -1 || existing_scripts.indexOf(url) !== -1) {
    if (!window.requirejs) {
      on_load();
    }
    continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (const name in js_exports) {
      var url = js_exports[name];
      if (skip.indexOf(url) >= 0 || root[name] != null) {
    if (!window.requirejs) {
      on_load();
    }
    continue;
      }
      var element = document.createElement('script');
      element.onerror = on_error;
      element.async = false;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      element.textContent = `
      import ${name} from "${url}"
      window.${name} = ${name}
      window._bokeh_on_load()
      `
      document.head.appendChild(element);
    }
    if (!js_urls.length && !js_modules.length) {
      on_load()
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  var js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-3.1.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.1.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.1.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.1.1.min.js", "https://cdn.holoviz.org/panel/1.2.3/dist/panel.min.js"];
  var js_modules = [];
  var js_exports = {};
  var css_urls = [];
  var inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {} // ensure no trailing comma for IE
  ];

  function run_inline_js() {
    if ((root.Bokeh !== undefined) || (force === true)) {
      for (var i = 0; i < inline_js.length; i++) {
        inline_js[i].call(root, root.Bokeh);
      }
      // Cache old bokeh versions
      if (Bokeh != undefined && !reloading) {
    var NewBokeh = root.Bokeh;
    if (Bokeh.versions === undefined) {
      Bokeh.versions = new Map();
    }
    if (NewBokeh.version !== Bokeh.version) {
      Bokeh.versions.set(NewBokeh.version, NewBokeh)
    }
    root.Bokeh = Bokeh;
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    }
    root._bokeh_is_initializing = false
  }

  function load_or_wait() {
    // Implement a backoff loop that tries to ensure we do not load multiple
    // versions of Bokeh and its dependencies at the same time.
    // In recent versions we use the root._bokeh_is_initializing flag
    // to determine whether there is an ongoing attempt to initialize
    // bokeh, however for backward compatibility we also try to ensure
    // that we do not start loading a newer (Panel>=1.0 and Bokeh>3) version
    // before older versions are fully initialized.
    if (root._bokeh_is_initializing && Date.now() > root._bokeh_timeout) {
      root._bokeh_is_initializing = false;
      root._bokeh_onload_callbacks = undefined;
      console.log("Bokeh: BokehJS was loaded multiple times but one version failed to initialize.");
      load_or_wait();
    } else if (root._bokeh_is_initializing || (typeof root._bokeh_is_initializing === "undefined" && root._bokeh_onload_callbacks !== undefined)) {
      setTimeout(load_or_wait, 100);
    } else {
      Bokeh = root.Bokeh;
      bokeh_loaded = Bokeh != null && (Bokeh.version === py_version || (Bokeh.versions !== undefined && Bokeh.versions.has(py_version)));
      root._bokeh_is_initializing = true
      root._bokeh_onload_callbacks = []
      if (!reloading && (!bokeh_loaded || is_dev)) {
    root.Bokeh = undefined;
      }
      load_libs(css_urls, js_urls, js_modules, js_exports, function() {
    console.debug("Bokeh: BokehJS plotting callback run at", now());
    run_inline_js();
      });
    }
  }
  // Give older versions of the autoload script a head-start to ensure
  // they initialize before we start loading newer version.
  setTimeout(load_or_wait, 100)
}(window));
</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

if ((window.PyViz === undefined) || (window.PyViz instanceof HTMLElement)) {
  window.PyViz = {comms: {}, comm_status:{}, kernels:{}, receivers: {}, plot_index: []}
}


    function JupyterCommManager() {
    }

    JupyterCommManager.prototype.register_target = function(plot_id, comm_id, msg_handler) {
      if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        comm_manager.register_target(comm_id, function(comm) {
          comm.on_msg(msg_handler);
        });
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        window.PyViz.kernels[plot_id].registerCommTarget(comm_id, function(comm) {
          comm.onMsg = msg_handler;
        });
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        google.colab.kernel.comms.registerTarget(comm_id, (comm) => {
          var messages = comm.messages[Symbol.asyncIterator]();
          function processIteratorResult(result) {
            var message = result.value;
            console.log(message)
            var content = {data: message.data, comm_id};
            var buffers = []
            for (var buffer of message.buffers || []) {
              buffers.push(new DataView(buffer))
            }
            var metadata = message.metadata || {};
            var msg = {content, buffers, metadata}
            msg_handler(msg);
            return messages.next().then(processIteratorResult);
          }
          return messages.next().then(processIteratorResult);
        })
      }
    }

    JupyterCommManager.prototype.get_client_comm = function(plot_id, comm_id, msg_handler) {
      if (comm_id in window.PyViz.comms) {
        return window.PyViz.comms[comm_id];
      } else if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        var comm = comm_manager.new_comm(comm_id, {}, {}, {}, comm_id);
        if (msg_handler) {
          comm.on_msg(msg_handler);
        }
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        var comm = window.PyViz.kernels[plot_id].connectToComm(comm_id);
        comm.open();
        if (msg_handler) {
          comm.onMsg = msg_handler;
        }
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        var comm_promise = google.colab.kernel.comms.open(comm_id)
        comm_promise.then((comm) => {
          window.PyViz.comms[comm_id] = comm;
          if (msg_handler) {
            var messages = comm.messages[Symbol.asyncIterator]();
            function processIteratorResult(result) {
              var message = result.value;
              var content = {data: message.data};
              var metadata = message.metadata || {comm_id};
              var msg = {content, metadata}
              msg_handler(msg);
              return messages.next().then(processIteratorResult);
            }
            return messages.next().then(processIteratorResult);
          }
        })
        var sendClosure = (data, metadata, buffers, disposeOnDone) => {
          return comm_promise.then((comm) => {
            comm.send(data, metadata, buffers, disposeOnDone);
          });
        };
        var comm = {
          send: sendClosure
        };
      }
      window.PyViz.comms[comm_id] = comm;
      return comm;
    }
    window.PyViz.comm_manager = new JupyterCommManager();



var JS_MIME_TYPE = 'application/javascript';
var HTML_MIME_TYPE = 'text/html';
var EXEC_MIME_TYPE = 'application/vnd.holoviews_exec.v0+json';
var CLASS_NAME = 'output';

/**
 * Render data to the DOM node
 */
function render(props, node) {
  var div = document.createElement("div");
  var script = document.createElement("script");
  node.appendChild(div);
  node.appendChild(script);
}

/**
 * Handle when a new output is added
 */
function handle_add_output(event, handle) {
  var output_area = handle.output_area;
  var output = handle.output;
  if ((output.data == undefined) || (!output.data.hasOwnProperty(EXEC_MIME_TYPE))) {
    return
  }
  var id = output.metadata[EXEC_MIME_TYPE]["id"];
  var toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);
  if (id !== undefined) {
    var nchildren = toinsert.length;
    var html_node = toinsert[nchildren-1].children[0];
    html_node.innerHTML = output.data[HTML_MIME_TYPE];
    var scripts = [];
    var nodelist = html_node.querySelectorAll("script");
    for (var i in nodelist) {
      if (nodelist.hasOwnProperty(i)) {
        scripts.push(nodelist[i])
      }
    }

    scripts.forEach( function (oldScript) {
      var newScript = document.createElement("script");
      var attrs = [];
      var nodemap = oldScript.attributes;
      for (var j in nodemap) {
        if (nodemap.hasOwnProperty(j)) {
          attrs.push(nodemap[j])
        }
      }
      attrs.forEach(function(attr) { newScript.setAttribute(attr.name, attr.value) });
      newScript.appendChild(document.createTextNode(oldScript.innerHTML));
      oldScript.parentNode.replaceChild(newScript, oldScript);
    });
    if (JS_MIME_TYPE in output.data) {
      toinsert[nchildren-1].children[1].textContent = output.data[JS_MIME_TYPE];
    }
    output_area._hv_plot_id = id;
    if ((window.Bokeh !== undefined) && (id in Bokeh.index)) {
      window.PyViz.plot_index[id] = Bokeh.index[id];
    } else {
      window.PyViz.plot_index[id] = null;
    }
  } else if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
    var bk_div = document.createElement("div");
    bk_div.innerHTML = output.data[HTML_MIME_TYPE];
    var script_attrs = bk_div.children[0].attributes;
    for (var i = 0; i < script_attrs.length; i++) {
      toinsert[toinsert.length - 1].childNodes[1].setAttribute(script_attrs[i].name, script_attrs[i].value);
    }
    // store reference to server id on output_area
    output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
  }
}

/**
 * Handle when an output is cleared or removed
 */
function handle_clear_output(event, handle) {
  var id = handle.cell.output_area._hv_plot_id;
  var server_id = handle.cell.output_area._bokeh_server_id;
  if (((id === undefined) || !(id in PyViz.plot_index)) && (server_id !== undefined)) { return; }
  var comm = window.PyViz.comm_manager.get_client_comm("hv-extension-comm", "hv-extension-comm", function () {});
  if (server_id !== null) {
    comm.send({event_type: 'server_delete', 'id': server_id});
    return;
  } else if (comm !== null) {
    comm.send({event_type: 'delete', 'id': id});
  }
  delete PyViz.plot_index[id];
  if ((window.Bokeh !== undefined) & (id in window.Bokeh.index)) {
    var doc = window.Bokeh.index[id].model.document
    doc.clear();
    const i = window.Bokeh.documents.indexOf(doc);
    if (i > -1) {
      window.Bokeh.documents.splice(i, 1);
    }
  }
}

/**
 * Handle kernel restart event
 */
function handle_kernel_cleanup(event, handle) {
  delete PyViz.comms["hv-extension-comm"];
  window.PyViz.plot_index = {}
}

/**
 * Handle update_display_data messages
 */
function handle_update_output(event, handle) {
  handle_clear_output(event, {cell: {output_area: handle.output_area}})
  handle_add_output(event, handle)
}

function register_renderer(events, OutputArea) {
  function append_mime(data, metadata, element) {
    // create a DOM node to render to
    var toinsert = this.create_output_subarea(
    metadata,
    CLASS_NAME,
    EXEC_MIME_TYPE
    );
    this.keyboard_manager.register_events(toinsert);
    // Render to node
    var props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
    render(props, toinsert[0]);
    element.append(toinsert);
    return toinsert
  }

  events.on('output_added.OutputArea', handle_add_output);
  events.on('output_updated.OutputArea', handle_update_output);
  events.on('clear_output.CodeCell', handle_clear_output);
  events.on('delete.Cell', handle_clear_output);
  events.on('kernel_ready.Kernel', handle_kernel_cleanup);

  OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
    safe: true,
    index: 0
  });
}

if (window.Jupyter !== undefined) {
  try {
    var events = require('base/js/events');
    var OutputArea = require('notebook/js/outputarea').OutputArea;
    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  } catch(err) {
  }
}

</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>*[data-root-id],
*[data-root-id] > * {
  box-sizing: border-box;
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  color: var(--vscode-editor-foreground, var(--jp-ui-font-color1));
}

/* Override VSCode background color */
.cell-output-ipywidget-background:has(
    > .cell-output-ipywidget-background > .lm-Widget > *[data-root-id]
  ),
.cell-output-ipywidget-background:has(> .lm-Widget > *[data-root-id]) {
  background-color: transparent !important;
}
</style></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div class="logo-block">
<img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlz
AAAB+wAAAfsBxc2miwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAA6zSURB
VHic7ZtpeFRVmsf/5966taWqUlUJ2UioBBJiIBAwCZtog9IOgjqACsogKtqirT2ttt069nQ/zDzt
tI4+CrJIREFaFgWhBXpUNhHZQoKBkIUASchWla1S+3ar7r1nPkDaCAnZKoQP/D7mnPOe9/xy76n3
nFSAW9ziFoPFNED2LLK5wcyBDObkb8ZkxuaoSYlI6ZcOKq1eWFdedqNzGHQBk9RMEwFAASkk0Xw3
ETacDNi2vtvc7L0ROdw0AjoSotQVkKSvHQz/wRO1lScGModBFbDMaNRN1A4tUBCS3lk7BWhQkgpD
lG4852/+7DWr1R3uHAZVQDsbh6ZPN7CyxUrCzJMRouusj0ipRwD2uKm0Zn5d2dFwzX1TCGhnmdGo
G62Nna+isiUqhkzuKrkQaJlPEv5mFl2fvGg2t/VnzkEV8F5ioioOEWkLG86fvbpthynjdhXYZziQ
x1hC9J2NFyi8vCTt91Fh04KGip0AaG9zuCk2wQCVyoNU3Hjezee9bq92duzzTmxsRJoy+jEZZZYo
GTKJ6SJngdJqAfRzpze0+jHreUtPc7gpBLQnIYK6BYp/uGhw9YK688eu7v95ysgshcg9qSLMo3JC
4jqLKQFBgdKDPoQ+Pltb8dUyQLpeDjeVgI6EgLIQFT5tEl3rn2losHVsexbZ3EyT9wE1uGdkIPcy
BGxn8QUq1QrA5nqW5i2tLqvrrM9NK6AdkVIvL9E9bZL/oyfMVd/jqvc8LylzRBKDJSzIExwhQzuL
QYGQj4rHfFTc8mUdu3E7yoLtbTe9gI4EqVgVkug2i5+uXGo919ixbRog+3fTbQ8qJe4ZOYNfMoTI
OoshUNosgO60AisX15aeI2PSIp5KiFLI9ubb1vV3Qb2ltwLakUCDAkWX7/nHKRmmGIl9VgYsUhJm
2NXjKYADtM1ygne9QQDIXlk49FBstMKx66D1v4+XuQr7vqTe0VcBHQlRWiOCbmmSYe2SqtL6q5rJ
zsTb7lKx3FKOYC4DoqyS/B5bvLPxvD9Qtf6saxYLQGJErmDOdOMr/zo96km1nElr8bmPOBwI9COv
HnFPRIwmkSOv9kcAS4heRsidOkpeWBgZM+UBrTFAXNYL5Vf2ii9c1trNzpYdaoVil3WIc+wdk+gQ
noie3ecCcxt9ITcLAPWt/laGEO/9U6PmzZkenTtsSMQ8uYywJVW+grCstAvCIaAdArAsIWkRDDs/
KzLm2YcjY1Lv0UdW73HabE9n6V66cxSzfEmuJssTpKGVp+0vHq73FwL46eOjpMpbRAnNmJFrGJNu
Ukf9Yrz+3rghiumCKNXXWPhLYcjxGsIpoCMsIRoFITkW8AuyM8jC1+/QLx4bozCEJIq38+1rtpR6
V/yzb8eBlRb3fo5l783N0CWolAzJHaVNzkrTzlEp2bQ2q3TC5gn6wpnoQAmwSiGh2GitnTmVMc5O
UyfKWUKCIsU7+fZDKwqdT6DDpvkzAX4/+AMFjk0tDp5GRXLpQ2MUmhgDp5gxQT8+Y7hyPsMi8uxF
71H0oebujHALECjFKaW9Lm68n18wXp2kVzIcABytD5iXFzg+WVXkegpAsOOYziqo0OkK76GyquC3
ltZAzMhhqlSNmmWTE5T6e3IN05ITFLM4GdN0vtZ3ob8Jh1NAKXFbm5PtLU/eqTSlGjkNAJjdgn/N
aedXa0tdi7+t9G0FIF49rtMSEgAs1kDLkTPO7ebm4IUWeyh1bKomXqlgMG6kJmHcSM0clYLJ8XtR
1GTnbV3F6I5wCGikAb402npp1h1s7LQUZZSMIfALFOuL3UUrfnS8+rez7v9qcold5tilgHbO1fjK
9ubb17u9oshxzMiUBKXWqJNxd+fqb0tLVs4lILFnK71H0Ind7uiPgACVcFJlrb0tV6DzxqqTIhUM
CwDf1/rrVhTa33/3pGPxJYdQ2l2cbgVcQSosdx8uqnDtbGjh9SlDVSMNWhlnilfqZk42Th2ZpLpf
xrHec5e815zrr0dfBZSwzkZfqsv+1FS1KUknUwPARVvItfKUY+cn57yP7qv07UE3p8B2uhUwLk09
e0SCOrK+hbdYHYLjRIl71wWzv9jpEoeOHhGRrJAzyEyNiJuUqX0g2sBN5kGK6y2Blp5M3lsB9Qh4
y2Ja6x6+i0ucmKgwMATwhSjdUu49tKrQ/pvN5d53ml2CGwCmJipmKjgmyuaXzNeL2a0AkQ01Th5j
2DktO3Jyk8f9vcOBQHV94OK+fPumJmvQHxJoWkaKWq9Vs+yUsbq0zGT1I4RgeH2b5wef7+c7bl8F
eKgoHVVZa8ZPEORzR6sT1BzDUAD/d9F78e2Tzv99v8D+fLVTqAKAsbGamKey1Mt9Ann4eH3gTXTz
idWtAJ8PQWOk7NzSeQn/OTHDuEikVF1R4z8BQCy+6D1aWRfY0tTGG2OM8rRoPaeIj5ZHzJxszElN
VM8K8JS5WOfv8mzRnQAKoEhmt8gyPM4lU9SmBK1MCQBnW4KONT86v1hZ1PbwSXPw4JWussVjtH9Y
NCoiL9UoH/6PSu8jFrfY2t36erQHXLIEakMi1SydmzB31h3GGXFDFNPaK8Rme9B79Ixrd0WN+1ij
NRQ/doRmuFLBkHSTOm5GruG+pFjFdAmorG4IXH1Qua6ASniclfFtDYt+oUjKipPrCQB7QBQ2lrgP
fFzm+9XWUtcqJ3/5vDLDpJ79XHZk3u8nGZ42qlj1+ydtbxysCezrydp6ugmipNJ7WBPB5tydY0jP
HaVNzs3QzeE4ZpTbI+ZbnSFPbVOw9vsfnVvqWnirPyCNGD08IlqtYkh2hjZ5dErEQzoNm+6ykyOt
Lt5/PQEuSRRKo22VkydK+vvS1XEKlhCJAnsqvcVvH7f/ZU2R67eXbMEGAMiIV5oWZWiWvz5Fv2xG
sjqNJQRvn3Rs2lji/lNP19VjAQDgD7FHhujZB9OGqYxRkZxixgRDVlqS6uEOFaJUVu0rPFzctrnF
JqijImVp8dEKVWyUXDk92zAuMZ6bFwpBU1HrOw6AdhQgUooChb0+ItMbWJitSo5Ws3IAOGEOtL53
0vHZih9sC4vtofZ7Qu6523V/fmGcds1TY3V36pUsBwAbSlxnVh2xLfAD/IAIMDf7XYIkNmXfpp2l
18rkAJAy9HKFaIr/qULkeQQKy9zf1JgDB2uaeFNGijo5QsUyacNUUTOnGO42xSnv4oOwpDi1zYkc
efUc3I5Gk6PhyTuVKaOGyLUAYPGIoY9Pu/atL/L92+4q9wbflRJ2Trpm/jPjdBtfnqB/dIThcl8A
KG7hbRuKnb8qsQsVvVlTrwQAQMUlf3kwJI24Z4JhPMtcfng5GcH49GsrxJpGvvHIaeem2ma+KSjQ
lIwUdYyCY8j4dE1KzijNnIP2llF2wcXNnsoapw9XxsgYAl6k+KzUXbi2yP3KR2ecf6z3BFsBICdW
nvnIaG3eHybqX7vbpEqUMT+9OL4Qpe8VON7dXuFd39v19FoAABRVePbGGuXTszO0P7tu6lghUonE
llRdrhArLvmKdh9u29jcFiRRkfLUxBiFNiqSU9icoZQHo5mYBI1MBgBH6wMNb+U7Pnw337H4gi1Y
ciWs+uks3Z9fztUvfzxTm9Ne8XXkvQLHNytOOZeiD4e0PgkAIAYCYknKUNUDSXEKzdWNpnil7r4p
xqkjTarZMtk/K8TQ6Qve78qqvXurGwIJqcOUKfUWHsm8KGvxSP68YudXq4pcj39X49uOK2X142O0
Tz5/u/7TVybqH0rSya6ZBwD21/gubbrgWdDgEOx9WUhfBaC2ibcEBYm7a7x+ukrBMNcEZggyR0TE
T8zUPjikQ4VosQZbTpS4vqizBKvqmvjsqnpfzaZyx9JPiz1/bfGKdgD45XB1zoIMzYbfTdS/NClB
Gct0USiY3YL/g0LHy/uq/Ef6uo5+n0R/vyhp17Klpge763f8rMu6YU/zrn2nml+2WtH+Z+5IAAFc
2bUTdTDOSNa9+cQY7YLsOIXhevEkCvzph7a8laecz/Un/z4/Ae04XeL3UQb57IwU9ZDr9UuKVajv
nxp1+1UVIo/LjztZkKH59fO3G/JemqCfmaCRqbqbd90ZZ8FfjtkfAyD0J/9+C2h1hDwsSxvGjNDc
b4zk5NfrSwiQblLHzZhg+Jf4aPlUwpDqkQqa9nimbt1/TDH8OitGMaQnj+RJS6B1fbF7SY1TqO5v
/v0WAADl1f7zokgS7s7VT2DZ7pegUjBM7mjtiDZbcN4j0YrHH0rXpCtY0qPX0cVL0rv5jv/ZXend
0u/EESYBAFBU4T4Qa5TflZOhTe7pmKpaP8kCVUVw1+yhXfJWvn1P3hnXi33JsTN6PnP3hHZ8Z3/h
aLHzmkNPuPj7Bc/F/Q38CwjTpSwQXgE4Vmwry9tpfq/ZFgqFMy4AVDtCvi8rvMvOmv0N4YwbVgEA
sPM72/KVnzfspmH7HQGCRLG2yL1+z8XwvPcdCbsAANh+xPzstgMtxeGKt+6MK3/tacfvwhWvIwMi
oKEBtm0H7W+UVfkc/Y1V0BhoPlDr/w1w/eu1vjIgAgDg22OtX6/eYfnEz/focrZTHAFR+PSs56/7
q32nwpjazxgwAQCwcU/T62t3WL7r6/jVRa6/byp1rei+Z98ZUAEAhEPHPc8fKnTU9nbgtnOe8h0l
9hcGIqmODLQAHCy2Xti6v/XNRivf43f4fFvIteu854+VHnR7q9tfBlwAAGz+pnndB9vM26UebAe8
SLHujPOTPVW+rwY+sxskAAC2HrA8t2Vvc7ffP1r9o+vwR2dcr92InIAbKKC1FZ5tB1tf+/G8p8sv
N/9Q5zd/XR34LYCwV5JdccMEAMDBk45DH243r/X4xGvqxFa/GNpS7n6rwOwNWwHVE26oAADYurf1
zx/utOzt+DMKYM0p17YtZZ5VNzqfsB2HewG1WXE8PoZ7gOclbTIvynZf9JV+fqZtfgs/8F/Nu5rB
EIBmJ+8QRMmpU7EzGRsf2FzuePqYRbzh/zE26EwdrT10f6r6o8HOYzCJB9Dpff8tbnGLG8L/A/WE
roTBs2RqAAAAAElFTkSuQmCC'
     style='height:25px; border-radius:12px; display: inline-block; float: left; vertical-align: middle'></img>


  <img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAK6wAACusBgosNWgAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAf9SURBVFiFvZh7cFTVHcc/59y7793sJiFAwkvAYDRqFWwdraLVlj61diRYsDjqCFbFKrYo0CltlSq1tLaC2GprGIriGwqjFu10OlrGv8RiK/IICYECSWBDkt3s695zTv9IAtlHeOn0O7Mzu797z+/3Ob/z+p0VfBq9doNFljuABwAXw2PcvGHt6bgwxhz7Ls4YZNVXxxANLENwE2D1W9PAGmAhszZ0/X9gll5yCbHoOirLzmaQs0F6F8QMZq1v/8xgNm7DYwwjgXJLYL4witQ16+sv/U9HdDmV4WrKw6B06cZC/RMrM4MZ7xz61DAbtzEXmAvUAX4pMOVecg9/MFFu3j3Gz7gQBLygS2RGumBkL0cubiFRsR3LzVBV1UMk3IrW73PT9C2lYOwhQB4ClhX1AuKpjLcV27oEjyUpNUJCg1CvcejykWTCXyQgzic2HIIBjg3pS6+uRLKAhumZvD4U+tq0jTrgkVKQQtLekfTtxIPAkhTNF6G7kZm7aPp6M9myKVQEoaYaIhEQYvD781DML/RfBGNZXAl4irJiwBa07e/y7cQnBaJghIX6ENl2GR/fGCBoz6cm5qeyEqQA5ZYA5x5eeiV0Qph4gjFAUSwAr6QllQgcxS/Jm25Cr2Tmpsk03XI9NfI31FTZBEOgVOk51adqDBNPCNPSRlkiDXbBEwOU2WxH+I7itQZ62g56OjM33suq1YsZHVtGZSUI2QdyYgkgOthQNIF7BIGDnRAJgJSgj69cUx1gB8PkOGwL4E1gPrM27gIg7NlGKLQApc7BmEnAxP5g/rw4YqBrCDB5xHkw5rdR/1qTrN/hKNo6YUwVDNpFsnjYS8RbidBPcPXFP6R6yfExuOXmN4A3jv1+8ZUwgY9D2OWjUZE6lO88jDwHI8ZixGiMKSeYTBamCoDk6kDAb6y1OcH1a6KpD/fZesoFw5FlIXAVCIiH4PxrV+p2npVDToTBmtjY8t1swh2V61E9KqWiyuPEjM8dbfxuvfa49Zayf9R136Wr8mBSf/T7bNteA8zwaGEUbFpckWwq95n59dUIywKl2fbOIS5e8bWSu0tJ1a5redAYfqkdjesodFajcgaVNWhXo1C9SrkN3Usmv3UMJrc6/DDwkwEntkEJLe67tSLhvyzK8rHDQWleve5CGk4VZEB1r+5bg2E2si+Y0QatDK6jUVkX5eg2YYlp++ZM+rfMNYamAj8Y7MAVWFqaR1f/t2xzU4IHjybBtthzuiAASqv7jTF7jOqDMAakFHgDNsFyP+FhwZHBmH9F7cutIYkQCylYYv1AZSqsn1/+bX51OMMjPSl2nAnM7hnjOx2v53YgNWAzHM9Q/9l0lQWPSCBSyokAtOBC1Rj+w/1Xs+STDp4/E5g7Rs2zm2+oeVd7PUuHKDf6A4r5EsPT5K3gfCnBXNUYnvGzb+KcCczYYWOnLpy4eOXuG2oec0PBN8XQQAnpvS35AvAykr56rWhPBiV4MvtceGLxk5Mr6A1O8IfK7rl7xJ0r9kyumuP4fa0lMqTBLJIAJqEf1J3qE92lMBndlyfRD2YBghHC4hlny7ASqCeWo5zaoDdIWfnIefNGTb9fC73QDfhyBUCNOxrGPSUBfPem9us253YTV+3mcBbdkUYfzmHiLqZbYdIGHHON2ZlemXouaJUOO6TqtdHEQuXYY8Yt+EbDgmlS6RdzkaDTv2P9A3gICiq93sWhb5mc5wVhuU3Y7m5hOc3So7qFT3SLgOXHb/cyOfMn7xROegoC/PTcn3v8gbKPgDopJFk3R/uBPWQiwQ+2/GJevRMObLUzqe/saJjQUQTTftEVMW9tWxPgAocwcj9abNcZe7s+6t2R2xXZG7zyYLp8Q1PiRBBHym5bYuXi8Qt+/LvGu9f/5YDAxABsaRNPH6Xr4D4Sk87a897SOy9v/fKwjoF2eQel95yDESGEF6gEMwKhLwKus3wOVjTtes7qzgLdXTMnNCNoEpbcrtNuq6N7Xh/+eqcbj94xQkp7mdKpW5XbtbR8Z26kgMCAf2UU5YEovRUVRHbu2b3vK1UdDFkDCyMRQxbpdv8nhKAGIa7QaQedzT07fFPny53R738JoVYBdVrnsNx9XZ9v33UeGO+AA2MMUkgqQ5UcdDLZSFeVgONnXeHqSAC5Ew1BXwko0D1Zct3dT1duOjS3MzZnEUJtBuoQAq3SGOLR4ekjn9NC5nVOaYXf9lETrUkmOJy3pOz8OKIb2A1cWhJCCEzOxU2mUPror+2/L3yyM3pkM7jTjr1nBOgkGeyQ7erxpdJsMAS9wb2F9rzMxNY1K2PMU0WtZV82VU8Wp6vbKJVo9Lx/+4cydORdxCCQ/kDGTZCWsRpLu7VD7bfKqL8V2orKTp/PtzaXy42jr6TwAuisi+7JolUG4wY+8vyrISCMtRrLKWpvjAOqx/QGhp0rjRo5xD3x98CWQuOQN8qumRMmI7jKZPUEpzNVZsj4Zbaq1to5tZZsKIydLWojhIXrJnES79EaOzv3du2NytKuxzJKAA6wF8xqEE8s2jo/1wd/khslQGxd81Zg62Bbp31XBH+iETt7Y3ELA0iU6iGDlQ5mexe0VEx4a3x8V1AaYwFJgTiwaOsDmeK2J8nMUOqsnB1A+dcA04ucCYt0urkjmflk9iT2v30q/gZn5rQPvor4n9Ou634PeBzoznes/iot/7WnClKoM/+zCIjH5kwT8ChQjTHPIPTjFV3PpU/Hx+DM/A9U3IXI4SPCYAAAAABJRU5ErkJggg=='
       style='height:15px; border-radius:12px; display: inline-block; float: left'></img>





</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SpatailDM version: 0.2.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## From GPU2</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/mnt/lingyu/nfs_share2/Python/&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;FineST/FineST/&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">FineST</span> <span class="k">as</span> <span class="nn">fst</span>
<span class="kn">from</span> <span class="nn">FineST.datasets</span> <span class="kn">import</span> <span class="n">dataset</span>
<span class="kn">import</span> <span class="nn">FineST.plottings</span> <span class="k">as</span> <span class="nn">fstplt</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;
(function(root) {
  function now() {
    return new Date();
  }

  var force = true;
  var py_version = '3.1.1'.replace('rc', '-rc.').replace('.dev', '-dev.');
  var is_dev = py_version.indexOf("+") !== -1 || py_version.indexOf("-") !== -1;
  var reloading = false;
  var Bokeh = root.Bokeh;
  var bokeh_loaded = Bokeh != null && (Bokeh.version === py_version || (Bokeh.versions !== undefined && Bokeh.versions.has(py_version)));

  if (typeof (root._bokeh_timeout) === "undefined" || force) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks;
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, js_modules, js_exports, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];
    if (js_modules == null) js_modules = [];
    if (js_exports == null) js_exports = {};

    root._bokeh_onload_callbacks.push(callback);

    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls.length === 0 && js_modules.length === 0 && Object.keys(js_exports).length === 0) {
      run_callbacks();
      return null;
    }
    if (!reloading) {
      console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    }

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }
    window._bokeh_on_load = on_load

    function on_error() {
      console.error("failed to load " + url);
    }

    var skip = [];
    if (window.requirejs) {
      window.requirejs.config({'packages': {}, 'paths': {'jspanel': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/jspanel', 'jspanel-modal': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/modal/jspanel.modal', 'jspanel-tooltip': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/tooltip/jspanel.tooltip', 'jspanel-hint': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/hint/jspanel.hint', 'jspanel-layout': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/layout/jspanel.layout', 'jspanel-contextmenu': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/contextmenu/jspanel.contextmenu', 'jspanel-dock': 'https://cdn.jsdelivr.net/npm/jspanel4@4.12.0/dist/extensions/dock/jspanel.dock', 'gridstack': 'https://cdn.jsdelivr.net/npm/gridstack@7.2.3/dist/gridstack-all', 'notyf': 'https://cdn.jsdelivr.net/npm/notyf@3/notyf.min'}, 'shim': {'jspanel': {'exports': 'jsPanel'}, 'gridstack': {'exports': 'GridStack'}}});
      require(["jspanel"], function(jsPanel) {
    window.jsPanel = jsPanel
    on_load()
      })
      require(["jspanel-modal"], function() {
    on_load()
      })
      require(["jspanel-tooltip"], function() {
    on_load()
      })
      require(["jspanel-hint"], function() {
    on_load()
      })
      require(["jspanel-layout"], function() {
    on_load()
      })
      require(["jspanel-contextmenu"], function() {
    on_load()
      })
      require(["jspanel-dock"], function() {
    on_load()
      })
      require(["gridstack"], function(GridStack) {
    window.GridStack = GridStack
    on_load()
      })
      require(["notyf"], function() {
    on_load()
      })
      root._bokeh_is_loading = css_urls.length + 9;
    } else {
      root._bokeh_is_loading = css_urls.length + js_urls.length + js_modules.length + Object.keys(js_exports).length;
    }

    var existing_stylesheets = []
    var links = document.getElementsByTagName('link')
    for (var i = 0; i < links.length; i++) {
      var link = links[i]
      if (link.href != null) {
    existing_stylesheets.push(link.href)
      }
    }
    for (var i = 0; i < css_urls.length; i++) {
      var url = css_urls[i];
      if (existing_stylesheets.indexOf(url) !== -1) {
    on_load()
    continue;
      }
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error;
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }    if (((window['jsPanel'] !== undefined) && (!(window['jsPanel'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/jspanel.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/modal/jspanel.modal.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/tooltip/jspanel.tooltip.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/hint/jspanel.hint.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/layout/jspanel.layout.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/contextmenu/jspanel.contextmenu.js', 'https://cdn.holoviz.org/panel/1.2.3/dist/bundled/floatpanel/jspanel4@4.12.0/dist/extensions/dock/jspanel.dock.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    if (((window['GridStack'] !== undefined) && (!(window['GridStack'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/1.2.3/dist/bundled/gridstack/gridstack@7.2.3/dist/gridstack-all.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    if (((window['Notyf'] !== undefined) && (!(window['Notyf'] instanceof HTMLElement))) || window.requirejs) {
      var urls = ['https://cdn.holoviz.org/panel/1.2.3/dist/bundled/notificationarea/notyf@3/notyf.min.js'];
      for (var i = 0; i < urls.length; i++) {
        skip.push(urls[i])
      }
    }    var existing_scripts = []
    var scripts = document.getElementsByTagName('script')
    for (var i = 0; i < scripts.length; i++) {
      var script = scripts[i]
      if (script.src != null) {
    existing_scripts.push(script.src)
      }
    }
    for (var i = 0; i < js_urls.length; i++) {
      var url = js_urls[i];
      if (skip.indexOf(url) !== -1 || existing_scripts.indexOf(url) !== -1) {
    if (!window.requirejs) {
      on_load();
    }
    continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (var i = 0; i < js_modules.length; i++) {
      var url = js_modules[i];
      if (skip.indexOf(url) !== -1 || existing_scripts.indexOf(url) !== -1) {
    if (!window.requirejs) {
      on_load();
    }
    continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (const name in js_exports) {
      var url = js_exports[name];
      if (skip.indexOf(url) >= 0 || root[name] != null) {
    if (!window.requirejs) {
      on_load();
    }
    continue;
      }
      var element = document.createElement('script');
      element.onerror = on_error;
      element.async = false;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      element.textContent = `
      import ${name} from "${url}"
      window.${name} = ${name}
      window._bokeh_on_load()
      `
      document.head.appendChild(element);
    }
    if (!js_urls.length && !js_modules.length) {
      on_load()
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  var js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-3.1.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.1.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.1.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.1.1.min.js", "https://cdn.holoviz.org/panel/1.2.3/dist/panel.min.js"];
  var js_modules = [];
  var js_exports = {};
  var css_urls = [];
  var inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {} // ensure no trailing comma for IE
  ];

  function run_inline_js() {
    if ((root.Bokeh !== undefined) || (force === true)) {
      for (var i = 0; i < inline_js.length; i++) {
        inline_js[i].call(root, root.Bokeh);
      }
      // Cache old bokeh versions
      if (Bokeh != undefined && !reloading) {
    var NewBokeh = root.Bokeh;
    if (Bokeh.versions === undefined) {
      Bokeh.versions = new Map();
    }
    if (NewBokeh.version !== Bokeh.version) {
      Bokeh.versions.set(NewBokeh.version, NewBokeh)
    }
    root.Bokeh = Bokeh;
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    }
    root._bokeh_is_initializing = false
  }

  function load_or_wait() {
    // Implement a backoff loop that tries to ensure we do not load multiple
    // versions of Bokeh and its dependencies at the same time.
    // In recent versions we use the root._bokeh_is_initializing flag
    // to determine whether there is an ongoing attempt to initialize
    // bokeh, however for backward compatibility we also try to ensure
    // that we do not start loading a newer (Panel>=1.0 and Bokeh>3) version
    // before older versions are fully initialized.
    if (root._bokeh_is_initializing && Date.now() > root._bokeh_timeout) {
      root._bokeh_is_initializing = false;
      root._bokeh_onload_callbacks = undefined;
      console.log("Bokeh: BokehJS was loaded multiple times but one version failed to initialize.");
      load_or_wait();
    } else if (root._bokeh_is_initializing || (typeof root._bokeh_is_initializing === "undefined" && root._bokeh_onload_callbacks !== undefined)) {
      setTimeout(load_or_wait, 100);
    } else {
      Bokeh = root.Bokeh;
      bokeh_loaded = Bokeh != null && (Bokeh.version === py_version || (Bokeh.versions !== undefined && Bokeh.versions.has(py_version)));
      root._bokeh_is_initializing = true
      root._bokeh_onload_callbacks = []
      if (!reloading && (!bokeh_loaded || is_dev)) {
    root.Bokeh = undefined;
      }
      load_libs(css_urls, js_urls, js_modules, js_exports, function() {
    console.debug("Bokeh: BokehJS plotting callback run at", now());
    run_inline_js();
      });
    }
  }
  // Give older versions of the autoload script a head-start to ensure
  // they initialize before we start loading newer version.
  setTimeout(load_or_wait, 100)
}(window));
</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

if ((window.PyViz === undefined) || (window.PyViz instanceof HTMLElement)) {
  window.PyViz = {comms: {}, comm_status:{}, kernels:{}, receivers: {}, plot_index: []}
}


    function JupyterCommManager() {
    }

    JupyterCommManager.prototype.register_target = function(plot_id, comm_id, msg_handler) {
      if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        comm_manager.register_target(comm_id, function(comm) {
          comm.on_msg(msg_handler);
        });
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        window.PyViz.kernels[plot_id].registerCommTarget(comm_id, function(comm) {
          comm.onMsg = msg_handler;
        });
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        google.colab.kernel.comms.registerTarget(comm_id, (comm) => {
          var messages = comm.messages[Symbol.asyncIterator]();
          function processIteratorResult(result) {
            var message = result.value;
            console.log(message)
            var content = {data: message.data, comm_id};
            var buffers = []
            for (var buffer of message.buffers || []) {
              buffers.push(new DataView(buffer))
            }
            var metadata = message.metadata || {};
            var msg = {content, buffers, metadata}
            msg_handler(msg);
            return messages.next().then(processIteratorResult);
          }
          return messages.next().then(processIteratorResult);
        })
      }
    }

    JupyterCommManager.prototype.get_client_comm = function(plot_id, comm_id, msg_handler) {
      if (comm_id in window.PyViz.comms) {
        return window.PyViz.comms[comm_id];
      } else if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        var comm = comm_manager.new_comm(comm_id, {}, {}, {}, comm_id);
        if (msg_handler) {
          comm.on_msg(msg_handler);
        }
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        var comm = window.PyViz.kernels[plot_id].connectToComm(comm_id);
        comm.open();
        if (msg_handler) {
          comm.onMsg = msg_handler;
        }
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        var comm_promise = google.colab.kernel.comms.open(comm_id)
        comm_promise.then((comm) => {
          window.PyViz.comms[comm_id] = comm;
          if (msg_handler) {
            var messages = comm.messages[Symbol.asyncIterator]();
            function processIteratorResult(result) {
              var message = result.value;
              var content = {data: message.data};
              var metadata = message.metadata || {comm_id};
              var msg = {content, metadata}
              msg_handler(msg);
              return messages.next().then(processIteratorResult);
            }
            return messages.next().then(processIteratorResult);
          }
        })
        var sendClosure = (data, metadata, buffers, disposeOnDone) => {
          return comm_promise.then((comm) => {
            comm.send(data, metadata, buffers, disposeOnDone);
          });
        };
        var comm = {
          send: sendClosure
        };
      }
      window.PyViz.comms[comm_id] = comm;
      return comm;
    }
    window.PyViz.comm_manager = new JupyterCommManager();



var JS_MIME_TYPE = 'application/javascript';
var HTML_MIME_TYPE = 'text/html';
var EXEC_MIME_TYPE = 'application/vnd.holoviews_exec.v0+json';
var CLASS_NAME = 'output';

/**
 * Render data to the DOM node
 */
function render(props, node) {
  var div = document.createElement("div");
  var script = document.createElement("script");
  node.appendChild(div);
  node.appendChild(script);
}

/**
 * Handle when a new output is added
 */
function handle_add_output(event, handle) {
  var output_area = handle.output_area;
  var output = handle.output;
  if ((output.data == undefined) || (!output.data.hasOwnProperty(EXEC_MIME_TYPE))) {
    return
  }
  var id = output.metadata[EXEC_MIME_TYPE]["id"];
  var toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);
  if (id !== undefined) {
    var nchildren = toinsert.length;
    var html_node = toinsert[nchildren-1].children[0];
    html_node.innerHTML = output.data[HTML_MIME_TYPE];
    var scripts = [];
    var nodelist = html_node.querySelectorAll("script");
    for (var i in nodelist) {
      if (nodelist.hasOwnProperty(i)) {
        scripts.push(nodelist[i])
      }
    }

    scripts.forEach( function (oldScript) {
      var newScript = document.createElement("script");
      var attrs = [];
      var nodemap = oldScript.attributes;
      for (var j in nodemap) {
        if (nodemap.hasOwnProperty(j)) {
          attrs.push(nodemap[j])
        }
      }
      attrs.forEach(function(attr) { newScript.setAttribute(attr.name, attr.value) });
      newScript.appendChild(document.createTextNode(oldScript.innerHTML));
      oldScript.parentNode.replaceChild(newScript, oldScript);
    });
    if (JS_MIME_TYPE in output.data) {
      toinsert[nchildren-1].children[1].textContent = output.data[JS_MIME_TYPE];
    }
    output_area._hv_plot_id = id;
    if ((window.Bokeh !== undefined) && (id in Bokeh.index)) {
      window.PyViz.plot_index[id] = Bokeh.index[id];
    } else {
      window.PyViz.plot_index[id] = null;
    }
  } else if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
    var bk_div = document.createElement("div");
    bk_div.innerHTML = output.data[HTML_MIME_TYPE];
    var script_attrs = bk_div.children[0].attributes;
    for (var i = 0; i < script_attrs.length; i++) {
      toinsert[toinsert.length - 1].childNodes[1].setAttribute(script_attrs[i].name, script_attrs[i].value);
    }
    // store reference to server id on output_area
    output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
  }
}

/**
 * Handle when an output is cleared or removed
 */
function handle_clear_output(event, handle) {
  var id = handle.cell.output_area._hv_plot_id;
  var server_id = handle.cell.output_area._bokeh_server_id;
  if (((id === undefined) || !(id in PyViz.plot_index)) && (server_id !== undefined)) { return; }
  var comm = window.PyViz.comm_manager.get_client_comm("hv-extension-comm", "hv-extension-comm", function () {});
  if (server_id !== null) {
    comm.send({event_type: 'server_delete', 'id': server_id});
    return;
  } else if (comm !== null) {
    comm.send({event_type: 'delete', 'id': id});
  }
  delete PyViz.plot_index[id];
  if ((window.Bokeh !== undefined) & (id in window.Bokeh.index)) {
    var doc = window.Bokeh.index[id].model.document
    doc.clear();
    const i = window.Bokeh.documents.indexOf(doc);
    if (i > -1) {
      window.Bokeh.documents.splice(i, 1);
    }
  }
}

/**
 * Handle kernel restart event
 */
function handle_kernel_cleanup(event, handle) {
  delete PyViz.comms["hv-extension-comm"];
  window.PyViz.plot_index = {}
}

/**
 * Handle update_display_data messages
 */
function handle_update_output(event, handle) {
  handle_clear_output(event, {cell: {output_area: handle.output_area}})
  handle_add_output(event, handle)
}

function register_renderer(events, OutputArea) {
  function append_mime(data, metadata, element) {
    // create a DOM node to render to
    var toinsert = this.create_output_subarea(
    metadata,
    CLASS_NAME,
    EXEC_MIME_TYPE
    );
    this.keyboard_manager.register_events(toinsert);
    // Render to node
    var props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
    render(props, toinsert[0]);
    element.append(toinsert);
    return toinsert
  }

  events.on('output_added.OutputArea', handle_add_output);
  events.on('output_updated.OutputArea', handle_update_output);
  events.on('clear_output.CodeCell', handle_clear_output);
  events.on('delete.Cell', handle_clear_output);
  events.on('kernel_ready.Kernel', handle_kernel_cleanup);

  OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
    safe: true,
    index: 0
  });
}

if (window.Jupyter !== undefined) {
  try {
    var events = require('base/js/events');
    var OutputArea = require('notebook/js/outputarea').OutputArea;
    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  } catch(err) {
  }
}

</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>*[data-root-id],
*[data-root-id] > * {
  box-sizing: border-box;
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  color: var(--vscode-editor-foreground, var(--jp-ui-font-color1));
}

/* Override VSCode background color */
.cell-output-ipywidget-background:has(
    > .cell-output-ipywidget-background > .lm-Widget > *[data-root-id]
  ),
.cell-output-ipywidget-background:has(> .lm-Widget > *[data-root-id]) {
  background-color: transparent !important;
}
</style></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div class="logo-block">
<img src='data:image/png;base64,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
roTBs2RqAAAAAElFTkSuQmCC'
     style='height:25px; border-radius:12px; display: inline-block; float: left; vertical-align: middle'></img>


  <img src='data:image/png;base64,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'
       style='height:15px; border-radius:12px; display: inline-block; float: left'></img>





</div></div>
</div>
</section>
<section id="1.-Load-sub-spot-level-adata-for-ligand-receptor-interaction-discovery">
<h2>1. Load sub-spot-level adata for ligand-receptor interaction discovery<a class="headerlink" href="#1.-Load-sub-spot-level-adata-for-ligand-receptor-interaction-discovery" title="Permalink to this heading"></a></h2>
<p>For NPC dataset, the the above four <code class="docutils literal notranslate"><span class="pre">.h5ad</span></code> adata files can be downloaded from <a class="reference external" href="https://drive.google.com/drive/folders/1ypaTohLM2lP4EnKeYTS6QUvv-ymcRVZo">Goole Drive</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">patientxy</span> <span class="o">=</span> <span class="s1">&#39;patient1&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/NPC/Data/stdata/ImputData/</span><span class="si">{</span><span class="n">patientxy</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
<span class="n">adata_impt_all</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">patientxy</span><span class="si">}</span><span class="s2">_adata_all.h5ad&quot;</span><span class="p">)</span>    <span class="c1"># subspot</span>
<span class="n">adata_impt_all</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">adata_impt_all</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                                  <span class="n">adata_impt_all</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AnnData object with n_obs × n_vars = 80624 × 596
    obs: &#39;x&#39;, &#39;y&#39;, &#39;CD27&#39;
    obsm: &#39;spatial&#39;
</pre></div></div>
</div>
<p>1.1 Get weight_matrix by rbf kernel</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spot_diameter_fullres</span><span class="o">=</span><span class="mf">139.44595843130838</span>

<span class="c1"># sdm.weight_matrix(adata_impt_all, l = spot_diameter_fullres,</span>
<span class="c1">#                   cutoff = 0.001, single_cell = False)</span>
<span class="n">fst</span><span class="o">.</span><span class="n">weight_matrix</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">spot_diameter_fullres</span><span class="p">,</span>
              <span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">single_cell</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_nearest_neighbors</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AnnData object with n_obs × n_vars = 80624 × 596
    obs: &#39;x&#39;, &#39;y&#39;, &#39;CD27&#39;
    uns: &#39;single_cell&#39;
    obsm: &#39;spatial&#39;
    obsp: &#39;weight&#39;, &#39;nearest_neighbors&#39;
</pre></div></div>
</div>
<div class="admonition note">
<p><strong>Note</strong> If using <code class="docutils literal notranslate"><span class="pre">sdm.weight_matrix</span></code> from <code class="docutils literal notranslate"><span class="pre">spatialDM</span></code> in large samples, it will cost too much time. Here, we update it to <code class="docutils literal notranslate"><span class="pre">fst.weight_matrix</span></code> with user-friendly <code class="docutils literal notranslate"><span class="pre">n_nearest_neighbors</span></code> to make it more efficient.</p>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Visualize the range of interaction</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">adata_impt_all</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">c</span><span class="o">=</span><span class="n">adata_impt_all</span><span class="o">.</span><span class="n">obsp</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">5000</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_10_0.png" src="_images/NPC_LRI_CCC_10_0.png" />
</div>
</div>
<p>1.2 Extract valid LR pairs from the database</p>
<p>This step will take too much time, if the sample number is very large, for example Visium HD dataset (about 100,000 samples)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## find overlapping LRs from CellChatDB</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">sdm</span><span class="o">.</span><span class="n">extract_lr</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">,</span> <span class="s1">&#39;human&#39;</span><span class="p">,</span> <span class="n">min_cell</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
26.115 seconds
AnnData object with n_obs × n_vars = 80624 × 596
    obs: &#39;x&#39;, &#39;y&#39;, &#39;CD27&#39;
    uns: &#39;single_cell&#39;, &#39;mean&#39;, &#39;ligand&#39;, &#39;receptor&#39;, &#39;num_pairs&#39;, &#39;geneInter&#39;
    obsm: &#39;spatial&#39;
    obsp: &#39;weight&#39;, &#39;nearest_neighbors&#39;
</pre></div></div>
</div>
<div class="admonition note">
<p><strong>Note</strong> Use the least <a class="reference external" href="https://pypi.org/project/SpatialDM/">spatialDM</a> version! Sometimes, if you find errors when using <code class="docutils literal notranslate"><span class="pre">spatialDM</span></code>, install the newest spatialDM package using <code class="docutils literal notranslate"><span class="pre">!pip</span> <span class="pre">install</span> <span class="pre">-U</span> <span class="pre">git+https://github.com/StatBiomed/SpatialDM</span></code>.</p>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## see the condidiate LR pairs for this NPC datset</span>
<span class="n">adata_impt_all</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;geneInter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>interaction_name</th>
      <th>pathway_name</th>
      <th>agonist</th>
      <th>antagonist</th>
      <th>co_A_receptor</th>
      <th>co_I_receptor</th>
      <th>evidence</th>
      <th>annotation</th>
      <th>interaction_name_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EFNA5_EPHB2</th>
      <td>EFNA5_EPHB2</td>
      <td>EPHA</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID:15107857; PMID: 15114347</td>
      <td>Cell-Cell Contact</td>
      <td>EFNA5 - EPHB2</td>
    </tr>
    <tr>
      <th>EFNB1_EPHA4</th>
      <td>EFNB1_EPHA4</td>
      <td>EPHB</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID: 15114347</td>
      <td>Cell-Cell Contact</td>
      <td>EFNB1 - EPHA4</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB1</th>
      <td>EFNB1_EPHB1</td>
      <td>EPHB</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID: 15114347</td>
      <td>Cell-Cell Contact</td>
      <td>EFNB1 - EPHB1</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB2</th>
      <td>EFNB1_EPHB2</td>
      <td>EPHB</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID: 15114347</td>
      <td>Cell-Cell Contact</td>
      <td>EFNB1 - EPHB2</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB3</th>
      <td>EFNB1_EPHB3</td>
      <td>EPHB</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID: 15114347</td>
      <td>Cell-Cell Contact</td>
      <td>EFNB1 - EPHB3</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>CCL3_CCR5</th>
      <td>CCL3_CCR5</td>
      <td>CCL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>KEGG: hsa04060</td>
      <td>Secreted Signaling</td>
      <td>CCL3 - CCR5</td>
    </tr>
    <tr>
      <th>CCL5_CCR5</th>
      <td>CCL5_CCR5</td>
      <td>CCL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>KEGG: hsa04060</td>
      <td>Secreted Signaling</td>
      <td>CCL5 - CCR5</td>
    </tr>
    <tr>
      <th>CCL4_CCR5</th>
      <td>CCL4_CCR5</td>
      <td>CCL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>KEGG: hsa04060</td>
      <td>Secreted Signaling</td>
      <td>CCL4 - CCR5</td>
    </tr>
    <tr>
      <th>CXCL1_ACKR1</th>
      <td>CXCL1_ACKR1</td>
      <td>CXCL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID: 26740381</td>
      <td>Secreted Signaling</td>
      <td>CXCL1 - ACKR1</td>
    </tr>
    <tr>
      <th>CORT_SSTR2</th>
      <td>CORT_SSTR2</td>
      <td>SEMATOSTATIN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>KEGG: hsa04080</td>
      <td>Secreted Signaling</td>
      <td>CORT - SSTR2</td>
    </tr>
  </tbody>
</table>
<p>1129 rows × 9 columns</p>
</div></div>
</div>
<p>1.3 Global selection (z-score approach)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Identify dataset-specific interacting LR pairs (global selection)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># global Moran selection</span>
<span class="n">sdm</span><span class="o">.</span><span class="n">spatialdm_global</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">,</span> <span class="n">n_perm</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">specified_ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="n">nproc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># select significant pairs</span>
<span class="n">sdm</span><span class="o">.</span><span class="n">sig_pairs</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="n">fdr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
11.963 seconds
AnnData object with n_obs × n_vars = 80624 × 596
    obs: &#39;x&#39;, &#39;y&#39;, &#39;CD27&#39;
    uns: &#39;single_cell&#39;, &#39;mean&#39;, &#39;ligand&#39;, &#39;receptor&#39;, &#39;num_pairs&#39;, &#39;geneInter&#39;, &#39;global_I&#39;, &#39;global_stat&#39;, &#39;global_res&#39;
    obsm: &#39;spatial&#39;
    obsp: &#39;weight&#39;, &#39;nearest_neighbors&#39;
</pre></div></div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle"><strong>Note</strong></p>
<div class="line-block">
<div class="line">If you find the error <code class="docutils literal notranslate"><span class="pre">AttributeError:</span> <span class="pre">module</span> <span class="pre">'numpy'</span> <span class="pre">has</span> <span class="pre">no</span> <span class="pre">attribute</span> <span class="pre">'float'.</span></code>, you need to revise the <code class="docutils literal notranslate"><span class="pre">spatialdm/utils.py</span></code>.</div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">show</span> <span class="pre">spatialDM</span></code> in your conda envirment <code class="docutils literal notranslate"><span class="pre">FineST</span></code></div>
<div class="line">- replace all <code class="docutils literal notranslate"><span class="pre">np.float</span></code> using <code class="docutils literal notranslate"><span class="pre">np.float64</span></code>, in the <code class="docutils literal notranslate"><span class="pre">utils.py</span></code> (Line 114, 124, 187, 197)</div>
</div>
<div class="line-block">
<div class="line">If you find the error <code class="docutils literal notranslate"><span class="pre">TypeError:</span> <span class="pre">ufunc</span> <span class="pre">'isnan'</span> <span class="pre">not</span> <span class="pre">supported</span> <span class="pre">for</span> <span class="pre">the</span> <span class="pre">input</span> <span class="pre">types</span></code>, you need to revise the <code class="docutils literal notranslate"><span class="pre">spatialdm/utils.py</span></code>.</div>
<div class="line">- Fine <code class="docutils literal notranslate"><span class="pre">Calculate</span> <span class="pre">p</span> <span class="pre">values</span></code> part, in the <code class="docutils literal notranslate"><span class="pre">utils.py</span></code> (Line 154-159)</div>
<div class="line">- 1: try to replace <code class="docutils literal notranslate"><span class="pre">adata.uns['global_I']</span> <span class="pre">/</span> <span class="pre">adata.uns['global_stat']['z']['st']</span></code> in Line 157, using <code class="docutils literal notranslate"><span class="pre">float(adata.uns['global_I']</span> <span class="pre">/</span> <span class="pre">adata.uns['global_stat']['z']['st'])</span></code></div>
<div class="line">- 3: try to replace Line 154-159, using the new codes in SpatialDM <a class="reference external" href="https://pypi.org/project/SpatialDM/">(version 0.2.0)</a>.</div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spa_coexp_pair</span> <span class="o">=</span> <span class="n">adata_impt_all</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;global_res&#39;</span><span class="p">]</span>
<span class="n">spa_coexp_pair</span>

<span class="c1">## save 1129  significant LR pairs</span>
<span class="c1"># patientxy = &#39;patient1&#39;</span>
<span class="c1"># os.chdir(str(path)+&#39;NPC/Data/stdata/ImputData/&#39;+str(patientxy)+&#39;/&#39;)</span>
<span class="c1"># spa_coexp_pair.to_csv(&quot;spa_coexp_pair.csv&quot;, index=True, header=True)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ligand0</th>
      <th>Ligand1</th>
      <th>Receptor0</th>
      <th>Receptor1</th>
      <th>Receptor2</th>
      <th>z_pval</th>
      <th>z</th>
      <th>fdr</th>
      <th>selected</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EFNA5_EPHB2</th>
      <td>EFNA5</td>
      <td>None</td>
      <td>EPHB2</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>75.435174</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>EFNB1_EPHA4</th>
      <td>EFNB1</td>
      <td>None</td>
      <td>EPHA4</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>167.853201</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB1</th>
      <td>EFNB1</td>
      <td>None</td>
      <td>EPHB1</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>264.002242</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB2</th>
      <td>EFNB1</td>
      <td>None</td>
      <td>EPHB2</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>309.624969</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB3</th>
      <td>EFNB1</td>
      <td>None</td>
      <td>EPHB3</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>141.854850</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>CCL3_CCR5</th>
      <td>CCL3</td>
      <td>None</td>
      <td>CCR5</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>75.780943</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>CCL5_CCR5</th>
      <td>CCL5</td>
      <td>None</td>
      <td>CCR5</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>688.247705</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>CCL4_CCR5</th>
      <td>CCL4</td>
      <td>None</td>
      <td>CCR5</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>666.677647</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>CXCL1_ACKR1</th>
      <td>CXCL1</td>
      <td>None</td>
      <td>ACKR1</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>127.098812</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>CORT_SSTR2</th>
      <td>CORT</td>
      <td>None</td>
      <td>SSTR2</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>81.661781</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>1129 rows × 9 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## see the unique gene of sig LR pairs</span>
<span class="n">spa_coexp_pairT</span> <span class="o">=</span> <span class="n">spa_coexp_pair</span><span class="p">[</span><span class="n">spa_coexp_pair</span><span class="p">[</span><span class="s1">&#39;selected&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
<span class="n">spa_coexp_pairTgene</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">spa_coexp_pairT</span><span class="p">[</span><span class="s1">&#39;Ligand1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span>
                          <span class="n">spa_coexp_pairT</span><span class="p">[</span><span class="s1">&#39;Receptor0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span>
                          <span class="n">spa_coexp_pairT</span><span class="p">[</span><span class="s1">&#39;Receptor1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span>
                          <span class="n">spa_coexp_pairT</span><span class="p">[</span><span class="s1">&#39;Receptor2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;spa_coexp_pairTgene shape: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">spa_coexp_pairTgene</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
spa_coexp_pairTgene shape:  228
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## use fdr corrected global p-values and a threshold FDR &lt; 0.1 (default)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;global_res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">selected</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">adata_impt_all</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;global_res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;fdr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
798
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ligand0</th>
      <th>Ligand1</th>
      <th>Receptor0</th>
      <th>Receptor1</th>
      <th>Receptor2</th>
      <th>z_pval</th>
      <th>z</th>
      <th>fdr</th>
      <th>selected</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EFNA5_EPHB2</th>
      <td>EFNA5</td>
      <td>None</td>
      <td>EPHB2</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>75.435174</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>WNT2_FZD5_LRP6</th>
      <td>WNT2</td>
      <td>None</td>
      <td>FZD5</td>
      <td>LRP6</td>
      <td>None</td>
      <td>0.0</td>
      <td>1059.123680</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>WNT2_FZD3_LRP6</th>
      <td>WNT2</td>
      <td>None</td>
      <td>FZD3</td>
      <td>LRP6</td>
      <td>None</td>
      <td>0.0</td>
      <td>468.984465</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>WNT2_FZD2_LRP6</th>
      <td>WNT2</td>
      <td>None</td>
      <td>FZD2</td>
      <td>LRP6</td>
      <td>None</td>
      <td>0.0</td>
      <td>634.213171</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>WNT2_FZD10_LRP6</th>
      <td>WNT2</td>
      <td>None</td>
      <td>FZD10</td>
      <td>LRP6</td>
      <td>None</td>
      <td>0.0</td>
      <td>660.725408</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>INHB_ACVR1C_ACVR2B</th>
      <td>INHBA</td>
      <td>INHBB</td>
      <td>ACVR1C</td>
      <td>ACVR2B</td>
      <td>None</td>
      <td>1.0</td>
      <td>-5.319013</td>
      <td>1.0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>INHABA_ACVR2A</th>
      <td>INHBA</td>
      <td>None</td>
      <td>ACVR2A</td>
      <td>None</td>
      <td>None</td>
      <td>1.0</td>
      <td>-185.192807</td>
      <td>1.0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>VWF_ITGAV_ITGB3</th>
      <td>VWF</td>
      <td>None</td>
      <td>ITGAV</td>
      <td>None</td>
      <td>None</td>
      <td>1.0</td>
      <td>-496.694054</td>
      <td>1.0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>LAMB1_SV2A</th>
      <td>LAMB1</td>
      <td>None</td>
      <td>SV2A</td>
      <td>None</td>
      <td>None</td>
      <td>1.0</td>
      <td>-180.492610</td>
      <td>1.0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>LAMB2_DAG1</th>
      <td>LAMB2</td>
      <td>None</td>
      <td>DAG1</td>
      <td>None</td>
      <td>None</td>
      <td>1.0</td>
      <td>-126.363288</td>
      <td>1.0</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>1129 rows × 9 columns</p>
</div></div>
</div>
<p>1.4 Local selection (z-score approach)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Local selection is then run for the selected 798 pairs to identify where the LRI takes place</span>
<span class="n">adata_impt_all</span><span class="o">.</span><span class="n">raw</span> <span class="o">=</span> <span class="n">adata_impt_all</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># local spot selection</span>
<span class="n">sdm</span><span class="o">.</span><span class="n">spatialdm_local</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">,</span> <span class="n">n_perm</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="n">specified_ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nproc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># significant local spots</span>
<span class="n">sdm</span><span class="o">.</span><span class="n">sig_spots</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="n">fdr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
24.836 seconds
AnnData object with n_obs × n_vars = 80624 × 596
    obs: &#39;x&#39;, &#39;y&#39;, &#39;CD27&#39;
    uns: &#39;single_cell&#39;, &#39;mean&#39;, &#39;ligand&#39;, &#39;receptor&#39;, &#39;num_pairs&#39;, &#39;geneInter&#39;, &#39;global_I&#39;, &#39;global_stat&#39;, &#39;global_res&#39;, &#39;local_stat&#39;, &#39;local_z&#39;, &#39;local_z_p&#39;, &#39;selected_spots&#39;
    obsm: &#39;spatial&#39;
    obsp: &#39;weight&#39;, &#39;nearest_neighbors&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_impt_all</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s2">&quot;local_z_p&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>80614</th>
      <th>80615</th>
      <th>80616</th>
      <th>80617</th>
      <th>80618</th>
      <th>80619</th>
      <th>80620</th>
      <th>80621</th>
      <th>80622</th>
      <th>80623</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EFNA5_EPHB2</th>
      <td>0.719076</td>
      <td>0.656354</td>
      <td>0.644588</td>
      <td>0.697118</td>
      <td>0.671626</td>
      <td>0.569434</td>
      <td>0.554211</td>
      <td>0.667623</td>
      <td>0.694790</td>
      <td>0.582295</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>EFNB1_EPHA4</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.519926</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.665789</td>
      <td>0.578423</td>
      <td>0.730823</td>
      <td>0.697330</td>
      <td>0.683036</td>
      <td>0.647225</td>
      <td>0.660661</td>
      <td>0.605626</td>
      <td>0.643360</td>
      <td>0.670612</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB1</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.501244</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.038776</td>
      <td>0.005880</td>
      <td>0.144225</td>
      <td>0.050717</td>
      <td>0.040998</td>
      <td>0.031047</td>
      <td>0.034365</td>
      <td>0.011666</td>
      <td>0.027752</td>
      <td>0.047736</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB2</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.487366</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.697432</td>
      <td>0.612581</td>
      <td>0.789996</td>
      <td>0.730867</td>
      <td>0.719520</td>
      <td>0.686736</td>
      <td>0.700556</td>
      <td>0.659979</td>
      <td>0.683272</td>
      <td>0.717541</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB3</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.484103</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.457129</td>
      <td>0.663942</td>
      <td>0.513249</td>
      <td>0.724187</td>
      <td>0.755380</td>
      <td>0.715550</td>
      <td>0.703121</td>
      <td>0.748194</td>
      <td>0.756836</td>
      <td>0.760877</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>CCL3_CCR5</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>CCL5_CCR5</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>CCL4_CCR5</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>0.517126</td>
      <td>1.000000</td>
      <td>0.453016</td>
      <td>0.463975</td>
      <td>0.516197</td>
      <td>0.477811</td>
      <td>0.509856</td>
      <td>0.503620</td>
      <td>0.488621</td>
    </tr>
    <tr>
      <th>CXCL1_ACKR1</th>
      <td>0.530093</td>
      <td>0.529931</td>
      <td>0.516298</td>
      <td>0.510641</td>
      <td>0.565961</td>
      <td>0.579154</td>
      <td>0.574020</td>
      <td>0.522921</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>CORT_SSTR2</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.654372</td>
      <td>0.676132</td>
      <td>0.628354</td>
      <td>0.651649</td>
      <td>0.658167</td>
      <td>0.661059</td>
      <td>0.657506</td>
      <td>0.675343</td>
      <td>0.660398</td>
      <td>0.649489</td>
    </tr>
  </tbody>
</table>
<p>798 rows × 80624 columns</p>
</div></div>
</div>
<p>1.5 Visualize pairs</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">global_plot</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">,</span> <span class="n">pairs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CD70_CD27&#39;</span><span class="p">,</span> <span class="s2">&quot;MIF_ACKR3&quot;</span><span class="p">,</span> <span class="s2">&quot;COL9A3_SDC1&quot;</span><span class="p">],</span>
               <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdGy_r&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># plt.savefig(&#39;three_pair_subspot.pdf&#39;, dpi=300, bbox_inches=&#39;tight&#39;)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_26_0.png" src="_images/NPC_LRI_CCC_26_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fstplt</span><span class="o">.</span><span class="n">plot_pairs_dot</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;MIF_ACKR3&#39;</span><span class="p">],</span> <span class="n">marker_size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># fstplt.plot_pairs_dot(adata_impt_all, [&#39;MIF_ACKR3&#39;], marker_size = 1, pdf=&quot;subspot_pair_MIF_ACKR3&quot;)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_27_0.png" src="_images/NPC_LRI_CCC_27_0.png" />
</div>
</div>
<p>1.6 Local cell-cell communication pattern detection using SpatialAEH</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bin_spots</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">adata_impt_all</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s2">&quot;local_z_p&quot;</span><span class="p">])[</span><span class="n">adata_impt_all</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;local_stat&#39;</span><span class="p">][</span><span class="s1">&#39;n_spots&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bin_spots</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot; pairs used for spatial clustering&quot;</span><span class="p">)</span>
<span class="n">bin_spots</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
798  pairs used for spatial clustering
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>80614</th>
      <th>80615</th>
      <th>80616</th>
      <th>80617</th>
      <th>80618</th>
      <th>80619</th>
      <th>80620</th>
      <th>80621</th>
      <th>80622</th>
      <th>80623</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EFNA5_EPHB2</th>
      <td>0.280924</td>
      <td>0.343646</td>
      <td>0.355412</td>
      <td>0.302882</td>
      <td>0.328374</td>
      <td>0.430566</td>
      <td>0.445789</td>
      <td>0.332377</td>
      <td>0.305210</td>
      <td>0.417705</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>EFNB1_EPHA4</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.480074</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.334211</td>
      <td>0.421577</td>
      <td>0.269177</td>
      <td>0.302670</td>
      <td>0.316964</td>
      <td>0.352775</td>
      <td>0.339339</td>
      <td>0.394374</td>
      <td>0.356640</td>
      <td>0.329388</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB1</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.498756</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.961224</td>
      <td>0.994120</td>
      <td>0.855775</td>
      <td>0.949283</td>
      <td>0.959002</td>
      <td>0.968953</td>
      <td>0.965635</td>
      <td>0.988334</td>
      <td>0.972248</td>
      <td>0.952264</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB2</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.512634</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.302568</td>
      <td>0.387419</td>
      <td>0.210004</td>
      <td>0.269133</td>
      <td>0.280480</td>
      <td>0.313264</td>
      <td>0.299444</td>
      <td>0.340021</td>
      <td>0.316728</td>
      <td>0.282459</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB3</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.515897</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.542871</td>
      <td>0.336058</td>
      <td>0.486751</td>
      <td>0.275813</td>
      <td>0.244620</td>
      <td>0.284450</td>
      <td>0.296879</td>
      <td>0.251806</td>
      <td>0.243164</td>
      <td>0.239123</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>CCL3_CCR5</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>CCL5_CCR5</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>CCL4_CCR5</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.482874</td>
      <td>0.000000</td>
      <td>0.546984</td>
      <td>0.536025</td>
      <td>0.483803</td>
      <td>0.522189</td>
      <td>0.490144</td>
      <td>0.496380</td>
      <td>0.511379</td>
    </tr>
    <tr>
      <th>CXCL1_ACKR1</th>
      <td>0.469907</td>
      <td>0.470069</td>
      <td>0.483702</td>
      <td>0.489359</td>
      <td>0.434039</td>
      <td>0.420846</td>
      <td>0.425980</td>
      <td>0.477079</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>CORT_SSTR2</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.345628</td>
      <td>0.323868</td>
      <td>0.371646</td>
      <td>0.348351</td>
      <td>0.341833</td>
      <td>0.338941</td>
      <td>0.342494</td>
      <td>0.324657</td>
      <td>0.339602</td>
      <td>0.350511</td>
    </tr>
  </tbody>
</table>
<p>798 rows × 80624 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">gaussian_subspot</span> <span class="o">=</span> <span class="n">fst</span><span class="o">.</span><span class="n">MixedGaussian</span><span class="p">(</span><span class="n">spatial</span> <span class="o">=</span> <span class="n">adata_impt_all</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">],</span>
                                 <span class="n">cov</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;laplacian&#39;</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- </span><span class="si">%.3f</span><span class="s2"> seconds ---&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--- 19.919 seconds ---
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">gaussian_subspot</span><span class="o">.</span><span class="n">run_cluster</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_spots</span><span class="o">.</span><span class="n">transpose</span><span class="p">()),</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- </span><span class="si">%.3f</span><span class="s2"> seconds ---&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Iteration 0
updating variance
Iteration 1
--- 92.994 seconds ---
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fstplt</span><span class="o">.</span><span class="n">sparseAEH_clusters</span><span class="p">(</span><span class="n">gaussian_subspot</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_32_0.png" src="_images/NPC_LRI_CCC_32_0.png" />
</div>
</div>
<div class="admonition note">
<p><strong>Note</strong> The sub-spot-level adata <code class="docutils literal notranslate"><span class="pre">patient1_adata_all.h5ad</span></code> (4x16x resolution) can not be clustered using <code class="docutils literal notranslate"><span class="pre">spatialDM</span></code>, here we use the alternative <code class="docutils literal notranslate"><span class="pre">spatialAEH</span></code>.</p>
</div>
</section>
<section id="2.-Load-spot-level-adata-for-cell-cell-comunication-detection">
<h2>2. Load spot-level adata for cell-cell comunication detection<a class="headerlink" href="#2.-Load-spot-level-adata-for-cell-cell-comunication-detection" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">patientxy</span> <span class="o">=</span> <span class="s1">&#39;patient1&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;NPC/Data/stdata/ImputData/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">patientxy</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

<span class="n">adata_impt_all_spot</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">patientxy</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_adata_all_spot.h5ad&#39;</span><span class="p">)</span>
<span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                                      <span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AnnData object with n_obs × n_vars = 5039 × 596
    obs: &#39;x&#39;, &#39;y&#39;
    obsm: &#39;spatial&#39;
</pre></div></div>
</div>
<p>2.1 Get weight_matrix by rbf kernel</p>
<div class="admonition note">
<p><strong>Note</strong> The sub-spot-level adata <code class="docutils literal notranslate"><span class="pre">patient1_adata_all.h5ad</span></code> (4x16x resolution) can not be clustered using <code class="docutils literal notranslate"><span class="pre">spatialDM</span></code>, here we use the integrated adata <code class="docutils literal notranslate"><span class="pre">patient1_adata_all_spot.h5ad</span></code> (4x resolution).</p>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spot_diameter_fullres</span><span class="o">=</span><span class="mf">139.44595843130838</span>

<span class="n">fst</span><span class="o">.</span><span class="n">weight_matrix</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">spot_diameter_fullres</span><span class="p">,</span>
                  <span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">single_cell</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">n_nearest_neighbors</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AnnData object with n_obs × n_vars = 80624 × 596
    obs: &#39;x&#39;, &#39;y&#39;, &#39;CD27&#39;
    uns: &#39;single_cell&#39;, &#39;mean&#39;, &#39;ligand&#39;, &#39;receptor&#39;, &#39;num_pairs&#39;, &#39;geneInter&#39;, &#39;global_I&#39;, &#39;global_stat&#39;, &#39;global_res&#39;, &#39;local_stat&#39;, &#39;local_z&#39;, &#39;local_z_p&#39;, &#39;selected_spots&#39;
    obsm: &#39;spatial&#39;
    obsp: &#39;weight&#39;, &#39;nearest_neighbors&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Visualize the range of interaction</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">c</span><span class="o">=</span><span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">obsp</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">500</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_39_0.png" src="_images/NPC_LRI_CCC_39_0.png" />
</div>
</div>
<p>2.2 extract valid LR pairs from the database</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## find overlapping LRs from CellChatDB</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">sdm</span><span class="o">.</span><span class="n">extract_lr</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">,</span> <span class="s1">&#39;human&#39;</span><span class="p">,</span> <span class="n">min_cell</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
6.652 seconds
AnnData object with n_obs × n_vars = 5039 × 596
    obs: &#39;x&#39;, &#39;y&#39;
    uns: &#39;single_cell&#39;, &#39;mean&#39;, &#39;ligand&#39;, &#39;receptor&#39;, &#39;num_pairs&#39;, &#39;geneInter&#39;
    obsm: &#39;spatial&#39;
    obsp: &#39;weight&#39;, &#39;nearest_neighbors&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## see the condidiate LR pairs for this NPC datset</span>
<span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;geneInter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>interaction_name</th>
      <th>pathway_name</th>
      <th>agonist</th>
      <th>antagonist</th>
      <th>co_A_receptor</th>
      <th>co_I_receptor</th>
      <th>evidence</th>
      <th>annotation</th>
      <th>interaction_name_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EFNA5_EPHB2</th>
      <td>EFNA5_EPHB2</td>
      <td>EPHA</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID:15107857; PMID: 15114347</td>
      <td>Cell-Cell Contact</td>
      <td>EFNA5 - EPHB2</td>
    </tr>
    <tr>
      <th>EFNB1_EPHA4</th>
      <td>EFNB1_EPHA4</td>
      <td>EPHB</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID: 15114347</td>
      <td>Cell-Cell Contact</td>
      <td>EFNB1 - EPHA4</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB1</th>
      <td>EFNB1_EPHB1</td>
      <td>EPHB</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID: 15114347</td>
      <td>Cell-Cell Contact</td>
      <td>EFNB1 - EPHB1</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB2</th>
      <td>EFNB1_EPHB2</td>
      <td>EPHB</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID: 15114347</td>
      <td>Cell-Cell Contact</td>
      <td>EFNB1 - EPHB2</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB3</th>
      <td>EFNB1_EPHB3</td>
      <td>EPHB</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID: 15114347</td>
      <td>Cell-Cell Contact</td>
      <td>EFNB1 - EPHB3</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>CCL3_CCR5</th>
      <td>CCL3_CCR5</td>
      <td>CCL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>KEGG: hsa04060</td>
      <td>Secreted Signaling</td>
      <td>CCL3 - CCR5</td>
    </tr>
    <tr>
      <th>CCL5_CCR5</th>
      <td>CCL5_CCR5</td>
      <td>CCL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>KEGG: hsa04060</td>
      <td>Secreted Signaling</td>
      <td>CCL5 - CCR5</td>
    </tr>
    <tr>
      <th>CCL4_CCR5</th>
      <td>CCL4_CCR5</td>
      <td>CCL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>KEGG: hsa04060</td>
      <td>Secreted Signaling</td>
      <td>CCL4 - CCR5</td>
    </tr>
    <tr>
      <th>CXCL1_ACKR1</th>
      <td>CXCL1_ACKR1</td>
      <td>CXCL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>PMID: 26740381</td>
      <td>Secreted Signaling</td>
      <td>CXCL1 - ACKR1</td>
    </tr>
    <tr>
      <th>CORT_SSTR2</th>
      <td>CORT_SSTR2</td>
      <td>SEMATOSTATIN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>KEGG: hsa04080</td>
      <td>Secreted Signaling</td>
      <td>CORT - SSTR2</td>
    </tr>
  </tbody>
</table>
<p>1129 rows × 9 columns</p>
</div></div>
</div>
<p>2.3 Global selection (z-score approach)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Identify dataset-specific interacting LR pairs (global selection)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># global Moran selection</span>
<span class="n">sdm</span><span class="o">.</span><span class="n">spatialdm_global</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">,</span> <span class="n">n_perm</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">specified_ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="n">nproc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># select significant pairs</span>
<span class="n">sdm</span><span class="o">.</span><span class="n">sig_pairs</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="n">fdr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2.200 seconds
AnnData object with n_obs × n_vars = 5039 × 596
    obs: &#39;x&#39;, &#39;y&#39;
    uns: &#39;single_cell&#39;, &#39;mean&#39;, &#39;ligand&#39;, &#39;receptor&#39;, &#39;num_pairs&#39;, &#39;geneInter&#39;, &#39;global_I&#39;, &#39;global_stat&#39;, &#39;global_res&#39;
    obsm: &#39;spatial&#39;
    obsp: &#39;weight&#39;, &#39;nearest_neighbors&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spa_coexp_pair_all_spot</span> <span class="o">=</span> <span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;global_res&#39;</span><span class="p">]</span>
<span class="n">spa_coexp_pair_all_spot</span>

<span class="c1">## save 798 significant LR pairs</span>
<span class="c1"># patientxy = &#39;patient1&#39;</span>
<span class="c1"># os.chdir(str(path)+&#39;NPC/Data/stdata/ImputData/&#39;+str(patientxy)+&#39;/&#39;)</span>
<span class="c1"># spa_coexp_pair_all_spot.to_csv(&quot;spa_coexp_pair_all_spot.csv&quot;, index=True, header=True)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ligand0</th>
      <th>Ligand1</th>
      <th>Receptor0</th>
      <th>Receptor1</th>
      <th>Receptor2</th>
      <th>z_pval</th>
      <th>z</th>
      <th>fdr</th>
      <th>selected</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EFNA5_EPHB2</th>
      <td>EFNA5</td>
      <td>None</td>
      <td>EPHB2</td>
      <td>None</td>
      <td>None</td>
      <td>3.999901e-44</td>
      <td>13.883280</td>
      <td>6.730087e-44</td>
      <td>True</td>
    </tr>
    <tr>
      <th>EFNB1_EPHA4</th>
      <td>EFNB1</td>
      <td>None</td>
      <td>EPHA4</td>
      <td>None</td>
      <td>None</td>
      <td>8.014143e-267</td>
      <td>34.877999</td>
      <td>1.908854e-266</td>
      <td>True</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB1</th>
      <td>EFNB1</td>
      <td>None</td>
      <td>EPHB1</td>
      <td>None</td>
      <td>None</td>
      <td>0.000000e+00</td>
      <td>50.238232</td>
      <td>0.000000e+00</td>
      <td>True</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB2</th>
      <td>EFNB1</td>
      <td>None</td>
      <td>EPHB2</td>
      <td>None</td>
      <td>None</td>
      <td>0.000000e+00</td>
      <td>65.976292</td>
      <td>0.000000e+00</td>
      <td>True</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB3</th>
      <td>EFNB1</td>
      <td>None</td>
      <td>EPHB3</td>
      <td>None</td>
      <td>None</td>
      <td>3.942607e-192</td>
      <td>29.543816</td>
      <td>8.398496e-192</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>CCL3_CCR5</th>
      <td>CCL3</td>
      <td>None</td>
      <td>CCR5</td>
      <td>None</td>
      <td>None</td>
      <td>1.210978e-22</td>
      <td>9.722322</td>
      <td>1.933796e-22</td>
      <td>True</td>
    </tr>
    <tr>
      <th>CCL5_CCR5</th>
      <td>CCL5</td>
      <td>None</td>
      <td>CCR5</td>
      <td>None</td>
      <td>None</td>
      <td>0.000000e+00</td>
      <td>62.402727</td>
      <td>0.000000e+00</td>
      <td>True</td>
    </tr>
    <tr>
      <th>CCL4_CCR5</th>
      <td>CCL4</td>
      <td>None</td>
      <td>CCR5</td>
      <td>None</td>
      <td>None</td>
      <td>0.000000e+00</td>
      <td>64.147094</td>
      <td>0.000000e+00</td>
      <td>True</td>
    </tr>
    <tr>
      <th>CXCL1_ACKR1</th>
      <td>CXCL1</td>
      <td>None</td>
      <td>ACKR1</td>
      <td>None</td>
      <td>None</td>
      <td>1.056609e-59</td>
      <td>16.253398</td>
      <td>1.843758e-59</td>
      <td>True</td>
    </tr>
    <tr>
      <th>CORT_SSTR2</th>
      <td>CORT</td>
      <td>None</td>
      <td>SSTR2</td>
      <td>None</td>
      <td>None</td>
      <td>8.550021e-24</td>
      <td>9.988588</td>
      <td>1.371161e-23</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>1129 rows × 9 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## see the unique gene of sig LR pairs</span>
<span class="n">spa_coexp_pairT_all_spot</span> <span class="o">=</span> <span class="n">spa_coexp_pair</span><span class="p">[</span><span class="n">spa_coexp_pair_all_spot</span><span class="p">[</span><span class="s1">&#39;selected&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
<span class="n">spa_coexp_pairTgene_all_spot</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">spa_coexp_pairT_all_spot</span><span class="p">[</span><span class="s1">&#39;Ligand1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span>
                                    <span class="n">spa_coexp_pairT_all_spot</span><span class="p">[</span><span class="s1">&#39;Receptor0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span>
                                    <span class="n">spa_coexp_pairT_all_spot</span><span class="p">[</span><span class="s1">&#39;Receptor1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span>
                                    <span class="n">spa_coexp_pairT_all_spot</span><span class="p">[</span><span class="s1">&#39;Receptor2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;spa_coexp_pairTgene_all_spot shape:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">spa_coexp_pairTgene_all_spot</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
spa_coexp_pairTgene_all_spot shape: 223
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## use fdr corrected global p-values and a threshold FDR &lt; 0.1 (default)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;global_res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">selected</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;global_res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;fdr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
787
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ligand0</th>
      <th>Ligand1</th>
      <th>Receptor0</th>
      <th>Receptor1</th>
      <th>Receptor2</th>
      <th>z_pval</th>
      <th>z</th>
      <th>fdr</th>
      <th>selected</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SEMA3B_NRP1_PLXNA1</th>
      <td>SEMA3B</td>
      <td>None</td>
      <td>NRP1</td>
      <td>PLXNA1</td>
      <td>None</td>
      <td>0.0</td>
      <td>53.342108</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>LAMB3_SV2B</th>
      <td>LAMB3</td>
      <td>None</td>
      <td>SV2B</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>49.998381</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>WNT4_FZD9_LRP5</th>
      <td>WNT4</td>
      <td>None</td>
      <td>LRP5</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>59.212347</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>LAMA5_SV2B</th>
      <td>LAMA5</td>
      <td>None</td>
      <td>SV2B</td>
      <td>None</td>
      <td>None</td>
      <td>0.0</td>
      <td>60.852816</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>WNT4_FZD8_LRP5</th>
      <td>WNT4</td>
      <td>None</td>
      <td>FZD8</td>
      <td>LRP5</td>
      <td>None</td>
      <td>0.0</td>
      <td>81.094356</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>COL6A1_SDC4</th>
      <td>COL6A1</td>
      <td>None</td>
      <td>SDC4</td>
      <td>None</td>
      <td>None</td>
      <td>1.0</td>
      <td>-16.633480</td>
      <td>1.0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>COL6A2_SDC4</th>
      <td>COL6A2</td>
      <td>None</td>
      <td>SDC4</td>
      <td>None</td>
      <td>None</td>
      <td>1.0</td>
      <td>-59.336311</td>
      <td>1.0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>COL6A3_SDC4</th>
      <td>COL6A3</td>
      <td>None</td>
      <td>SDC4</td>
      <td>None</td>
      <td>None</td>
      <td>1.0</td>
      <td>-11.786348</td>
      <td>1.0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>LAMB1_SV2A</th>
      <td>LAMB1</td>
      <td>None</td>
      <td>SV2A</td>
      <td>None</td>
      <td>None</td>
      <td>1.0</td>
      <td>-37.458778</td>
      <td>1.0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>WNT10B_FZD4_LRP5</th>
      <td>WNT10B</td>
      <td>None</td>
      <td>FZD4</td>
      <td>LRP5</td>
      <td>None</td>
      <td>1.0</td>
      <td>-12.650848</td>
      <td>1.0</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>1129 rows × 9 columns</p>
</div></div>
</div>
<p>2.4 Local selection (z-score approach)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Local selection is then run for the selected 787 pairs to identify where the LRI takes place</span>
<span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">raw</span> <span class="o">=</span> <span class="n">adata_impt_all_spot</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># local spot selection</span>
<span class="n">sdm</span><span class="o">.</span><span class="n">spatialdm_local</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">,</span> <span class="n">n_perm</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="n">specified_ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nproc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># significant local spots</span>
<span class="n">sdm</span><span class="o">.</span><span class="n">sig_spots</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="n">fdr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2.612 seconds
AnnData object with n_obs × n_vars = 5039 × 596
    obs: &#39;x&#39;, &#39;y&#39;
    uns: &#39;single_cell&#39;, &#39;mean&#39;, &#39;ligand&#39;, &#39;receptor&#39;, &#39;num_pairs&#39;, &#39;geneInter&#39;, &#39;global_I&#39;, &#39;global_stat&#39;, &#39;global_res&#39;, &#39;local_stat&#39;, &#39;local_z&#39;, &#39;local_z_p&#39;, &#39;selected_spots&#39;
    obsm: &#39;spatial&#39;
    obsp: &#39;weight&#39;, &#39;nearest_neighbors&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s2">&quot;local_z_p&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>5029</th>
      <th>5030</th>
      <th>5031</th>
      <th>5032</th>
      <th>5033</th>
      <th>5034</th>
      <th>5035</th>
      <th>5036</th>
      <th>5037</th>
      <th>5038</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EFNA5_EPHB2</th>
      <td>0.813748</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.888997</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.358688</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.612867</td>
      <td>0.604198</td>
      <td>1.000000</td>
      <td>0.504157</td>
      <td>0.586346</td>
      <td>0.494563</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>EFNB1_EPHA4</th>
      <td>1.000000</td>
      <td>0.473269</td>
      <td>0.999992</td>
      <td>0.455724</td>
      <td>0.464749</td>
      <td>0.510628</td>
      <td>0.749960</td>
      <td>0.960235</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>0.553913</td>
      <td>0.587978</td>
      <td>0.535776</td>
      <td>0.232663</td>
      <td>0.406175</td>
      <td>0.570089</td>
      <td>0.565184</td>
      <td>0.596288</td>
      <td>0.630267</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB1</th>
      <td>1.000000</td>
      <td>0.697661</td>
      <td>0.403559</td>
      <td>0.444750</td>
      <td>0.676221</td>
      <td>0.635362</td>
      <td>0.554736</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.639490</td>
      <td>...</td>
      <td>1.000000</td>
      <td>0.520283</td>
      <td>0.753355</td>
      <td>0.300910</td>
      <td>0.118283</td>
      <td>0.308673</td>
      <td>0.149491</td>
      <td>0.402721</td>
      <td>0.158794</td>
      <td>0.019788</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB2</th>
      <td>1.000000</td>
      <td>0.585525</td>
      <td>1.000000</td>
      <td>0.454769</td>
      <td>0.686409</td>
      <td>0.041313</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.529247</td>
      <td>0.480295</td>
      <td>1.000000</td>
      <td>0.431750</td>
      <td>0.236622</td>
      <td>0.521800</td>
      <td>0.492051</td>
      <td>0.401711</td>
      <td>0.511205</td>
      <td>0.666155</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB3</th>
      <td>1.000000</td>
      <td>0.599519</td>
      <td>1.000000</td>
      <td>0.598755</td>
      <td>0.924819</td>
      <td>0.578215</td>
      <td>0.579929</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.525483</td>
      <td>0.484444</td>
      <td>1.000000</td>
      <td>0.553346</td>
      <td>0.681319</td>
      <td>0.525805</td>
      <td>0.314986</td>
      <td>0.380482</td>
      <td>0.799594</td>
      <td>0.656594</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>CCL3_CCR5</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.728489</td>
      <td>0.574393</td>
      <td>1.000000</td>
      <td>0.551325</td>
      <td>0.966354</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.049700</td>
      <td>0.563110</td>
      <td>0.572148</td>
      <td>0.604354</td>
      <td>0.514396</td>
      <td>0.519886</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.488578</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>CCL5_CCR5</th>
      <td>1.000000</td>
      <td>0.665625</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.899217</td>
      <td>0.562061</td>
      <td>0.516797</td>
      <td>0.513554</td>
      <td>0.028276</td>
      <td>0.533429</td>
      <td>...</td>
      <td>0.444248</td>
      <td>0.702103</td>
      <td>0.798483</td>
      <td>0.766489</td>
      <td>0.437087</td>
      <td>0.484722</td>
      <td>0.562199</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>CCL4_CCR5</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.916178</td>
      <td>0.600771</td>
      <td>1.000000</td>
      <td>0.470536</td>
      <td>0.000595</td>
      <td>0.584619</td>
      <td>...</td>
      <td>0.282191</td>
      <td>0.663932</td>
      <td>0.832459</td>
      <td>0.907320</td>
      <td>0.338376</td>
      <td>0.443883</td>
      <td>0.562627</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.488548</td>
    </tr>
    <tr>
      <th>CXCL1_ACKR1</th>
      <td>0.537861</td>
      <td>1.000000</td>
      <td>0.282023</td>
      <td>0.644793</td>
      <td>1.000000</td>
      <td>0.483355</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.494987</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>CORT_SSTR2</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.749439</td>
      <td>0.661138</td>
      <td>0.623489</td>
      <td>0.335028</td>
      <td>1.000000</td>
      <td>0.580865</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.551826</td>
      <td>0.727608</td>
      <td>0.761164</td>
      <td>0.482721</td>
      <td>0.025468</td>
      <td>0.678119</td>
      <td>0.649563</td>
    </tr>
  </tbody>
</table>
<p>787 rows × 5039 columns</p>
</div></div>
</div>
<p>2.5 Visualize pairs</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">global_plot</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">,</span> <span class="n">pairs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CXCL16_CXCR6&#39;</span><span class="p">,</span> <span class="s2">&quot;MIF_ACKR3&quot;</span><span class="p">,</span> <span class="s1">&#39;PVR_TIGIT&#39;</span><span class="p">],</span>
               <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdGy_r&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># plt.savefig(&#39;three_pair_spot_newpair0903.pdf&#39;, dpi=300, bbox_inches=&#39;tight&#39;)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_52_0.png" src="_images/NPC_LRI_CCC_52_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fstplt</span><span class="o">.</span><span class="n">plot_pairs_dot</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;MIF_ACKR3&#39;</span><span class="p">],</span> <span class="n">marker_size</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="c1"># fstplt.plot_pairs_dot(adata_impt_all_spot, [&#39;MIF_ACKR3&#39;], marker_size = 1, pdf=&quot;spot_pair_MIF_ACKR3&quot;)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_53_0.png" src="_images/NPC_LRI_CCC_53_0.png" />
</div>
</div>
<p>2.6 Local cell-cell communication pattern detection using SpatialDE</p>
<p><a class="reference external" href="https://github.com/Teichlab/SpatialDE">SpatialDE</a> allows clustering of spatially auto-correlated genes. For sample number (n&lt;=5000), SpatialDE can identify spatially auto-correlated interactions using about 40-50 mins.</p>
<div class="line-block">
<div class="line">Here, we used the <code class="docutils literal notranslate"><span class="pre">P-value</span></code> from local Moran’s R using <code class="docutils literal notranslate"><span class="pre">Z-score</span></code> method to Quantify the ligand-receptor interaction strength, users can use binary or continuous local selection status as input.</div>
<div class="line">- binary: <code class="docutils literal notranslate"><span class="pre">bin_spots</span> <span class="pre">=</span> <span class="pre">adata.uns['selected_spots'].astype(int)[adata.uns['local_stat']['n_spots']&gt;2]</span></code></div>
<div class="line">- continuous: <code class="docutils literal notranslate"><span class="pre">bin_spots</span> <span class="pre">=</span> <span class="pre">(1-adata.uns[&quot;local_z_p&quot;])[adata.uns['local_stat']['n_spots']&gt;2]</span></code></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bin_spots</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s2">&quot;local_z_p&quot;</span><span class="p">])[</span><span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;local_stat&#39;</span><span class="p">][</span><span class="s1">&#39;n_spots&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bin_spots</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot; pairs used for spatial clustering&quot;</span><span class="p">)</span>
<span class="n">bin_spots</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
787  pairs used for spatial clustering
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>5029</th>
      <th>5030</th>
      <th>5031</th>
      <th>5032</th>
      <th>5033</th>
      <th>5034</th>
      <th>5035</th>
      <th>5036</th>
      <th>5037</th>
      <th>5038</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EFNA5_EPHB2</th>
      <td>0.186252</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.111003</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.641312</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.387133</td>
      <td>0.395802</td>
      <td>0.000000</td>
      <td>0.495843</td>
      <td>0.413654</td>
      <td>0.505437</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>EFNB1_EPHA4</th>
      <td>0.000000</td>
      <td>0.526731</td>
      <td>0.000008</td>
      <td>0.544276</td>
      <td>0.535251</td>
      <td>0.489372</td>
      <td>0.250040</td>
      <td>0.039765</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.446087</td>
      <td>0.412022</td>
      <td>0.464224</td>
      <td>0.767337</td>
      <td>0.593825</td>
      <td>0.429911</td>
      <td>0.434816</td>
      <td>0.403712</td>
      <td>0.369733</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB1</th>
      <td>0.000000</td>
      <td>0.302339</td>
      <td>0.596441</td>
      <td>0.555250</td>
      <td>0.323779</td>
      <td>0.364638</td>
      <td>0.445264</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.360510</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.479717</td>
      <td>0.246645</td>
      <td>0.699090</td>
      <td>0.881717</td>
      <td>0.691327</td>
      <td>0.850509</td>
      <td>0.597279</td>
      <td>0.841206</td>
      <td>0.980212</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB2</th>
      <td>0.000000</td>
      <td>0.414475</td>
      <td>0.000000</td>
      <td>0.545231</td>
      <td>0.313591</td>
      <td>0.958687</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.470753</td>
      <td>0.519705</td>
      <td>0.000000</td>
      <td>0.568250</td>
      <td>0.763378</td>
      <td>0.478200</td>
      <td>0.507949</td>
      <td>0.598289</td>
      <td>0.488795</td>
      <td>0.333845</td>
    </tr>
    <tr>
      <th>EFNB1_EPHB3</th>
      <td>0.000000</td>
      <td>0.400481</td>
      <td>0.000000</td>
      <td>0.401245</td>
      <td>0.075181</td>
      <td>0.421785</td>
      <td>0.420071</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.474517</td>
      <td>0.515556</td>
      <td>0.000000</td>
      <td>0.446654</td>
      <td>0.318681</td>
      <td>0.474195</td>
      <td>0.685014</td>
      <td>0.619518</td>
      <td>0.200406</td>
      <td>0.343406</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>CCL3_CCR5</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.271511</td>
      <td>0.425607</td>
      <td>0.000000</td>
      <td>0.448675</td>
      <td>0.033646</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.950300</td>
      <td>0.436890</td>
      <td>0.427852</td>
      <td>0.395646</td>
      <td>0.485604</td>
      <td>0.480114</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.511422</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>CCL5_CCR5</th>
      <td>0.000000</td>
      <td>0.334375</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.100783</td>
      <td>0.437939</td>
      <td>0.483203</td>
      <td>0.486446</td>
      <td>0.971724</td>
      <td>0.466571</td>
      <td>...</td>
      <td>0.555752</td>
      <td>0.297897</td>
      <td>0.201517</td>
      <td>0.233511</td>
      <td>0.562913</td>
      <td>0.515278</td>
      <td>0.437801</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>CCL4_CCR5</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.083822</td>
      <td>0.399229</td>
      <td>0.000000</td>
      <td>0.529464</td>
      <td>0.999405</td>
      <td>0.415381</td>
      <td>...</td>
      <td>0.717809</td>
      <td>0.336068</td>
      <td>0.167541</td>
      <td>0.092680</td>
      <td>0.661624</td>
      <td>0.556117</td>
      <td>0.437373</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.511452</td>
    </tr>
    <tr>
      <th>CXCL1_ACKR1</th>
      <td>0.462139</td>
      <td>0.000000</td>
      <td>0.717977</td>
      <td>0.355207</td>
      <td>0.000000</td>
      <td>0.516645</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.505013</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>CORT_SSTR2</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.250561</td>
      <td>0.338862</td>
      <td>0.376511</td>
      <td>0.664972</td>
      <td>0.000000</td>
      <td>0.419135</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.448174</td>
      <td>0.272392</td>
      <td>0.238836</td>
      <td>0.517279</td>
      <td>0.974532</td>
      <td>0.321881</td>
      <td>0.350437</td>
    </tr>
  </tbody>
</table>
<p>787 rows × 5039 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threadpoolctl</span> <span class="kn">import</span> <span class="n">threadpool_limits</span>
<span class="kn">import</span> <span class="nn">NaiveDE</span>
<span class="kn">import</span> <span class="nn">SpatialDE</span>

<span class="k">with</span> <span class="n">threadpool_limits</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_api</span><span class="o">=</span><span class="s1">&#39;blas&#39;</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">SpatialDE</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">],</span> <span class="n">bin_spots</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- </span><span class="si">%.3f</span><span class="s2"> seconds ---&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">histology_results</span><span class="p">,</span> <span class="n">patterns</span> <span class="o">=</span> <span class="n">SpatialDE</span><span class="o">.</span><span class="n">aeh</span><span class="o">.</span><span class="n">spatial_patterns</span><span class="p">(</span>
        <span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">],</span> <span class="n">bin_spots</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">results</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- </span><span class="si">%.3f</span><span class="s2"> seconds ---&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:root:Performing DE test
INFO:root:Pre-calculating USU^T = K&#39;s ...
INFO:root:Done: 6.4e+01s
INFO:root:Fitting gene models
Models:   0%|                                                                                            | 0/10 [00:00&lt;?, ?it/s]
  0%|                                                                                                   | 0/787 [00:00&lt;?, ?it/s]
  1%|▊                                                                                          | 7/787 [00:00&lt;00:11, 66.29it/s]
  2%|█▉                                                                                        | 17/787 [00:00&lt;00:09, 82.20it/s]
  3%|███                                                                                       | 27/787 [00:00&lt;00:08, 87.46it/s]
  5%|████▏                                                                                     | 37/787 [00:00&lt;00:08, 91.39it/s]
  6%|█████▎                                                                                    | 47/787 [00:00&lt;00:07, 92.80it/s]
  7%|██████▌                                                                                   | 57/787 [00:00&lt;00:07, 94.23it/s]
  9%|███████▋                                                                                  | 67/787 [00:00&lt;00:07, 94.92it/s]
 10%|████████▊                                                                                 | 77/787 [00:00&lt;00:07, 94.93it/s]
 11%|█████████▉                                                                                | 87/787 [00:00&lt;00:07, 95.55it/s]
 12%|███████████                                                                               | 97/787 [00:01&lt;00:07, 94.92it/s]
 14%|████████████                                                                             | 107/787 [00:01&lt;00:07, 95.92it/s]
 15%|█████████████▏                                                                           | 117/787 [00:01&lt;00:07, 94.99it/s]
 16%|██████████████▎                                                                          | 127/787 [00:01&lt;00:06, 95.54it/s]
 17%|███████████████▍                                                                         | 137/787 [00:01&lt;00:06, 96.03it/s]
 19%|████████████████▌                                                                        | 147/787 [00:01&lt;00:06, 96.10it/s]
 20%|█████████████████▊                                                                       | 157/787 [00:01&lt;00:06, 96.67it/s]
 21%|██████████████████▉                                                                      | 167/787 [00:01&lt;00:06, 96.49it/s]
 22%|████████████████████                                                                     | 177/787 [00:01&lt;00:06, 96.41it/s]
 24%|█████████████████████▏                                                                   | 187/787 [00:01&lt;00:06, 96.38it/s]
 25%|██████████████████████▎                                                                  | 197/787 [00:02&lt;00:06, 95.55it/s]
 26%|███████████████████████▍                                                                 | 207/787 [00:02&lt;00:06, 95.19it/s]
 28%|████████████████████████▌                                                                | 217/787 [00:02&lt;00:05, 96.15it/s]
 29%|█████████████████████████▋                                                               | 227/787 [00:02&lt;00:05, 96.61it/s]
 30%|██████████████████████████▊                                                              | 237/787 [00:02&lt;00:05, 96.42it/s]
 31%|███████████████████████████▉                                                             | 247/787 [00:02&lt;00:05, 96.94it/s]
 33%|█████████████████████████████                                                            | 257/787 [00:02&lt;00:05, 96.89it/s]
 34%|██████████████████████████████▏                                                          | 267/787 [00:02&lt;00:05, 96.79it/s]
 35%|███████████████████████████████▎                                                         | 277/787 [00:02&lt;00:05, 96.76it/s]
 36%|████████████████████████████████▍                                                        | 287/787 [00:03&lt;00:05, 96.13it/s]
 38%|█████████████████████████████████▌                                                       | 297/787 [00:03&lt;00:05, 95.93it/s]
 39%|██████████████████████████████████▋                                                      | 307/787 [00:03&lt;00:05, 95.98it/s]
 40%|███████████████████████████████████▊                                                     | 317/787 [00:03&lt;00:04, 96.09it/s]
 42%|████████████████████████████████████▉                                                    | 327/787 [00:03&lt;00:04, 95.62it/s]
 43%|██████████████████████████████████████                                                   | 337/787 [00:03&lt;00:04, 96.29it/s]
 44%|███████████████████████████████████████▏                                                 | 347/787 [00:03&lt;00:04, 95.70it/s]
 45%|████████████████████████████████████████▎                                                | 357/787 [00:03&lt;00:04, 96.44it/s]
 47%|█████████████████████████████████████████▌                                               | 367/787 [00:03&lt;00:04, 96.82it/s]
 48%|██████████████████████████████████████████▋                                              | 377/787 [00:03&lt;00:04, 96.87it/s]
 49%|███████████████████████████████████████████▊                                             | 387/787 [00:04&lt;00:04, 95.87it/s]
 50%|████████████████████████████████████████████▉                                            | 397/787 [00:04&lt;00:04, 95.63it/s]
 52%|██████████████████████████████████████████████                                           | 407/787 [00:04&lt;00:03, 96.19it/s]
 53%|███████████████████████████████████████████████▏                                         | 417/787 [00:04&lt;00:03, 95.51it/s]
 54%|████████████████████████████████████████████████▎                                        | 427/787 [00:04&lt;00:03, 95.43it/s]
 56%|█████████████████████████████████████████████████▍                                       | 437/787 [00:04&lt;00:03, 94.22it/s]
 57%|██████████████████████████████████████████████████▌                                      | 447/787 [00:04&lt;00:03, 94.40it/s]
 58%|███████████████████████████████████████████████████▋                                     | 457/787 [00:04&lt;00:03, 95.47it/s]
 59%|████████████████████████████████████████████████████▊                                    | 467/787 [00:04&lt;00:03, 96.12it/s]
 61%|█████████████████████████████████████████████████████▉                                   | 477/787 [00:05&lt;00:03, 95.52it/s]
 62%|███████████████████████████████████████████████████████                                  | 487/787 [00:05&lt;00:03, 96.04it/s]
 63%|████████████████████████████████████████████████████████▏                                | 497/787 [00:05&lt;00:03, 95.82it/s]
 64%|█████████████████████████████████████████████████████████▎                               | 507/787 [00:05&lt;00:02, 95.73it/s]
 66%|██████████████████████████████████████████████████████████▍                              | 517/787 [00:05&lt;00:02, 96.56it/s]
 67%|███████████████████████████████████████████████████████████▌                             | 527/787 [00:05&lt;00:02, 96.94it/s]
 68%|████████████████████████████████████████████████████████████▋                            | 537/787 [00:05&lt;00:02, 96.79it/s]
 70%|█████████████████████████████████████████████████████████████▊                           | 547/787 [00:05&lt;00:02, 96.86it/s]
 71%|██████████████████████████████████████████████████████████████▉                          | 557/787 [00:05&lt;00:02, 97.30it/s]
 72%|████████████████████████████████████████████████████████████████                         | 567/787 [00:05&lt;00:02, 97.04it/s]
 73%|█████████████████████████████████████████████████████████████████▎                       | 577/787 [00:06&lt;00:02, 96.89it/s]
 75%|██████████████████████████████████████████████████████████████████▍                      | 587/787 [00:06&lt;00:02, 96.69it/s]
 76%|███████████████████████████████████████████████████████████████████▌                     | 597/787 [00:06&lt;00:01, 97.16it/s]
 77%|████████████████████████████████████████████████████████████████████▋                    | 607/787 [00:06&lt;00:01, 97.14it/s]
 78%|█████████████████████████████████████████████████████████████████████▊                   | 617/787 [00:06&lt;00:01, 96.90it/s]
 80%|██████████████████████████████████████████████████████████████████████▉                  | 627/787 [00:06&lt;00:01, 96.87it/s]
 81%|████████████████████████████████████████████████████████████████████████                 | 637/787 [00:06&lt;00:01, 97.03it/s]
 82%|█████████████████████████████████████████████████████████████████████████▏               | 647/787 [00:06&lt;00:01, 97.26it/s]
 83%|██████████████████████████████████████████████████████████████████████████▎              | 657/787 [00:06&lt;00:01, 96.75it/s]
 85%|███████████████████████████████████████████████████████████████████████████▍             | 667/787 [00:06&lt;00:01, 95.93it/s]
 86%|████████████████████████████████████████████████████████████████████████████▌            | 677/787 [00:07&lt;00:01, 96.19it/s]
 87%|█████████████████████████████████████████████████████████████████████████████▋           | 687/787 [00:07&lt;00:01, 96.44it/s]
 89%|██████████████████████████████████████████████████████████████████████████████▊          | 697/787 [00:07&lt;00:00, 96.48it/s]
 90%|███████████████████████████████████████████████████████████████████████████████▉         | 707/787 [00:07&lt;00:00, 95.97it/s]
 91%|█████████████████████████████████████████████████████████████████████████████████        | 717/787 [00:07&lt;00:00, 95.71it/s]
 92%|██████████████████████████████████████████████████████████████████████████████████▏      | 727/787 [00:07&lt;00:00, 95.94it/s]
 94%|███████████████████████████████████████████████████████████████████████████████████▎     | 737/787 [00:07&lt;00:00, 96.43it/s]
 95%|████████████████████████████████████████████████████████████████████████████████████▍    | 747/787 [00:07&lt;00:00, 96.87it/s]
 96%|█████████████████████████████████████████████████████████████████████████████████████▌   | 757/787 [00:07&lt;00:00, 96.83it/s]
 97%|██████████████████████████████████████████████████████████████████████████████████████▋  | 767/787 [00:08&lt;00:00, 96.50it/s]
 99%|███████████████████████████████████████████████████████████████████████████████████████▊ | 777/787 [00:08&lt;00:00, 96.30it/s]
100%|█████████████████████████████████████████████████████████████████████████████████████████| 787/787 [00:08&lt;00:00, 95.93it/s]
Models:  10%|████████▍                                                                           | 1/10 [00:08&lt;01:14,  8.22s/it]
  0%|                                                                                                   | 0/787 [00:00&lt;?, ?it/s]
  1%|█▏                                                                                        | 10/787 [00:00&lt;00:08, 96.55it/s]
  3%|██▍                                                                                       | 21/787 [00:00&lt;00:07, 99.56it/s]
  4%|███▌                                                                                     | 32/787 [00:00&lt;00:07, 100.89it/s]
  5%|████▊                                                                                    | 43/787 [00:00&lt;00:07, 101.70it/s]
  7%|██████                                                                                   | 54/787 [00:00&lt;00:07, 101.83it/s]
  8%|███████▎                                                                                 | 65/787 [00:00&lt;00:07, 102.49it/s]
 10%|████████▌                                                                                | 76/787 [00:00&lt;00:06, 102.54it/s]
 11%|█████████▊                                                                               | 87/787 [00:00&lt;00:06, 103.08it/s]
 12%|███████████                                                                              | 98/787 [00:00&lt;00:06, 103.66it/s]
 14%|████████████▏                                                                           | 109/787 [00:01&lt;00:06, 103.36it/s]
 15%|█████████████▍                                                                          | 120/787 [00:01&lt;00:06, 103.54it/s]
 17%|██████████████▋                                                                         | 131/787 [00:01&lt;00:06, 103.72it/s]
 18%|███████████████▉                                                                        | 142/787 [00:01&lt;00:06, 103.25it/s]
 19%|█████████████████                                                                       | 153/787 [00:01&lt;00:06, 103.61it/s]
 21%|██████████████████▎                                                                     | 164/787 [00:01&lt;00:06, 103.33it/s]
 22%|███████████████████▌                                                                    | 175/787 [00:01&lt;00:05, 103.23it/s]
 24%|████████████████████▊                                                                   | 186/787 [00:01&lt;00:05, 103.29it/s]
 25%|██████████████████████                                                                  | 197/787 [00:01&lt;00:05, 103.06it/s]
 26%|███████████████████████▎                                                                | 208/787 [00:02&lt;00:05, 102.78it/s]
 28%|████████████████████████▍                                                               | 219/787 [00:02&lt;00:05, 102.80it/s]
 29%|█████████████████████████▋                                                              | 230/787 [00:02&lt;00:05, 102.84it/s]
 31%|██████████████████████████▉                                                             | 241/787 [00:02&lt;00:05, 102.61it/s]
 32%|████████████████████████████▏                                                           | 252/787 [00:02&lt;00:05, 102.71it/s]
 33%|█████████████████████████████▍                                                          | 263/787 [00:02&lt;00:05, 102.71it/s]
 35%|██████████████████████████████▋                                                         | 274/787 [00:02&lt;00:04, 103.32it/s]
 36%|███████████████████████████████▊                                                        | 285/787 [00:02&lt;00:04, 102.45it/s]
 38%|█████████████████████████████████                                                       | 296/787 [00:02&lt;00:04, 102.21it/s]
 39%|██████████████████████████████████▎                                                     | 307/787 [00:02&lt;00:04, 102.29it/s]
 40%|███████████████████████████████████▌                                                    | 318/787 [00:03&lt;00:04, 102.12it/s]
 42%|████████████████████████████████████▊                                                   | 329/787 [00:03&lt;00:04, 102.01it/s]
 43%|██████████████████████████████████████                                                  | 340/787 [00:03&lt;00:04, 102.17it/s]
 45%|███████████████████████████████████████▏                                                | 351/787 [00:03&lt;00:04, 102.18it/s]
 46%|████████████████████████████████████████▍                                               | 362/787 [00:03&lt;00:04, 102.59it/s]
 47%|█████████████████████████████████████████▋                                              | 373/787 [00:03&lt;00:04, 102.17it/s]
 49%|██████████████████████████████████████████▉                                             | 384/787 [00:03&lt;00:03, 102.33it/s]
 50%|████████████████████████████████████████████▏                                           | 395/787 [00:03&lt;00:03, 102.27it/s]
 52%|█████████████████████████████████████████████▍                                          | 406/787 [00:03&lt;00:03, 101.84it/s]
 53%|██████████████████████████████████████████████▋                                         | 417/787 [00:04&lt;00:03, 100.60it/s]
 54%|███████████████████████████████████████████████▊                                        | 428/787 [00:04&lt;00:03, 101.58it/s]
 56%|█████████████████████████████████████████████████                                       | 439/787 [00:04&lt;00:03, 102.21it/s]
 57%|██████████████████████████████████████████████████▎                                     | 450/787 [00:04&lt;00:03, 102.88it/s]
 59%|███████████████████████████████████████████████████▌                                    | 461/787 [00:04&lt;00:03, 102.71it/s]
 60%|████████████████████████████████████████████████████▊                                   | 472/787 [00:04&lt;00:03, 103.01it/s]
 61%|██████████████████████████████████████████████████████                                  | 483/787 [00:04&lt;00:02, 102.74it/s]
 63%|███████████████████████████████████████████████████████▏                                | 494/787 [00:04&lt;00:02, 102.53it/s]
 64%|████████████████████████████████████████████████████████▍                               | 505/787 [00:04&lt;00:02, 102.37it/s]
 66%|█████████████████████████████████████████████████████████▋                              | 516/787 [00:05&lt;00:02, 101.99it/s]
 67%|██████████████████████████████████████████████████████████▉                             | 527/787 [00:05&lt;00:02, 102.64it/s]
 68%|████████████████████████████████████████████████████████████▏                           | 538/787 [00:05&lt;00:02, 102.56it/s]
 70%|█████████████████████████████████████████████████████████████▍                          | 549/787 [00:05&lt;00:02, 102.25it/s]
 71%|██████████████████████████████████████████████████████████████▌                         | 560/787 [00:05&lt;00:02, 102.39it/s]
 73%|███████████████████████████████████████████████████████████████▊                        | 571/787 [00:05&lt;00:02, 102.48it/s]
 74%|█████████████████████████████████████████████████████████████████                       | 582/787 [00:05&lt;00:01, 103.50it/s]
 75%|██████████████████████████████████████████████████████████████████▎                     | 593/787 [00:05&lt;00:01, 103.59it/s]
 77%|███████████████████████████████████████████████████████████████████▌                    | 604/787 [00:05&lt;00:01, 103.70it/s]
 78%|████████████████████████████████████████████████████████████████████▊                   | 615/787 [00:05&lt;00:01, 104.17it/s]
 80%|█████████████████████████████████████████████████████████████████████▉                  | 626/787 [00:06&lt;00:01, 104.32it/s]
 81%|███████████████████████████████████████████████████████████████████████▏                | 637/787 [00:06&lt;00:01, 104.54it/s]
 82%|████████████████████████████████████████████████████████████████████████▍               | 648/787 [00:06&lt;00:01, 104.36it/s]
 84%|█████████████████████████████████████████████████████████████████████████▋              | 659/787 [00:06&lt;00:01, 103.91it/s]
 85%|██████████████████████████████████████████████████████████████████████████▉             | 670/787 [00:06&lt;00:01, 103.65it/s]
 87%|████████████████████████████████████████████████████████████████████████████▏           | 681/787 [00:06&lt;00:01, 103.86it/s]
 88%|█████████████████████████████████████████████████████████████████████████████▍          | 692/787 [00:06&lt;00:00, 103.88it/s]
 89%|██████████████████████████████████████████████████████████████████████████████▌         | 703/787 [00:06&lt;00:00, 103.95it/s]
 91%|███████████████████████████████████████████████████████████████████████████████▊        | 714/787 [00:06&lt;00:00, 103.34it/s]
 92%|█████████████████████████████████████████████████████████████████████████████████       | 725/787 [00:07&lt;00:00, 103.15it/s]
 94%|██████████████████████████████████████████████████████████████████████████████████▎     | 736/787 [00:07&lt;00:00, 103.75it/s]
 95%|███████████████████████████████████████████████████████████████████████████████████▌    | 747/787 [00:07&lt;00:00, 104.00it/s]
 96%|████████████████████████████████████████████████████████████████████████████████████▊   | 758/787 [00:07&lt;00:00, 103.98it/s]
 98%|█████████████████████████████████████████████████████████████████████████████████████▉  | 769/787 [00:07&lt;00:00, 104.08it/s]
 99%|███████████████████████████████████████████████████████████████████████████████████████▏| 780/787 [00:07&lt;00:00, 104.10it/s]
Models:  20%|████████████████▊                                                                   | 2/10 [00:15&lt;01:03,  7.89s/it]
  0%|                                                                                                   | 0/787 [00:00&lt;?, ?it/s]
  1%|█▏                                                                                       | 11/787 [00:00&lt;00:07, 104.76it/s]
  3%|██▍                                                                                      | 22/787 [00:00&lt;00:07, 103.31it/s]
  4%|███▋                                                                                     | 33/787 [00:00&lt;00:07, 101.46it/s]
  6%|████▉                                                                                    | 44/787 [00:00&lt;00:07, 101.89it/s]
  7%|██████▎                                                                                   | 55/787 [00:00&lt;00:07, 99.90it/s]
  8%|███████▍                                                                                  | 65/787 [00:00&lt;00:07, 99.89it/s]
 10%|████████▌                                                                                | 76/787 [00:00&lt;00:07, 100.76it/s]
 11%|█████████▊                                                                               | 87/787 [00:00&lt;00:06, 100.60it/s]
 12%|███████████▏                                                                              | 98/787 [00:00&lt;00:06, 98.50it/s]
 14%|████████████▎                                                                            | 109/787 [00:01&lt;00:06, 99.10it/s]
 15%|█████████████▍                                                                           | 119/787 [00:01&lt;00:06, 97.36it/s]
 17%|██████████████▋                                                                          | 130/787 [00:01&lt;00:06, 99.36it/s]
 18%|███████████████▉                                                                         | 141/787 [00:01&lt;00:06, 99.87it/s]
 19%|████████████████▉                                                                       | 152/787 [00:01&lt;00:06, 100.88it/s]
 21%|██████████████████▏                                                                     | 163/787 [00:01&lt;00:06, 100.21it/s]
 22%|███████████████████▋                                                                     | 174/787 [00:01&lt;00:06, 98.46it/s]
 23%|████████████████████▊                                                                    | 184/787 [00:01&lt;00:06, 98.20it/s]
 25%|█████████████████████▉                                                                   | 194/787 [00:01&lt;00:06, 97.85it/s]
 26%|███████████████████████▏                                                                 | 205/787 [00:02&lt;00:05, 99.71it/s]
 27%|████████████████████████▎                                                                | 215/787 [00:02&lt;00:05, 96.99it/s]
 29%|█████████████████████████▌                                                               | 226/787 [00:02&lt;00:05, 98.53it/s]
 30%|██████████████████████████▊                                                              | 237/787 [00:02&lt;00:05, 99.76it/s]
 32%|████████████████████████████                                                             | 248/787 [00:02&lt;00:05, 99.72it/s]
 33%|████████████████████████████▉                                                           | 259/787 [00:02&lt;00:05, 101.08it/s]
 34%|██████████████████████████████▏                                                         | 270/787 [00:02&lt;00:05, 100.79it/s]
 36%|███████████████████████████████▍                                                        | 281/787 [00:02&lt;00:05, 100.39it/s]
 37%|████████████████████████████████▋                                                       | 292/787 [00:02&lt;00:04, 101.41it/s]
 39%|██████████████████████████████████▎                                                      | 303/787 [00:03&lt;00:04, 99.95it/s]
 40%|███████████████████████████████████                                                     | 314/787 [00:03&lt;00:04, 100.34it/s]
 41%|████████████████████████████████████▎                                                   | 325/787 [00:03&lt;00:04, 101.38it/s]
 43%|█████████████████████████████████████▌                                                  | 336/787 [00:03&lt;00:04, 100.33it/s]
 44%|██████████████████████████████████████▊                                                 | 347/787 [00:03&lt;00:04, 101.10it/s]
 45%|████████████████████████████████████████                                                | 358/787 [00:03&lt;00:04, 101.49it/s]
 47%|█████████████████████████████████████████▎                                              | 369/787 [00:03&lt;00:04, 101.83it/s]
 48%|██████████████████████████████████████████▍                                             | 380/787 [00:03&lt;00:04, 100.83it/s]
 50%|████████████████████████████████████████████▏                                            | 391/787 [00:03&lt;00:04, 98.78it/s]
 51%|████████████████████████████████████████████▉                                           | 402/787 [00:04&lt;00:03, 100.17it/s]
 52%|██████████████████████████████████████████████▋                                          | 413/787 [00:04&lt;00:03, 99.09it/s]
 54%|███████████████████████████████████████████████▊                                         | 423/787 [00:04&lt;00:03, 96.53it/s]
 55%|█████████████████████████████████████████████████                                        | 434/787 [00:04&lt;00:03, 98.90it/s]
 57%|██████████████████████████████████████████████████▎                                      | 445/787 [00:04&lt;00:03, 99.90it/s]
 58%|██████████████████████████████████████████████████▉                                     | 456/787 [00:04&lt;00:03, 101.01it/s]
 59%|████████████████████████████████████████████████████▏                                   | 467/787 [00:04&lt;00:03, 101.66it/s]
 61%|█████████████████████████████████████████████████████▍                                  | 478/787 [00:04&lt;00:03, 102.12it/s]
 62%|██████████████████████████████████████████████████████▋                                 | 489/787 [00:04&lt;00:02, 101.59it/s]
 64%|███████████████████████████████████████████████████████▉                                | 500/787 [00:04&lt;00:02, 100.82it/s]
 65%|█████████████████████████████████████████████████████████▏                              | 511/787 [00:05&lt;00:02, 101.54it/s]
 66%|██████████████████████████████████████████████████████████▎                             | 522/787 [00:05&lt;00:02, 102.08it/s]
 68%|████████████████████████████████████████████████████████████▎                            | 533/787 [00:05&lt;00:02, 98.22it/s]
 69%|█████████████████████████████████████████████████████████████▍                           | 543/787 [00:05&lt;00:02, 94.69it/s]
 70%|██████████████████████████████████████████████████████████████▌                          | 553/787 [00:05&lt;00:02, 96.14it/s]
 72%|███████████████████████████████████████████████████████████████▋                         | 563/787 [00:05&lt;00:02, 94.66it/s]
 73%|████████████████████████████████████████████████████████████████▊                        | 573/787 [00:05&lt;00:02, 93.94it/s]
 74%|██████████████████████████████████████████████████████████████████                       | 584/787 [00:05&lt;00:02, 96.75it/s]
 75%|███████████████████████████████████████████████████████████████████▏                     | 594/787 [00:05&lt;00:01, 97.16it/s]
 77%|████████████████████████████████████████████████████████████████████▍                    | 605/787 [00:06&lt;00:01, 98.41it/s]
 78%|█████████████████████████████████████████████████████████████████████▌                   | 615/787 [00:06&lt;00:01, 97.50it/s]
 80%|██████████████████████████████████████████████████████████████████████▊                  | 626/787 [00:06&lt;00:01, 98.88it/s]
 81%|███████████████████████████████████████████████████████████████████████▉                 | 636/787 [00:06&lt;00:01, 98.01it/s]
 82%|█████████████████████████████████████████████████████████████████████████▏               | 647/787 [00:06&lt;00:01, 98.66it/s]
 84%|██████████████████████████████████████████████████████████████████████████▍              | 658/787 [00:06&lt;00:01, 99.86it/s]
 85%|███████████████████████████████████████████████████████████████████████████▌             | 668/787 [00:06&lt;00:01, 99.74it/s]
 86%|████████████████████████████████████████████████████████████████████████████▋            | 678/787 [00:06&lt;00:01, 99.01it/s]
 88%|█████████████████████████████████████████████████████████████████████████████▉           | 689/787 [00:06&lt;00:00, 99.46it/s]
 89%|██████████████████████████████████████████████████████████████████████████████▎         | 700/787 [00:07&lt;00:00, 100.46it/s]
 90%|████████████████████████████████████████████████████████████████████████████████▍        | 711/787 [00:07&lt;00:00, 98.85it/s]
 92%|█████████████████████████████████████████████████████████████████████████████████▌       | 721/787 [00:07&lt;00:00, 98.13it/s]
 93%|██████████████████████████████████████████████████████████████████████████████████▊      | 732/787 [00:07&lt;00:00, 99.18it/s]
 94%|███████████████████████████████████████████████████████████████████████████████████▉     | 742/787 [00:07&lt;00:00, 98.99it/s]
 96%|█████████████████████████████████████████████████████████████████████████████████████    | 752/787 [00:07&lt;00:00, 97.15it/s]
 97%|██████████████████████████████████████████████████████████████████████████████████████▏  | 762/787 [00:07&lt;00:00, 97.95it/s]
 98%|███████████████████████████████████████████████████████████████████████████████████████▍ | 773/787 [00:07&lt;00:00, 98.95it/s]
 99%|████████████████████████████████████████████████████████████████████████████████████████▌| 783/787 [00:07&lt;00:00, 98.62it/s]
Models:  30%|█████████████████████████▏                                                          | 3/10 [00:23&lt;00:55,  7.91s/it]
  0%|                                                                                                   | 0/787 [00:00&lt;?, ?it/s]
  1%|█                                                                                          | 9/787 [00:00&lt;00:09, 84.13it/s]
  2%|██                                                                                        | 18/787 [00:00&lt;00:09, 83.38it/s]
  3%|███                                                                                       | 27/787 [00:00&lt;00:09, 83.62it/s]
  5%|████                                                                                      | 36/787 [00:00&lt;00:08, 84.87it/s]
  6%|█████▏                                                                                    | 45/787 [00:00&lt;00:08, 84.82it/s]
  7%|██████▏                                                                                   | 54/787 [00:00&lt;00:08, 84.90it/s]
  8%|███████▏                                                                                  | 63/787 [00:00&lt;00:08, 84.11it/s]
  9%|████████▏                                                                                 | 72/787 [00:00&lt;00:08, 83.99it/s]
 10%|█████████▎                                                                                | 81/787 [00:00&lt;00:08, 84.82it/s]
 11%|██████████▎                                                                               | 90/787 [00:01&lt;00:08, 84.19it/s]
 13%|███████████▎                                                                              | 99/787 [00:01&lt;00:08, 84.17it/s]
 14%|████████████▏                                                                            | 108/787 [00:01&lt;00:08, 83.68it/s]
 15%|█████████████▏                                                                           | 117/787 [00:01&lt;00:08, 83.48it/s]
 16%|██████████████▏                                                                          | 126/787 [00:01&lt;00:07, 83.79it/s]
 17%|███████████████▎                                                                         | 135/787 [00:01&lt;00:07, 84.42it/s]
 18%|████████████████▎                                                                        | 144/787 [00:01&lt;00:07, 84.65it/s]
 19%|█████████████████▎                                                                       | 153/787 [00:01&lt;00:07, 85.02it/s]
 21%|██████████████████▎                                                                      | 162/787 [00:01&lt;00:07, 85.41it/s]
 22%|███████████████████▎                                                                     | 171/787 [00:02&lt;00:07, 85.20it/s]
 23%|████████████████████▎                                                                    | 180/787 [00:02&lt;00:07, 85.34it/s]
 24%|█████████████████████▎                                                                   | 189/787 [00:02&lt;00:06, 85.95it/s]
 25%|██████████████████████▍                                                                  | 198/787 [00:02&lt;00:06, 87.10it/s]
 26%|███████████████████████▍                                                                 | 207/787 [00:02&lt;00:06, 86.99it/s]
 27%|████████████████████████▍                                                                | 216/787 [00:02&lt;00:06, 85.88it/s]
 29%|█████████████████████████▍                                                               | 225/787 [00:02&lt;00:06, 85.43it/s]
 30%|██████████████████████████▍                                                              | 234/787 [00:02&lt;00:06, 85.95it/s]
 31%|███████████████████████████▍                                                             | 243/787 [00:02&lt;00:06, 85.46it/s]
 32%|████████████████████████████▍                                                            | 252/787 [00:02&lt;00:06, 85.12it/s]
 33%|█████████████████████████████▌                                                           | 261/787 [00:03&lt;00:06, 85.63it/s]
 34%|██████████████████████████████▌                                                          | 270/787 [00:03&lt;00:06, 85.86it/s]
 35%|███████████████████████████████▌                                                         | 279/787 [00:03&lt;00:05, 85.22it/s]
 37%|████████████████████████████████▌                                                        | 288/787 [00:03&lt;00:05, 85.36it/s]
 38%|█████████████████████████████████▌                                                       | 297/787 [00:03&lt;00:05, 84.32it/s]
 39%|██████████████████████████████████▌                                                      | 306/787 [00:03&lt;00:05, 83.62it/s]
 40%|███████████████████████████████████▌                                                     | 315/787 [00:03&lt;00:05, 83.50it/s]
 41%|████████████████████████████████████▋                                                    | 324/787 [00:03&lt;00:05, 83.39it/s]
 42%|█████████████████████████████████████▋                                                   | 333/787 [00:03&lt;00:05, 83.16it/s]
 43%|██████████████████████████████████████▋                                                  | 342/787 [00:04&lt;00:05, 84.46it/s]
 45%|███████████████████████████████████████▋                                                 | 351/787 [00:04&lt;00:05, 84.31it/s]
 46%|████████████████████████████████████████▋                                                | 360/787 [00:04&lt;00:05, 84.22it/s]
 47%|█████████████████████████████████████████▋                                               | 369/787 [00:04&lt;00:04, 83.78it/s]
 48%|██████████████████████████████████████████▋                                              | 378/787 [00:04&lt;00:04, 83.91it/s]
 49%|███████████████████████████████████████████▊                                             | 387/787 [00:04&lt;00:04, 84.65it/s]
 51%|█████████████████████████████████████████████                                            | 398/787 [00:04&lt;00:04, 89.84it/s]
 52%|██████████████████████████████████████████████▎                                          | 409/787 [00:04&lt;00:04, 93.51it/s]
 53%|███████████████████████████████████████████████▍                                         | 419/787 [00:04&lt;00:04, 91.42it/s]
 55%|████████████████████████████████████████████████▋                                        | 430/787 [00:05&lt;00:03, 94.17it/s]
 56%|█████████████████████████████████████████████████▊                                       | 440/787 [00:05&lt;00:03, 94.87it/s]
 57%|███████████████████████████████████████████████████                                      | 451/787 [00:05&lt;00:03, 96.50it/s]
 59%|████████████████████████████████████████████████████▏                                    | 462/787 [00:05&lt;00:03, 98.24it/s]
 60%|█████████████████████████████████████████████████████▍                                   | 473/787 [00:05&lt;00:03, 99.02it/s]
 61%|██████████████████████████████████████████████████████▋                                  | 484/787 [00:05&lt;00:03, 99.56it/s]
 63%|███████████████████████████████████████████████████████▉                                 | 495/787 [00:05&lt;00:02, 99.45it/s]
 64%|█████████████████████████████████████████████████████████▏                               | 506/787 [00:05&lt;00:02, 99.87it/s]
 66%|█████████████████████████████████████████████████████████▊                              | 517/787 [00:05&lt;00:02, 100.14it/s]
 67%|███████████████████████████████████████████████████████████                             | 528/787 [00:05&lt;00:02, 100.18it/s]
 68%|████████████████████████████████████████████████████████████▉                            | 539/787 [00:06&lt;00:02, 96.71it/s]
 70%|██████████████████████████████████████████████████████████████                           | 549/787 [00:06&lt;00:02, 96.73it/s]
 71%|███████████████████████████████████████████████████████████████▏                         | 559/787 [00:06&lt;00:02, 96.25it/s]
 72%|████████████████████████████████████████████████████████████████▎                        | 569/787 [00:06&lt;00:02, 96.34it/s]
 74%|█████████████████████████████████████████████████████████████████▍                       | 579/787 [00:06&lt;00:02, 96.42it/s]
 75%|██████████████████████████████████████████████████████████████████▌                      | 589/787 [00:06&lt;00:02, 96.96it/s]
 76%|███████████████████████████████████████████████████████████████████▋                     | 599/787 [00:06&lt;00:01, 97.80it/s]
 78%|████████████████████████████████████████████████████████████████████▉                    | 610/787 [00:06&lt;00:01, 98.79it/s]
 79%|██████████████████████████████████████████████████████████████████████                   | 620/787 [00:06&lt;00:01, 98.08it/s]
 80%|███████████████████████████████████████████████████████████████████████▏                 | 630/787 [00:07&lt;00:01, 98.46it/s]
 81%|████████████████████████████████████████████████████████████████████████▍                | 640/787 [00:07&lt;00:01, 98.81it/s]
 83%|█████████████████████████████████████████████████████████████████████████▌               | 651/787 [00:07&lt;00:01, 99.36it/s]
 84%|██████████████████████████████████████████████████████████████████████████▊              | 662/787 [00:07&lt;00:01, 99.10it/s]
 86%|████████████████████████████████████████████████████████████████████████████             | 673/787 [00:07&lt;00:01, 99.13it/s]
 87%|█████████████████████████████████████████████████████████████████████████████▏           | 683/787 [00:07&lt;00:01, 98.89it/s]
 88%|██████████████████████████████████████████████████████████████████████████████▎          | 693/787 [00:07&lt;00:00, 98.63it/s]
 89%|███████████████████████████████████████████████████████████████████████████████▌         | 704/787 [00:07&lt;00:00, 99.66it/s]
 91%|████████████████████████████████████████████████████████████████████████████████▋        | 714/787 [00:07&lt;00:00, 98.79it/s]
 92%|█████████████████████████████████████████████████████████████████████████████████▉       | 724/787 [00:07&lt;00:00, 97.23it/s]
 93%|███████████████████████████████████████████████████████████████████████████████████      | 735/787 [00:08&lt;00:00, 98.35it/s]
 95%|████████████████████████████████████████████████████████████████████████████████████▎    | 745/787 [00:08&lt;00:00, 98.07it/s]
 96%|█████████████████████████████████████████████████████████████████████████████████████▍   | 755/787 [00:08&lt;00:00, 96.27it/s]
 97%|██████████████████████████████████████████████████████████████████████████████████████▌  | 765/787 [00:08&lt;00:00, 97.04it/s]
 98%|███████████████████████████████████████████████████████████████████████████████████████▋ | 775/787 [00:08&lt;00:00, 97.08it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████▊| 785/787 [00:08&lt;00:00, 96.66it/s]
Models:  40%|█████████████████████████████████▌                                                  | 4/10 [00:32&lt;00:49,  8.20s/it]
  0%|                                                                                                   | 0/787 [00:00&lt;?, ?it/s]
  1%|█                                                                                          | 9/787 [00:00&lt;00:08, 87.83it/s]
  2%|██                                                                                        | 18/787 [00:00&lt;00:08, 86.92it/s]
  3%|███                                                                                       | 27/787 [00:00&lt;00:08, 86.26it/s]
  5%|████▏                                                                                     | 37/787 [00:00&lt;00:08, 87.89it/s]
  6%|█████▎                                                                                    | 46/787 [00:00&lt;00:08, 87.34it/s]
  7%|██████▎                                                                                   | 55/787 [00:00&lt;00:08, 87.42it/s]
  8%|███████▎                                                                                  | 64/787 [00:00&lt;00:08, 87.88it/s]
  9%|████████▎                                                                                 | 73/787 [00:00&lt;00:08, 87.33it/s]
 10%|█████████▍                                                                                | 82/787 [00:00&lt;00:08, 87.79it/s]
 12%|██████████▍                                                                               | 91/787 [00:01&lt;00:07, 87.30it/s]
 13%|███████████▎                                                                             | 100/787 [00:01&lt;00:07, 87.05it/s]
 14%|████████████▎                                                                            | 109/787 [00:01&lt;00:07, 87.31it/s]
 15%|█████████████▎                                                                           | 118/787 [00:01&lt;00:07, 87.26it/s]
 16%|██████████████▎                                                                          | 127/787 [00:01&lt;00:07, 87.23it/s]
 17%|███████████████▍                                                                         | 136/787 [00:01&lt;00:07, 87.37it/s]
 18%|████████████████▍                                                                        | 145/787 [00:01&lt;00:07, 87.38it/s]
 20%|█████████████████▍                                                                       | 154/787 [00:01&lt;00:07, 86.90it/s]
 21%|██████████████████▍                                                                      | 163/787 [00:01&lt;00:07, 87.03it/s]
 22%|███████████████████▍                                                                     | 172/787 [00:01&lt;00:07, 86.74it/s]
 23%|████████████████████▍                                                                    | 181/787 [00:02&lt;00:06, 87.32it/s]
 24%|█████████████████████▍                                                                   | 190/787 [00:02&lt;00:06, 87.15it/s]
 25%|██████████████████████▌                                                                  | 199/787 [00:02&lt;00:06, 86.93it/s]
 26%|███████████████████████▌                                                                 | 208/787 [00:02&lt;00:06, 87.32it/s]
 28%|████████████████████████▌                                                                | 217/787 [00:02&lt;00:06, 86.90it/s]
 29%|█████████████████████████▌                                                               | 226/787 [00:02&lt;00:06, 86.78it/s]
 30%|██████████████████████████▌                                                              | 235/787 [00:02&lt;00:06, 87.26it/s]
 31%|███████████████████████████▌                                                             | 244/787 [00:02&lt;00:06, 87.46it/s]
 32%|████████████████████████████▌                                                            | 253/787 [00:02&lt;00:06, 86.74it/s]
 33%|█████████████████████████████▋                                                           | 262/787 [00:03&lt;00:06, 86.98it/s]
 34%|██████████████████████████████▋                                                          | 271/787 [00:03&lt;00:05, 87.23it/s]
 36%|███████████████████████████████▋                                                         | 280/787 [00:03&lt;00:05, 87.52it/s]
 37%|████████████████████████████████▋                                                        | 289/787 [00:03&lt;00:05, 87.84it/s]
 38%|█████████████████████████████████▋                                                       | 298/787 [00:03&lt;00:05, 87.61it/s]
 39%|██████████████████████████████████▋                                                      | 307/787 [00:03&lt;00:05, 87.36it/s]
 40%|███████████████████████████████████▋                                                     | 316/787 [00:03&lt;00:05, 87.71it/s]
 41%|████████████████████████████████████▊                                                    | 325/787 [00:03&lt;00:05, 87.88it/s]
 42%|█████████████████████████████████████▊                                                   | 334/787 [00:03&lt;00:05, 87.62it/s]
 44%|██████████████████████████████████████▊                                                  | 343/787 [00:03&lt;00:05, 87.95it/s]
 45%|███████████████████████████████████████▊                                                 | 352/787 [00:04&lt;00:04, 88.02it/s]
 46%|████████████████████████████████████████▊                                                | 361/787 [00:04&lt;00:04, 87.71it/s]
 47%|█████████████████████████████████████████▊                                               | 370/787 [00:04&lt;00:04, 88.13it/s]
 48%|██████████████████████████████████████████▊                                              | 379/787 [00:04&lt;00:04, 87.64it/s]
 49%|███████████████████████████████████████████▉                                             | 389/787 [00:04&lt;00:04, 89.10it/s]
 51%|█████████████████████████████████████████████▏                                           | 400/787 [00:04&lt;00:04, 93.09it/s]
 52%|██████████████████████████████████████████████▍                                          | 411/787 [00:04&lt;00:03, 95.88it/s]
 53%|███████████████████████████████████████████████▌                                         | 421/787 [00:04&lt;00:03, 94.36it/s]
 55%|████████████████████████████████████████████████▊                                        | 432/787 [00:04&lt;00:03, 97.14it/s]
 56%|█████████████████████████████████████████████████▉                                       | 442/787 [00:04&lt;00:03, 97.30it/s]
 58%|███████████████████████████████████████████████████▏                                     | 453/787 [00:05&lt;00:03, 98.49it/s]
 59%|████████████████████████████████████████████████████▍                                    | 464/787 [00:05&lt;00:03, 99.25it/s]
 60%|█████████████████████████████████████████████████████                                   | 475/787 [00:05&lt;00:03, 100.05it/s]
 62%|██████████████████████████████████████████████████████▎                                 | 486/787 [00:05&lt;00:03, 100.11it/s]
 63%|███████████████████████████████████████████████████████▌                                | 497/787 [00:05&lt;00:02, 100.22it/s]
 65%|████████████████████████████████████████████████████████▊                               | 508/787 [00:05&lt;00:02, 100.83it/s]
 66%|██████████████████████████████████████████████████████████                              | 519/787 [00:05&lt;00:02, 101.29it/s]
 67%|███████████████████████████████████████████████████████████▎                            | 530/787 [00:05&lt;00:02, 101.71it/s]
 69%|█████████████████████████████████████████████████████████████▏                           | 541/787 [00:05&lt;00:02, 98.80it/s]
 70%|██████████████████████████████████████████████████████████████▍                          | 552/787 [00:06&lt;00:02, 99.50it/s]
 71%|███████████████████████████████████████████████████████████████▌                         | 562/787 [00:06&lt;00:02, 97.92it/s]
 73%|████████████████████████████████████████████████████████████████▋                        | 572/787 [00:06&lt;00:02, 97.13it/s]
 74%|█████████████████████████████████████████████████████████████████▉                       | 583/787 [00:06&lt;00:02, 98.75it/s]
 75%|███████████████████████████████████████████████████████████████████                      | 593/787 [00:06&lt;00:01, 99.03it/s]
 77%|████████████████████████████████████████████████████████████████████▏                    | 603/787 [00:06&lt;00:01, 99.25it/s]
 78%|█████████████████████████████████████████████████████████████████████▍                   | 614/787 [00:06&lt;00:01, 99.59it/s]
 79%|██████████████████████████████████████████████████████████████████████▌                  | 624/787 [00:06&lt;00:01, 99.52it/s]
 81%|███████████████████████████████████████████████████████████████████████▊                 | 635/787 [00:06&lt;00:01, 99.94it/s]
 82%|████████████████████████████████████████████████████████████████████████▉                | 645/787 [00:07&lt;00:01, 99.65it/s]
 83%|█████████████████████████████████████████████████████████████████████████▎              | 656/787 [00:07&lt;00:01, 100.21it/s]
 85%|██████████████████████████████████████████████████████████████████████████▌             | 667/787 [00:07&lt;00:01, 100.22it/s]
 86%|████████████████████████████████████████████████████████████████████████████▋            | 678/787 [00:07&lt;00:01, 98.94it/s]
 88%|█████████████████████████████████████████████████████████████████████████████▉           | 689/787 [00:07&lt;00:00, 99.53it/s]
 89%|██████████████████████████████████████████████████████████████████████████████▎         | 700/787 [00:07&lt;00:00, 100.10it/s]
 90%|████████████████████████████████████████████████████████████████████████████████▍        | 711/787 [00:07&lt;00:00, 99.73it/s]
 92%|█████████████████████████████████████████████████████████████████████████████████▌       | 721/787 [00:07&lt;00:00, 98.05it/s]
 93%|██████████████████████████████████████████████████████████████████████████████████▊      | 732/787 [00:07&lt;00:00, 99.15it/s]
 94%|████████████████████████████████████████████████████████████████████████████████████     | 743/787 [00:07&lt;00:00, 99.60it/s]
 96%|█████████████████████████████████████████████████████████████████████████████████████▏   | 753/787 [00:08&lt;00:00, 96.82it/s]
 97%|██████████████████████████████████████████████████████████████████████████████████████▎  | 763/787 [00:08&lt;00:00, 97.56it/s]
 98%|███████████████████████████████████████████████████████████████████████████████████████▌ | 774/787 [00:08&lt;00:00, 98.66it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████▋| 784/787 [00:08&lt;00:00, 98.36it/s]
Models:  50%|██████████████████████████████████████████                                          | 5/10 [00:40&lt;00:41,  8.29s/it]
  0%|                                                                                                   | 0/787 [00:00&lt;?, ?it/s]
  1%|█▏                                                                                        | 10/787 [00:00&lt;00:08, 94.97it/s]
  3%|██▎                                                                                       | 20/787 [00:00&lt;00:08, 94.65it/s]
  4%|███▍                                                                                      | 30/787 [00:00&lt;00:08, 94.02it/s]
  5%|████▌                                                                                     | 40/787 [00:00&lt;00:07, 94.15it/s]
  6%|█████▋                                                                                    | 50/787 [00:00&lt;00:07, 94.35it/s]
  8%|██████▊                                                                                   | 60/787 [00:00&lt;00:07, 94.24it/s]
  9%|████████                                                                                  | 70/787 [00:00&lt;00:07, 94.37it/s]
 10%|█████████▏                                                                                | 80/787 [00:00&lt;00:07, 94.66it/s]
 11%|██████████▎                                                                               | 90/787 [00:00&lt;00:07, 94.48it/s]
 13%|███████████▎                                                                             | 100/787 [00:01&lt;00:07, 94.32it/s]
 14%|████████████▍                                                                            | 110/787 [00:01&lt;00:07, 94.14it/s]
 15%|█████████████▌                                                                           | 120/787 [00:01&lt;00:07, 93.84it/s]
 17%|██████████████▋                                                                          | 130/787 [00:01&lt;00:06, 94.07it/s]
 18%|███████████████▊                                                                         | 140/787 [00:01&lt;00:06, 93.94it/s]
 19%|████████████████▉                                                                        | 150/787 [00:01&lt;00:06, 94.15it/s]
 20%|██████████████████                                                                       | 160/787 [00:01&lt;00:06, 94.27it/s]
 22%|███████████████████▏                                                                     | 170/787 [00:01&lt;00:06, 93.84it/s]
 23%|████████████████████▎                                                                    | 180/787 [00:01&lt;00:06, 94.47it/s]
 24%|█████████████████████▍                                                                   | 190/787 [00:02&lt;00:06, 94.73it/s]
 25%|██████████████████████▌                                                                  | 200/787 [00:02&lt;00:06, 93.47it/s]
 27%|███████████████████████▋                                                                 | 210/787 [00:02&lt;00:06, 94.07it/s]
 28%|████████████████████████▉                                                                | 220/787 [00:02&lt;00:06, 94.39it/s]
 29%|██████████████████████████                                                               | 230/787 [00:02&lt;00:05, 93.92it/s]
 30%|███████████████████████████▏                                                             | 240/787 [00:02&lt;00:05, 91.21it/s]
 32%|████████████████████████████▎                                                            | 250/787 [00:02&lt;00:05, 92.20it/s]
 33%|█████████████████████████████▍                                                           | 260/787 [00:02&lt;00:05, 93.00it/s]
 34%|██████████████████████████████▌                                                          | 270/787 [00:02&lt;00:05, 93.09it/s]
 36%|███████████████████████████████▋                                                         | 280/787 [00:02&lt;00:05, 93.76it/s]
 37%|████████████████████████████████▊                                                        | 290/787 [00:03&lt;00:05, 94.26it/s]
 38%|█████████████████████████████████▉                                                       | 300/787 [00:03&lt;00:05, 93.86it/s]
 39%|███████████████████████████████████                                                      | 310/787 [00:03&lt;00:05, 93.25it/s]
 41%|████████████████████████████████████▏                                                    | 320/787 [00:03&lt;00:04, 93.49it/s]
 42%|█████████████████████████████████████▎                                                   | 330/787 [00:03&lt;00:04, 94.23it/s]
 43%|██████████████████████████████████████▍                                                  | 340/787 [00:03&lt;00:04, 94.20it/s]
 44%|███████████████████████████████████████▌                                                 | 350/787 [00:03&lt;00:04, 94.29it/s]
 46%|████████████████████████████████████████▋                                                | 360/787 [00:03&lt;00:04, 94.23it/s]
 47%|█████████████████████████████████████████▊                                               | 370/787 [00:03&lt;00:04, 93.22it/s]
 48%|██████████████████████████████████████████▉                                              | 380/787 [00:04&lt;00:04, 93.97it/s]
 50%|████████████████████████████████████████████                                             | 390/787 [00:04&lt;00:04, 94.36it/s]
 51%|█████████████████████████████████████████████▏                                           | 400/787 [00:04&lt;00:04, 94.20it/s]
 52%|██████████████████████████████████████████████▎                                          | 410/787 [00:04&lt;00:03, 95.01it/s]
 53%|███████████████████████████████████████████████▍                                         | 420/787 [00:04&lt;00:03, 95.31it/s]
 55%|████████████████████████████████████████████████▋                                        | 430/787 [00:04&lt;00:03, 95.60it/s]
 56%|█████████████████████████████████████████████████▊                                       | 440/787 [00:04&lt;00:03, 95.57it/s]
 57%|██████████████████████████████████████████████████▉                                      | 450/787 [00:04&lt;00:03, 95.27it/s]
 58%|████████████████████████████████████████████████████                                     | 460/787 [00:04&lt;00:03, 94.97it/s]
 60%|█████████████████████████████████████████████████████▏                                   | 470/787 [00:04&lt;00:03, 95.68it/s]
 61%|██████████████████████████████████████████████████████▎                                  | 480/787 [00:05&lt;00:03, 95.91it/s]
 62%|███████████████████████████████████████████████████████▍                                 | 490/787 [00:05&lt;00:03, 94.52it/s]
 64%|████████████████████████████████████████████████████████▌                                | 500/787 [00:05&lt;00:03, 94.44it/s]
 65%|█████████████████████████████████████████████████████████▋                               | 510/787 [00:05&lt;00:02, 92.57it/s]
 66%|██████████████████████████████████████████████████████████▊                              | 520/787 [00:05&lt;00:02, 93.16it/s]
 67%|███████████████████████████████████████████████████████████▉                             | 530/787 [00:05&lt;00:02, 93.97it/s]
 69%|█████████████████████████████████████████████████████████████                            | 540/787 [00:05&lt;00:02, 94.21it/s]
 70%|██████████████████████████████████████████████████████████████▏                          | 550/787 [00:05&lt;00:02, 94.18it/s]
 71%|███████████████████████████████████████████████████████████████▎                         | 560/787 [00:05&lt;00:02, 94.49it/s]
 72%|████████████████████████████████████████████████████████████████▍                        | 570/787 [00:06&lt;00:02, 93.57it/s]
 74%|█████████████████████████████████████████████████████████████████▌                       | 580/787 [00:06&lt;00:02, 91.73it/s]
 75%|██████████████████████████████████████████████████████████████████▋                      | 590/787 [00:06&lt;00:02, 93.09it/s]
 76%|███████████████████████████████████████████████████████████████████▊                     | 600/787 [00:06&lt;00:01, 93.82it/s]
 78%|████████████████████████████████████████████████████████████████████▉                    | 610/787 [00:06&lt;00:01, 94.98it/s]
 79%|██████████████████████████████████████████████████████████████████████                   | 620/787 [00:06&lt;00:01, 94.66it/s]
 80%|███████████████████████████████████████████████████████████████████████▏                 | 630/787 [00:06&lt;00:01, 94.86it/s]
 81%|████████████████████████████████████████████████████████████████████████▍                | 640/787 [00:06&lt;00:01, 94.59it/s]
 83%|█████████████████████████████████████████████████████████████████████████▌               | 650/787 [00:06&lt;00:01, 94.43it/s]
 84%|██████████████████████████████████████████████████████████████████████████▋              | 660/787 [00:07&lt;00:01, 94.33it/s]
 85%|███████████████████████████████████████████████████████████████████████████▊             | 670/787 [00:07&lt;00:01, 94.48it/s]
 86%|████████████████████████████████████████████████████████████████████████████▉            | 680/787 [00:07&lt;00:01, 93.91it/s]
 88%|██████████████████████████████████████████████████████████████████████████████           | 690/787 [00:07&lt;00:01, 94.64it/s]
 89%|███████████████████████████████████████████████████████████████████████████████▏         | 700/787 [00:07&lt;00:00, 95.04it/s]
 90%|████████████████████████████████████████████████████████████████████████████████▎        | 710/787 [00:07&lt;00:00, 95.18it/s]
 91%|█████████████████████████████████████████████████████████████████████████████████▍       | 720/787 [00:07&lt;00:00, 95.99it/s]
 93%|██████████████████████████████████████████████████████████████████████████████████▌      | 730/787 [00:07&lt;00:00, 95.40it/s]
 94%|███████████████████████████████████████████████████████████████████████████████████▋     | 740/787 [00:07&lt;00:00, 95.63it/s]
 95%|████████████████████████████████████████████████████████████████████████████████████▊    | 750/787 [00:07&lt;00:00, 96.11it/s]
 97%|█████████████████████████████████████████████████████████████████████████████████████▉   | 760/787 [00:08&lt;00:00, 94.57it/s]
 98%|███████████████████████████████████████████████████████████████████████████████████████  | 770/787 [00:08&lt;00:00, 94.77it/s]
 99%|████████████████████████████████████████████████████████████████████████████████████████▏| 780/787 [00:08&lt;00:00, 95.72it/s]
Models:  60%|██████████████████████████████████████████████████▍                                 | 6/10 [00:49&lt;00:33,  8.31s/it]
  0%|                                                                                                   | 0/787 [00:00&lt;?, ?it/s]
  1%|█▏                                                                                        | 10/787 [00:00&lt;00:08, 93.13it/s]
  3%|██▎                                                                                       | 20/787 [00:00&lt;00:08, 93.59it/s]
  4%|███▍                                                                                      | 30/787 [00:00&lt;00:08, 92.77it/s]
  5%|████▌                                                                                     | 40/787 [00:00&lt;00:08, 93.34it/s]
  6%|█████▋                                                                                    | 50/787 [00:00&lt;00:07, 93.51it/s]
  8%|██████▊                                                                                   | 60/787 [00:00&lt;00:07, 92.94it/s]
  9%|████████                                                                                  | 70/787 [00:00&lt;00:07, 92.62it/s]
 10%|█████████▏                                                                                | 80/787 [00:00&lt;00:07, 93.28it/s]
 11%|██████████▎                                                                               | 90/787 [00:00&lt;00:07, 93.13it/s]
 13%|███████████▎                                                                             | 100/787 [00:01&lt;00:07, 93.51it/s]
 14%|████████████▍                                                                            | 110/787 [00:01&lt;00:07, 93.92it/s]
 15%|█████████████▌                                                                           | 120/787 [00:01&lt;00:07, 93.62it/s]
 17%|██████████████▋                                                                          | 130/787 [00:01&lt;00:07, 93.47it/s]
 18%|███████████████▊                                                                         | 140/787 [00:01&lt;00:06, 93.38it/s]
 19%|████████████████▉                                                                        | 150/787 [00:01&lt;00:06, 93.05it/s]
 20%|██████████████████                                                                       | 160/787 [00:01&lt;00:06, 93.32it/s]
 22%|███████████████████▏                                                                     | 170/787 [00:01&lt;00:06, 93.74it/s]
 23%|████████████████████▎                                                                    | 180/787 [00:01&lt;00:06, 93.66it/s]
 24%|█████████████████████▍                                                                   | 190/787 [00:02&lt;00:06, 93.96it/s]
 25%|██████████████████████▌                                                                  | 200/787 [00:02&lt;00:06, 93.39it/s]
 27%|███████████████████████▋                                                                 | 210/787 [00:02&lt;00:06, 93.26it/s]
 28%|████████████████████████▉                                                                | 220/787 [00:02&lt;00:06, 93.03it/s]
 29%|██████████████████████████                                                               | 230/787 [00:02&lt;00:05, 93.24it/s]
 30%|███████████████████████████▏                                                             | 240/787 [00:02&lt;00:05, 93.17it/s]
 32%|████████████████████████████▎                                                            | 250/787 [00:02&lt;00:05, 93.43it/s]
 33%|█████████████████████████████▍                                                           | 260/787 [00:02&lt;00:05, 93.43it/s]
 34%|██████████████████████████████▌                                                          | 270/787 [00:02&lt;00:05, 93.36it/s]
 36%|███████████████████████████████▋                                                         | 280/787 [00:03&lt;00:05, 93.21it/s]
 37%|████████████████████████████████▊                                                        | 290/787 [00:03&lt;00:05, 93.39it/s]
 38%|█████████████████████████████████▉                                                       | 300/787 [00:03&lt;00:05, 93.64it/s]
 39%|███████████████████████████████████                                                      | 310/787 [00:03&lt;00:05, 94.05it/s]
 41%|████████████████████████████████████▏                                                    | 320/787 [00:03&lt;00:05, 93.20it/s]
 42%|█████████████████████████████████████▎                                                   | 330/787 [00:03&lt;00:04, 93.71it/s]
 43%|██████████████████████████████████████▍                                                  | 340/787 [00:03&lt;00:04, 93.40it/s]
 44%|███████████████████████████████████████▌                                                 | 350/787 [00:03&lt;00:04, 93.14it/s]
 46%|████████████████████████████████████████▋                                                | 360/787 [00:03&lt;00:04, 93.97it/s]
 47%|█████████████████████████████████████████▊                                               | 370/787 [00:03&lt;00:04, 93.90it/s]
 48%|██████████████████████████████████████████▉                                              | 380/787 [00:04&lt;00:04, 93.80it/s]
 50%|████████████████████████████████████████████                                             | 390/787 [00:04&lt;00:04, 93.82it/s]
 51%|█████████████████████████████████████████████▏                                           | 400/787 [00:04&lt;00:04, 93.37it/s]
 52%|██████████████████████████████████████████████▎                                          | 410/787 [00:04&lt;00:04, 93.55it/s]
 53%|███████████████████████████████████████████████▍                                         | 420/787 [00:04&lt;00:03, 93.90it/s]
 55%|████████████████████████████████████████████████▋                                        | 430/787 [00:04&lt;00:03, 93.86it/s]
 56%|█████████████████████████████████████████████████▊                                       | 440/787 [00:04&lt;00:03, 93.59it/s]
 57%|██████████████████████████████████████████████████▉                                      | 450/787 [00:04&lt;00:03, 94.10it/s]
 58%|████████████████████████████████████████████████████                                     | 460/787 [00:04&lt;00:03, 94.19it/s]
 60%|█████████████████████████████████████████████████████▏                                   | 470/787 [00:05&lt;00:03, 93.87it/s]
 61%|██████████████████████████████████████████████████████▎                                  | 480/787 [00:05&lt;00:03, 93.52it/s]
 62%|███████████████████████████████████████████████████████▍                                 | 490/787 [00:05&lt;00:03, 93.59it/s]
 64%|████████████████████████████████████████████████████████▌                                | 500/787 [00:05&lt;00:03, 93.67it/s]
 65%|█████████████████████████████████████████████████████████▋                               | 510/787 [00:05&lt;00:02, 93.69it/s]
 66%|██████████████████████████████████████████████████████████▊                              | 520/787 [00:05&lt;00:02, 92.97it/s]
 67%|███████████████████████████████████████████████████████████▉                             | 530/787 [00:05&lt;00:02, 93.37it/s]
 69%|█████████████████████████████████████████████████████████████                            | 540/787 [00:05&lt;00:02, 93.22it/s]
 70%|██████████████████████████████████████████████████████████████▏                          | 550/787 [00:05&lt;00:02, 93.04it/s]
 71%|███████████████████████████████████████████████████████████████▎                         | 560/787 [00:05&lt;00:02, 93.21it/s]
 72%|████████████████████████████████████████████████████████████████▍                        | 570/787 [00:06&lt;00:02, 93.26it/s]
 74%|█████████████████████████████████████████████████████████████████▌                       | 580/787 [00:06&lt;00:02, 93.25it/s]
 75%|██████████████████████████████████████████████████████████████████▋                      | 590/787 [00:06&lt;00:02, 93.23it/s]
 76%|███████████████████████████████████████████████████████████████████▊                     | 600/787 [00:06&lt;00:02, 93.18it/s]
 78%|████████████████████████████████████████████████████████████████████▉                    | 610/787 [00:06&lt;00:01, 93.31it/s]
 79%|██████████████████████████████████████████████████████████████████████                   | 620/787 [00:06&lt;00:01, 93.31it/s]
 80%|███████████████████████████████████████████████████████████████████████▏                 | 630/787 [00:06&lt;00:01, 93.09it/s]
 81%|████████████████████████████████████████████████████████████████████████▍                | 640/787 [00:06&lt;00:01, 92.98it/s]
 83%|█████████████████████████████████████████████████████████████████████████▌               | 650/787 [00:06&lt;00:01, 93.35it/s]
 84%|██████████████████████████████████████████████████████████████████████████▋              | 660/787 [00:07&lt;00:01, 93.07it/s]
 85%|███████████████████████████████████████████████████████████████████████████▊             | 670/787 [00:07&lt;00:01, 93.64it/s]
 86%|████████████████████████████████████████████████████████████████████████████▉            | 680/787 [00:07&lt;00:01, 93.55it/s]
 88%|██████████████████████████████████████████████████████████████████████████████           | 690/787 [00:07&lt;00:01, 92.76it/s]
 89%|███████████████████████████████████████████████████████████████████████████████▏         | 700/787 [00:07&lt;00:00, 92.87it/s]
 90%|████████████████████████████████████████████████████████████████████████████████▎        | 710/787 [00:07&lt;00:00, 92.73it/s]
 91%|█████████████████████████████████████████████████████████████████████████████████▍       | 720/787 [00:07&lt;00:00, 93.24it/s]
 93%|██████████████████████████████████████████████████████████████████████████████████▌      | 730/787 [00:07&lt;00:00, 93.06it/s]
 94%|███████████████████████████████████████████████████████████████████████████████████▋     | 740/787 [00:07&lt;00:00, 93.10it/s]
 95%|████████████████████████████████████████████████████████████████████████████████████▊    | 750/787 [00:08&lt;00:00, 92.90it/s]
 97%|█████████████████████████████████████████████████████████████████████████████████████▉   | 760/787 [00:08&lt;00:00, 92.70it/s]
 98%|███████████████████████████████████████████████████████████████████████████████████████  | 770/787 [00:08&lt;00:00, 92.62it/s]
 99%|████████████████████████████████████████████████████████████████████████████████████████▏| 780/787 [00:08&lt;00:00, 92.93it/s]
Models:  70%|██████████████████████████████████████████████████████████▊                         | 7/10 [00:57&lt;00:25,  8.35s/it]
  0%|                                                                                                   | 0/787 [00:00&lt;?, ?it/s]
  1%|█▏                                                                                        | 10/787 [00:00&lt;00:08, 91.35it/s]
  3%|██▎                                                                                       | 20/787 [00:00&lt;00:08, 92.58it/s]
  4%|███▍                                                                                      | 30/787 [00:00&lt;00:08, 92.60it/s]
  5%|████▌                                                                                     | 40/787 [00:00&lt;00:08, 90.84it/s]
  6%|█████▋                                                                                    | 50/787 [00:00&lt;00:08, 89.92it/s]
  8%|██████▊                                                                                   | 60/787 [00:00&lt;00:07, 91.35it/s]
  9%|████████                                                                                  | 70/787 [00:00&lt;00:07, 91.68it/s]
 10%|█████████▏                                                                                | 80/787 [00:00&lt;00:07, 91.45it/s]
 11%|██████████▎                                                                               | 90/787 [00:00&lt;00:07, 91.62it/s]
 13%|███████████▎                                                                             | 100/787 [00:01&lt;00:07, 92.35it/s]
 14%|████████████▍                                                                            | 110/787 [00:01&lt;00:07, 91.78it/s]
 15%|█████████████▌                                                                           | 120/787 [00:01&lt;00:07, 91.41it/s]
 17%|██████████████▋                                                                          | 130/787 [00:01&lt;00:07, 91.11it/s]
 18%|███████████████▊                                                                         | 140/787 [00:01&lt;00:07, 91.45it/s]
 19%|████████████████▉                                                                        | 150/787 [00:01&lt;00:06, 92.10it/s]
 20%|██████████████████                                                                       | 160/787 [00:01&lt;00:06, 90.71it/s]
 22%|███████████████████▏                                                                     | 170/787 [00:01&lt;00:06, 90.52it/s]
 23%|████████████████████▎                                                                    | 180/787 [00:01&lt;00:06, 90.31it/s]
 24%|█████████████████████▍                                                                   | 190/787 [00:02&lt;00:06, 91.25it/s]
 25%|██████████████████████▌                                                                  | 200/787 [00:02&lt;00:06, 90.47it/s]
 27%|███████████████████████▋                                                                 | 210/787 [00:02&lt;00:06, 90.01it/s]
 28%|████████████████████████▉                                                                | 220/787 [00:02&lt;00:06, 89.11it/s]
 29%|█████████████████████████▉                                                               | 229/787 [00:02&lt;00:06, 88.89it/s]
 30%|███████████████████████████                                                              | 239/787 [00:02&lt;00:06, 90.23it/s]
 32%|████████████████████████████▏                                                            | 249/787 [00:02&lt;00:05, 91.09it/s]
 33%|█████████████████████████████▎                                                           | 259/787 [00:02&lt;00:05, 91.50it/s]
 34%|██████████████████████████████▍                                                          | 269/787 [00:02&lt;00:05, 91.11it/s]
 35%|███████████████████████████████▌                                                         | 279/787 [00:03&lt;00:05, 92.89it/s]
 37%|████████████████████████████████▋                                                        | 289/787 [00:03&lt;00:05, 93.23it/s]
 38%|█████████████████████████████████▊                                                       | 299/787 [00:03&lt;00:05, 92.92it/s]
 39%|██████████████████████████████████▉                                                      | 309/787 [00:03&lt;00:05, 93.86it/s]
 41%|████████████████████████████████████                                                     | 319/787 [00:03&lt;00:05, 91.72it/s]
 42%|█████████████████████████████████████▏                                                   | 329/787 [00:03&lt;00:05, 91.55it/s]
 43%|██████████████████████████████████████▎                                                  | 339/787 [00:03&lt;00:04, 92.02it/s]
 44%|███████████████████████████████████████▍                                                 | 349/787 [00:03&lt;00:04, 91.31it/s]
 46%|████████████████████████████████████████▌                                                | 359/787 [00:03&lt;00:04, 91.09it/s]
 47%|█████████████████████████████████████████▋                                               | 369/787 [00:04&lt;00:04, 91.37it/s]
 48%|██████████████████████████████████████████▊                                              | 379/787 [00:04&lt;00:04, 90.73it/s]
 49%|███████████████████████████████████████████▉                                             | 389/787 [00:04&lt;00:04, 90.75it/s]
 51%|█████████████████████████████████████████████                                            | 399/787 [00:04&lt;00:04, 91.19it/s]
 52%|██████████████████████████████████████████████▎                                          | 409/787 [00:04&lt;00:04, 90.89it/s]
 53%|███████████████████████████████████████████████▍                                         | 419/787 [00:04&lt;00:04, 90.87it/s]
 55%|████████████████████████████████████████████████▌                                        | 429/787 [00:04&lt;00:03, 90.96it/s]
 56%|█████████████████████████████████████████████████▋                                       | 439/787 [00:04&lt;00:03, 91.10it/s]
 57%|██████████████████████████████████████████████████▊                                      | 449/787 [00:04&lt;00:03, 90.37it/s]
 58%|███████████████████████████████████████████████████▉                                     | 459/787 [00:05&lt;00:03, 88.98it/s]
 59%|████████████████████████████████████████████████████▉                                    | 468/787 [00:05&lt;00:03, 88.23it/s]
 61%|█████████████████████████████████████████████████████▉                                   | 477/787 [00:05&lt;00:03, 88.68it/s]
 62%|███████████████████████████████████████████████████████                                  | 487/787 [00:05&lt;00:03, 89.53it/s]
 63%|████████████████████████████████████████████████████████                                 | 496/787 [00:05&lt;00:03, 89.11it/s]
 64%|█████████████████████████████████████████████████████████▏                               | 506/787 [00:05&lt;00:03, 89.80it/s]
 66%|██████████████████████████████████████████████████████████▎                              | 516/787 [00:05&lt;00:03, 89.99it/s]
 67%|███████████████████████████████████████████████████████████▍                             | 526/787 [00:05&lt;00:02, 90.59it/s]
 68%|████████████████████████████████████████████████████████████▌                            | 536/787 [00:05&lt;00:02, 90.42it/s]
 69%|█████████████████████████████████████████████████████████████▋                           | 546/787 [00:06&lt;00:02, 89.95it/s]
 71%|██████████████████████████████████████████████████████████████▊                          | 555/787 [00:06&lt;00:02, 89.75it/s]
 72%|███████████████████████████████████████████████████████████████▉                         | 565/787 [00:06&lt;00:02, 90.57it/s]
 73%|█████████████████████████████████████████████████████████████████                        | 575/787 [00:06&lt;00:02, 90.08it/s]
 74%|██████████████████████████████████████████████████████████████████▏                      | 585/787 [00:06&lt;00:02, 90.08it/s]
 76%|███████████████████████████████████████████████████████████████████▎                     | 595/787 [00:06&lt;00:02, 89.84it/s]
 77%|████████████████████████████████████████████████████████████████████▍                    | 605/787 [00:06&lt;00:02, 90.28it/s]
 78%|█████████████████████████████████████████████████████████████████████▌                   | 615/787 [00:06&lt;00:01, 89.82it/s]
 79%|██████████████████████████████████████████████████████████████████████▌                  | 624/787 [00:06&lt;00:01, 89.36it/s]
 81%|███████████████████████████████████████████████████████████████████████▋                 | 634/787 [00:06&lt;00:01, 89.51it/s]
 82%|████████████████████████████████████████████████████████████████████████▋                | 643/787 [00:07&lt;00:01, 88.54it/s]
 83%|█████████████████████████████████████████████████████████████████████████▊               | 653/787 [00:07&lt;00:01, 90.68it/s]
 84%|██████████████████████████████████████████████████████████████████████████▉              | 663/787 [00:07&lt;00:01, 90.47it/s]
 86%|████████████████████████████████████████████████████████████████████████████             | 673/787 [00:07&lt;00:01, 90.55it/s]
 87%|█████████████████████████████████████████████████████████████████████████████▏           | 683/787 [00:07&lt;00:01, 91.04it/s]
 88%|██████████████████████████████████████████████████████████████████████████████▎          | 693/787 [00:07&lt;00:01, 92.91it/s]
 89%|███████████████████████████████████████████████████████████████████████████████▌         | 703/787 [00:07&lt;00:00, 93.24it/s]
 91%|████████████████████████████████████████████████████████████████████████████████▋        | 713/787 [00:07&lt;00:00, 93.12it/s]
 92%|█████████████████████████████████████████████████████████████████████████████████▊       | 723/787 [00:07&lt;00:00, 92.27it/s]
 93%|██████████████████████████████████████████████████████████████████████████████████▉      | 733/787 [00:08&lt;00:00, 92.57it/s]
 94%|████████████████████████████████████████████████████████████████████████████████████     | 743/787 [00:08&lt;00:00, 92.21it/s]
 96%|█████████████████████████████████████████████████████████████████████████████████████▏   | 753/787 [00:08&lt;00:00, 93.03it/s]
 97%|██████████████████████████████████████████████████████████████████████████████████████▎  | 763/787 [00:08&lt;00:00, 93.32it/s]
 98%|███████████████████████████████████████████████████████████████████████████████████████▍ | 773/787 [00:08&lt;00:00, 93.24it/s]
 99%|████████████████████████████████████████████████████████████████████████████████████████▌| 783/787 [00:08&lt;00:00, 92.74it/s]
Models:  80%|███████████████████████████████████████████████████████████████████▏                | 8/10 [01:06&lt;00:16,  8.45s/it]
  0%|                                                                                                   | 0/787 [00:00&lt;?, ?it/s]
  1%|█▏                                                                                       | 11/787 [00:00&lt;00:07, 103.03it/s]
  3%|██▍                                                                                      | 22/787 [00:00&lt;00:07, 102.16it/s]
  4%|███▋                                                                                     | 33/787 [00:00&lt;00:07, 101.71it/s]
  6%|█████                                                                                     | 44/787 [00:00&lt;00:07, 99.48it/s]
  7%|██████▏                                                                                   | 54/787 [00:00&lt;00:07, 98.90it/s]
  8%|███████▎                                                                                  | 64/787 [00:00&lt;00:07, 99.17it/s]
  9%|████████▍                                                                                 | 74/787 [00:00&lt;00:07, 98.86it/s]
 11%|█████████▋                                                                                | 85/787 [00:00&lt;00:07, 99.10it/s]
 12%|██████████▊                                                                               | 95/787 [00:00&lt;00:06, 98.97it/s]
 13%|███████████▉                                                                             | 106/787 [00:01&lt;00:06, 98.81it/s]
 15%|█████████████▏                                                                           | 117/787 [00:01&lt;00:06, 98.97it/s]
 16%|██████████████▎                                                                          | 127/787 [00:01&lt;00:06, 98.93it/s]
 17%|███████████████▍                                                                         | 137/787 [00:01&lt;00:06, 99.14it/s]
 19%|████████████████▌                                                                        | 147/787 [00:01&lt;00:06, 98.85it/s]
 20%|█████████████████▊                                                                       | 158/787 [00:01&lt;00:06, 99.81it/s]
 21%|██████████████████▉                                                                      | 168/787 [00:01&lt;00:06, 98.12it/s]
 23%|████████████████████▏                                                                    | 178/787 [00:01&lt;00:06, 98.50it/s]
 24%|█████████████████████▎                                                                   | 188/787 [00:01&lt;00:06, 97.68it/s]
 25%|██████████████████████▍                                                                  | 198/787 [00:02&lt;00:06, 97.89it/s]
 26%|███████████████████████▌                                                                 | 208/787 [00:02&lt;00:05, 98.15it/s]
 28%|████████████████████████▋                                                                | 218/787 [00:02&lt;00:05, 97.92it/s]
 29%|█████████████████████████▊                                                               | 228/787 [00:02&lt;00:05, 98.23it/s]
 30%|██████████████████████████▉                                                              | 238/787 [00:02&lt;00:05, 98.35it/s]
 32%|████████████████████████████                                                             | 248/787 [00:02&lt;00:05, 97.56it/s]
 33%|█████████████████████████████▎                                                           | 259/787 [00:02&lt;00:05, 99.01it/s]
 34%|██████████████████████████████▍                                                          | 269/787 [00:02&lt;00:05, 99.12it/s]
 36%|███████████████████████████████▎                                                        | 280/787 [00:02&lt;00:05, 100.24it/s]
 37%|████████████████████████████████▌                                                       | 291/787 [00:02&lt;00:04, 101.24it/s]
 38%|██████████████████████████████████▏                                                      | 302/787 [00:03&lt;00:04, 99.89it/s]
 40%|███████████████████████████████████▎                                                     | 312/787 [00:03&lt;00:04, 99.49it/s]
 41%|████████████████████████████████████▍                                                    | 322/787 [00:03&lt;00:04, 99.54it/s]
 42%|█████████████████████████████████████▋                                                   | 333/787 [00:03&lt;00:04, 99.89it/s]
 44%|██████████████████████████████████████▍                                                 | 344/787 [00:03&lt;00:04, 101.02it/s]
 45%|███████████████████████████████████████▋                                                | 355/787 [00:03&lt;00:04, 101.48it/s]
 47%|████████████████████████████████████████▉                                               | 366/787 [00:03&lt;00:04, 101.79it/s]
 48%|██████████████████████████████████████████▏                                             | 377/787 [00:03&lt;00:04, 101.95it/s]
 49%|███████████████████████████████████████████▍                                            | 388/787 [00:03&lt;00:03, 100.91it/s]
 51%|█████████████████████████████████████████████                                            | 399/787 [00:04&lt;00:03, 99.23it/s]
 52%|██████████████████████████████████████████████▎                                          | 409/787 [00:04&lt;00:03, 97.98it/s]
 53%|███████████████████████████████████████████████▍                                         | 419/787 [00:04&lt;00:03, 98.06it/s]
 55%|████████████████████████████████████████████████▌                                        | 429/787 [00:04&lt;00:03, 98.51it/s]
 56%|█████████████████████████████████████████████████▋                                       | 439/787 [00:04&lt;00:03, 98.85it/s]
 57%|██████████████████████████████████████████████████▎                                     | 450/787 [00:04&lt;00:03, 100.18it/s]
 59%|███████████████████████████████████████████████████▌                                    | 461/787 [00:04&lt;00:03, 100.94it/s]
 60%|████████████████████████████████████████████████████▊                                   | 472/787 [00:04&lt;00:03, 101.63it/s]
 61%|██████████████████████████████████████████████████████                                  | 483/787 [00:04&lt;00:02, 101.90it/s]
 63%|███████████████████████████████████████████████████████▏                                | 494/787 [00:04&lt;00:02, 102.29it/s]
 64%|████████████████████████████████████████████████████████▍                               | 505/787 [00:05&lt;00:02, 102.49it/s]
 66%|█████████████████████████████████████████████████████████▋                              | 516/787 [00:05&lt;00:02, 101.86it/s]
 67%|██████████████████████████████████████████████████████████▉                             | 527/787 [00:05&lt;00:02, 102.08it/s]
 68%|████████████████████████████████████████████████████████████▏                           | 538/787 [00:05&lt;00:02, 102.06it/s]
 70%|█████████████████████████████████████████████████████████████▍                          | 549/787 [00:05&lt;00:02, 102.72it/s]
 71%|██████████████████████████████████████████████████████████████▌                         | 560/787 [00:05&lt;00:02, 102.36it/s]
 73%|███████████████████████████████████████████████████████████████▊                        | 571/787 [00:05&lt;00:02, 101.75it/s]
 74%|█████████████████████████████████████████████████████████████████                       | 582/787 [00:05&lt;00:02, 101.93it/s]
 75%|██████████████████████████████████████████████████████████████████▎                     | 593/787 [00:05&lt;00:01, 102.14it/s]
 77%|███████████████████████████████████████████████████████████████████▌                    | 604/787 [00:06&lt;00:01, 102.55it/s]
 78%|████████████████████████████████████████████████████████████████████▊                   | 615/787 [00:06&lt;00:01, 102.80it/s]
 80%|█████████████████████████████████████████████████████████████████████▉                  | 626/787 [00:06&lt;00:01, 102.61it/s]
 81%|███████████████████████████████████████████████████████████████████████▏                | 637/787 [00:06&lt;00:01, 103.03it/s]
 82%|████████████████████████████████████████████████████████████████████████▍               | 648/787 [00:06&lt;00:01, 101.60it/s]
 84%|█████████████████████████████████████████████████████████████████████████▋              | 659/787 [00:06&lt;00:01, 101.78it/s]
 85%|██████████████████████████████████████████████████████████████████████████▉             | 670/787 [00:06&lt;00:01, 101.86it/s]
 87%|████████████████████████████████████████████████████████████████████████████▏           | 681/787 [00:06&lt;00:01, 100.80it/s]
 88%|█████████████████████████████████████████████████████████████████████████████▍          | 692/787 [00:06&lt;00:00, 101.02it/s]
 89%|██████████████████████████████████████████████████████████████████████████████▌         | 703/787 [00:07&lt;00:00, 100.77it/s]
 91%|███████████████████████████████████████████████████████████████████████████████▊        | 714/787 [00:07&lt;00:00, 100.31it/s]
 92%|█████████████████████████████████████████████████████████████████████████████████       | 725/787 [00:07&lt;00:00, 101.08it/s]
 94%|██████████████████████████████████████████████████████████████████████████████████▎     | 736/787 [00:07&lt;00:00, 101.68it/s]
 95%|███████████████████████████████████████████████████████████████████████████████████▌    | 747/787 [00:07&lt;00:00, 101.24it/s]
 96%|████████████████████████████████████████████████████████████████████████████████████▊   | 758/787 [00:07&lt;00:00, 101.19it/s]
 98%|█████████████████████████████████████████████████████████████████████████████████████▉  | 769/787 [00:07&lt;00:00, 101.00it/s]
 99%|███████████████████████████████████████████████████████████████████████████████████████▏| 780/787 [00:07&lt;00:00, 101.32it/s]
Models:  90%|███████████████████████████████████████████████████████████████████████████▌        | 9/10 [01:14&lt;00:08,  8.26s/it]
  0%|                                                                                                   | 0/787 [00:00&lt;?, ?it/s]
  1%|█▏                                                                                       | 11/787 [00:00&lt;00:07, 101.33it/s]
  3%|██▌                                                                                       | 22/787 [00:00&lt;00:07, 98.58it/s]
  4%|███▊                                                                                      | 33/787 [00:00&lt;00:07, 99.35it/s]
  6%|█████                                                                                     | 44/787 [00:00&lt;00:07, 99.74it/s]
  7%|██████▏                                                                                   | 54/787 [00:00&lt;00:07, 99.39it/s]
  8%|███████▍                                                                                  | 65/787 [00:00&lt;00:07, 99.92it/s]
 10%|████████▌                                                                                 | 75/787 [00:00&lt;00:07, 99.87it/s]
 11%|█████████▋                                                                                | 85/787 [00:00&lt;00:07, 99.28it/s]
 12%|██████████▊                                                                               | 95/787 [00:00&lt;00:06, 98.96it/s]
 13%|███████████▊                                                                            | 106/787 [00:01&lt;00:06, 100.16it/s]
 15%|█████████████▏                                                                           | 117/787 [00:01&lt;00:06, 99.62it/s]
 16%|██████████████▎                                                                          | 127/787 [00:01&lt;00:06, 99.52it/s]
 18%|███████████████▍                                                                        | 138/787 [00:01&lt;00:06, 100.36it/s]
 19%|████████████████▊                                                                        | 149/787 [00:01&lt;00:06, 99.73it/s]
 20%|█████████████████▉                                                                      | 160/787 [00:01&lt;00:06, 100.83it/s]
 22%|███████████████████                                                                     | 171/787 [00:01&lt;00:06, 100.87it/s]
 23%|████████████████████▎                                                                   | 182/787 [00:01&lt;00:05, 101.57it/s]
 25%|█████████████████████▌                                                                  | 193/787 [00:01&lt;00:05, 102.22it/s]
 26%|██████████████████████▊                                                                 | 204/787 [00:02&lt;00:05, 100.79it/s]
 27%|████████████████████████                                                                | 215/787 [00:02&lt;00:05, 101.01it/s]
 29%|█████████████████████████▎                                                              | 226/787 [00:02&lt;00:05, 100.91it/s]
 30%|██████████████████████████▌                                                             | 237/787 [00:02&lt;00:05, 100.93it/s]
 32%|███████████████████████████▋                                                            | 248/787 [00:02&lt;00:05, 100.99it/s]
 33%|████████████████████████████▉                                                           | 259/787 [00:02&lt;00:05, 100.69it/s]
 34%|██████████████████████████████▏                                                         | 270/787 [00:02&lt;00:05, 100.83it/s]
 36%|███████████████████████████████▍                                                        | 281/787 [00:02&lt;00:05, 101.09it/s]
 37%|████████████████████████████████▋                                                       | 292/787 [00:02&lt;00:04, 101.13it/s]
 39%|█████████████████████████████████▉                                                      | 303/787 [00:03&lt;00:04, 101.26it/s]
 40%|███████████████████████████████████                                                     | 314/787 [00:03&lt;00:04, 100.97it/s]
 41%|████████████████████████████████████▎                                                   | 325/787 [00:03&lt;00:04, 101.12it/s]
 43%|█████████████████████████████████████▌                                                  | 336/787 [00:03&lt;00:04, 101.20it/s]
 44%|██████████████████████████████████████▊                                                 | 347/787 [00:03&lt;00:04, 100.75it/s]
 45%|████████████████████████████████████████                                                | 358/787 [00:03&lt;00:04, 100.87it/s]
 47%|█████████████████████████████████████████▎                                              | 369/787 [00:03&lt;00:04, 101.22it/s]
 48%|██████████████████████████████████████████▍                                             | 380/787 [00:03&lt;00:04, 101.45it/s]
 50%|███████████████████████████████████████████▋                                            | 391/787 [00:03&lt;00:03, 101.26it/s]
 51%|████████████████████████████████████████████▉                                           | 402/787 [00:03&lt;00:03, 100.31it/s]
 52%|██████████████████████████████████████████████▏                                         | 413/787 [00:04&lt;00:03, 100.52it/s]
 54%|███████████████████████████████████████████████▍                                        | 424/787 [00:04&lt;00:03, 100.66it/s]
 55%|████████████████████████████████████████████████▋                                       | 435/787 [00:04&lt;00:03, 100.13it/s]
 57%|█████████████████████████████████████████████████▊                                      | 446/787 [00:04&lt;00:03, 100.49it/s]
 58%|███████████████████████████████████████████████████                                     | 457/787 [00:04&lt;00:03, 100.56it/s]
 59%|████████████████████████████████████████████████████▎                                   | 468/787 [00:04&lt;00:03, 101.56it/s]
 61%|█████████████████████████████████████████████████████▌                                  | 479/787 [00:04&lt;00:03, 101.81it/s]
 62%|██████████████████████████████████████████████████████▊                                 | 490/787 [00:04&lt;00:02, 102.11it/s]
 64%|████████████████████████████████████████████████████████                                | 501/787 [00:04&lt;00:02, 102.55it/s]
 65%|█████████████████████████████████████████████████████████▎                              | 512/787 [00:05&lt;00:02, 102.36it/s]
 66%|██████████████████████████████████████████████████████████▍                             | 523/787 [00:05&lt;00:02, 101.92it/s]
 68%|███████████████████████████████████████████████████████████▋                            | 534/787 [00:05&lt;00:02, 101.89it/s]
 69%|████████████████████████████████████████████████████████████▉                           | 545/787 [00:05&lt;00:02, 100.48it/s]
 71%|██████████████████████████████████████████████████████████████▏                         | 556/787 [00:05&lt;00:02, 100.42it/s]
 72%|███████████████████████████████████████████████████████████████▍                        | 567/787 [00:05&lt;00:02, 100.42it/s]
 73%|████████████████████████████████████████████████████████████████▋                       | 578/787 [00:05&lt;00:02, 101.11it/s]
 75%|█████████████████████████████████████████████████████████████████▊                      | 589/787 [00:05&lt;00:01, 101.21it/s]
 76%|███████████████████████████████████████████████████████████████████                     | 600/787 [00:05&lt;00:01, 101.46it/s]
 78%|████████████████████████████████████████████████████████████████████▎                   | 611/787 [00:06&lt;00:01, 101.61it/s]
 79%|█████████████████████████████████████████████████████████████████████▌                  | 622/787 [00:06&lt;00:01, 101.20it/s]
 80%|██████████████████████████████████████████████████████████████████████▊                 | 633/787 [00:06&lt;00:01, 101.45it/s]
 82%|████████████████████████████████████████████████████████████████████████                | 644/787 [00:06&lt;00:01, 101.04it/s]
 83%|█████████████████████████████████████████████████████████████████████████▏              | 655/787 [00:06&lt;00:01, 100.48it/s]
 85%|██████████████████████████████████████████████████████████████████████████▍             | 666/787 [00:06&lt;00:01, 100.09it/s]
 86%|████████████████████████████████████████████████████████████████████████████▌            | 677/787 [00:06&lt;00:01, 99.28it/s]
 87%|█████████████████████████████████████████████████████████████████████████████▋           | 687/787 [00:06&lt;00:01, 99.38it/s]
 89%|██████████████████████████████████████████████████████████████████████████████▊          | 697/787 [00:06&lt;00:00, 98.40it/s]
 90%|████████████████████████████████████████████████████████████████████████████████         | 708/787 [00:07&lt;00:00, 98.88it/s]
 91%|█████████████████████████████████████████████████████████████████████████████████▎       | 719/787 [00:07&lt;00:00, 99.74it/s]
 93%|█████████████████████████████████████████████████████████████████████████████████▋      | 730/787 [00:07&lt;00:00, 100.00it/s]
 94%|██████████████████████████████████████████████████████████████████████████████████▊     | 741/787 [00:07&lt;00:00, 100.12it/s]
 96%|████████████████████████████████████████████████████████████████████████████████████    | 752/787 [00:07&lt;00:00, 100.81it/s]
 97%|█████████████████████████████████████████████████████████████████████████████████████▎  | 763/787 [00:07&lt;00:00, 100.51it/s]
 98%|██████████████████████████████████████████████████████████████████████████████████████▌ | 774/787 [00:07&lt;00:00, 101.53it/s]
100%|███████████████████████████████████████████████████████████████████████████████████████▊| 785/787 [00:07&lt;00:00, 101.15it/s]
Models: 100%|███████████████████████████████████████████████████████████████████████████████████| 10/10 [01:22&lt;00:00,  8.20s/it]
INFO:root:Finished fitting 10 models to 787 genes
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--- 148.496 seconds ---
iter 0, ELBO: -6.59e+04
iter 1, ELBO: -6.78e+06, delta_ELBO: 6.71e+06
iter 2, ELBO: -7.51e+06, delta_ELBO: 7.29e+05
iter 3, ELBO: -7.76e+06, delta_ELBO: 2.49e+05
iter 4, ELBO: -7.80e+06, delta_ELBO: 3.80e+04
iter 5, ELBO: -7.81e+06, delta_ELBO: 1.60e+04
iter 6, ELBO: -7.82e+06, delta_ELBO: 4.52e+03
iter 7, ELBO: -7.82e+06, delta_ELBO: 5.16e+01
iter 8, ELBO: -7.82e+06, delta_ELBO: 5.90e+03
iter 9, ELBO: -7.83e+06, delta_ELBO: 1.82e+03
iter 10, ELBO: -7.83e+06, delta_ELBO: 2.01e+03
iter 11, ELBO: -7.83e+06, delta_ELBO: 7.84e+02
iter 12, ELBO: -7.83e+06, delta_ELBO: 4.95e+01
iter 13, ELBO: -7.83e+06, delta_ELBO: 6.89e+01
iter 14, ELBO: -7.83e+06, delta_ELBO: 8.54e-03
Converged on iter 14
--- 2134.364 seconds ---
</pre></div></div>
</div>
<div class="admonition note">
<div class="line-block">
<div class="line"><strong>Note</strong> The spot-level adata <code class="docutils literal notranslate"><span class="pre">patient1_adata_all.h5ad</span></code> (4x resolution) can be clustered using <code class="docutils literal notranslate"><span class="pre">spatialDM</span></code>, but it will cost too much time (about 40 mins).</div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">patient1_adata_all.h5ad</span></code> with 5039 samples and 596 features.</div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">SpatialDE.run</span></code>, cost 148.496 seconds.</div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">SpatialDE.aeh.spatial_patterns</span></code>, cost 2134.364 seconds, the details like the next cell.</div>
</div>
</div>
<p>— 148.496 seconds — iter 0, ELBO: -6.59e+04 iter 1, ELBO: -6.78e+06, delta_ELBO: 6.71e+06 iter 2, ELBO: -7.51e+06, delta_ELBO: 7.29e+05 iter 3, ELBO: -7.76e+06, delta_ELBO: 2.49e+05 iter 4, ELBO: -7.80e+06, delta_ELBO: 3.80e+04 iter 5, ELBO: -7.81e+06, delta_ELBO: 1.60e+04 iter 6, ELBO: -7.82e+06, delta_ELBO: 4.52e+03 iter 7, ELBO: -7.82e+06, delta_ELBO: 5.16e+01 iter 8, ELBO: -7.82e+06, delta_ELBO: 5.90e+03 iter 9, ELBO: -7.83e+06, delta_ELBO: 1.82e+03 iter 10, ELBO: -7.83e+06, delta_ELBO:
2.01e+03 iter 11, ELBO: -7.83e+06, delta_ELBO: 7.84e+02 iter 12, ELBO: -7.83e+06, delta_ELBO: 4.95e+01 iter 13, ELBO: -7.83e+06, delta_ELBO: 6.89e+01 iter 14, ELBO: -7.83e+06, delta_ELBO: 8.54e-03 Converged on iter 14 — 2134.364 seconds —</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[145]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fst</span><span class="o">.</span><span class="n">spatialDE_clusters</span><span class="p">(</span><span class="n">histology_results</span><span class="p">,</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">adata_impt_all_spot</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;spatial&#39;</span><span class="p">],</span>
                       <span class="n">w</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_60_0.png" src="_images/NPC_LRI_CCC_60_0.png" />
</div>
</div>
<p>2.7 save the adata after SpatialDE</p>
<p>Considering the long run time, we save results <code class="docutils literal notranslate"><span class="pre">histology_results</span></code> and <code class="docutils literal notranslate"><span class="pre">patterns</span></code> for further pathway enrichment analysis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># os.chdir(str(path)+&#39;FineST/FineST_local/Dataset/ImputData/&#39;+str(patientxy)+&#39;/&#39;)</span>
<span class="c1"># histology_results.to_csv(&#39;histology_results_subspot.csv&#39;, index=False)</span>
<span class="c1"># patterns.to_csv(&#39;patterns_subspot.csv&#39;, index=False)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># os.chdir(str(path)+&#39;FineST/FineST_local/Dataset/ImputData/&#39;+str(patientxy)+&#39;/&#39;)</span>
<span class="c1"># patientxy = &#39;patient1&#39;</span>
<span class="c1"># adata_impt_all_spot_save = fst.clean_save_adata(adata_impt_all_spot, str(patientxy)+&#39;_adata_pattern_subspot.h5ad&#39;)</span>
<span class="c1"># print(adata_impt_all_spot_save)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AnnData object with n_obs × n_vars = 5039 × 596
    obs: &#39;x&#39;, &#39;y&#39;
    uns: &#39;ligand&#39;, &#39;receptor&#39;, &#39;geneInter&#39;, &#39;local_stat&#39;, &#39;local_z_p&#39;
    obsm: &#39;spatial&#39;
    obsp: &#39;weight&#39;, &#39;nearest_neighbors&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">adata_impt_all_spot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AnnData object with n_obs × n_vars = 5039 × 596
    obs: &#39;x&#39;, &#39;y&#39;
    uns: &#39;single_cell&#39;, &#39;mean&#39;, &#39;ligand&#39;, &#39;receptor&#39;, &#39;num_pairs&#39;, &#39;geneInter&#39;, &#39;global_I&#39;, &#39;global_stat&#39;, &#39;global_res&#39;, &#39;local_stat&#39;, &#39;local_z&#39;, &#39;local_z_p&#39;, &#39;selected_spots&#39;
    obsm: &#39;spatial&#39;
    obsp: &#39;weight&#39;, &#39;nearest_neighbors&#39;
</pre></div></div>
</div>
<div class="admonition note">
<p><strong>Note</strong> When saving the results after global and local Moran’s R significant analysis, some items in <code class="docutils literal notranslate"><span class="pre">.uns[&quot;&quot;]</span></code> can not be saved. Here, <code class="docutils literal notranslate"><span class="pre">FineST</span></code> gives the <code class="docutils literal notranslate"><span class="pre">fst.clean_save_adata</span></code> function save, with 5 items, <code class="docutils literal notranslate"><span class="pre">ligand</span></code>, <code class="docutils literal notranslate"><span class="pre">receptor</span></code>, <code class="docutils literal notranslate"><span class="pre">geneInter</span></code>, <code class="docutils literal notranslate"><span class="pre">local_stat</span></code> and <code class="docutils literal notranslate"><span class="pre">local_z_p</span></code>, in <code class="docutils literal notranslate"><span class="pre">.pickle</span></code> form. Thus the <code class="docutils literal notranslate"><span class="pre">.adata</span></code> and <code class="docutils literal notranslate"><span class="pre">.pickle</span></code> files are saved in the same file. When Load the <code class="docutils literal notranslate"><span class="pre">.adata</span></code> file, it needs to add the <code class="docutils literal notranslate"><span class="pre">.pickle</span></code> items, using the <code class="docutils literal notranslate"><span class="pre">fst.Load_clean_save_adata</span></code> function.
- save .adata file: <code class="docutils literal notranslate"><span class="pre">fst.clean_save_adata(adata,</span> <span class="pre">'adata_test.h5ad')</span></code>
- load .adata file: first<code class="docutils literal notranslate"><span class="pre">adata_test=sc.read_h5ad('adata_test.h5ad')</span></code> and then <code class="docutils literal notranslate"><span class="pre">adata=fst.Load_clean_save_adata(adata_test)</span></code></p>
</div>
</section>
<section id="3.-Pathway-enrichment-analysis">
<h2>3. Pathway enrichment analysis<a class="headerlink" href="#3.-Pathway-enrichment-analysis" title="Permalink to this heading"></a></h2>
<p>3.1 Load saved data</p>
<p>If you doesn’t saved the above <code class="docutils literal notranslate"><span class="pre">.adata</span></code> file, you can skip this <code class="docutils literal notranslate"><span class="pre">section</span> <span class="pre">3.1</span></code>, directly run <code class="docutils literal notranslate"><span class="pre">section</span> <span class="pre">3.2</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[146]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Load saved adata</span>
<span class="c1"># patientxy = &#39;patient1&#39;</span>
<span class="c1"># os.chdir(str(path)+&#39;FineST/FineST_local/Dataset/ImputData/&#39;+str(patientxy)+&#39;/&#39;)</span>
<span class="c1"># adata_impt_all_spot = sc.read_h5ad(filename=str(patientxy)+&#39;_adata_pattern_subspot.h5ad&#39;)</span>
<span class="c1"># adata_impt_all_spot = fst.Load_clean_save_adata(adata_impt_all_spot)</span>
<span class="c1"># print(adata_impt_all_spot)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[147]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># os.chdir(str(path)+&#39;FineST/FineST_local/Dataset/ImputData/&#39;+str(patientxy)+&#39;/&#39;)</span>
<span class="c1"># patterns_test = pd.read_csv(&#39;patterns_subspot.csv&#39;)</span>
<span class="c1"># histology_results = pd.read_csv(&#39;histology_results_subspot.csv&#39;)</span>
<span class="c1"># dic=dict()</span>
<span class="c1"># for i in histology_results.sort_values(&#39;pattern&#39;).pattern.unique():</span>
<span class="c1">#     dic[&#39;Pattern_{}&#39;.format(i)]=histology_results.query(&#39;pattern == @i&#39;).sort_values(&#39;membership&#39;)[&#39;g&#39;].values</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[148]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fst.spatialDE_clusters(histology_results, patterns, adata_impt_all_spot.obsm[&#39;spatial&#39;],</span>
<span class="c1">#                        w=3, s=5, save_path=None)</span>
</pre></div>
</div>
</div>
<p>3.2 For 4x resolution data</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dic</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">histology_results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;pattern&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;Pattern_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="n">histology_results</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;pattern == @i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;membership&#39;</span><span class="p">)[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## run code</span>
<span class="p">(</span><span class="n">result</span><span class="p">,</span>
 <span class="n">pathway_res</span><span class="p">,</span>
 <span class="n">result_select</span><span class="p">,</span>
 <span class="n">result_pattern_all</span><span class="p">)</span> <span class="o">=</span> <span class="n">fst</span><span class="o">.</span><span class="n">pathway_analysis</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="n">adata_impt_all</span><span class="p">,</span>
                                            <span class="n">all_interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">interaction_ls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Pattern_0&quot;</span><span class="p">],</span>
                                            <span class="n">cut_off</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="n">dic</span><span class="o">=</span><span class="n">dic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(438, 5)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fisher_p</th>
      <th>pathway_size</th>
      <th>selected</th>
      <th>selected_inters</th>
      <th>name</th>
    </tr>
    <tr>
      <th>1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ACTIVIN</th>
      <td>0.001456</td>
      <td>12</td>
      <td>10</td>
      <td>{INHB_ACVR1C_ACVR2B, INHBB_ACVR1B_ACVR2B, INHB...</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>ADGRE5</th>
      <td>1.000000</td>
      <td>1</td>
      <td>0</td>
      <td>{}</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>AGRN</th>
      <td>0.373782</td>
      <td>1</td>
      <td>1</td>
      <td>{AGRN_DAG1}</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>ALCAM</th>
      <td>1.000000</td>
      <td>1</td>
      <td>0</td>
      <td>{}</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>AMH</th>
      <td>0.608059</td>
      <td>2</td>
      <td>1</td>
      <td>{AMH_AMHR2_ACVR1}</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>VTN</th>
      <td>0.643363</td>
      <td>5</td>
      <td>1</td>
      <td>{VTN_ITGA8_ITGB1}</td>
      <td>Pattern_2</td>
    </tr>
    <tr>
      <th>VWF</th>
      <td>1.000000</td>
      <td>2</td>
      <td>0</td>
      <td>{}</td>
      <td>Pattern_2</td>
    </tr>
    <tr>
      <th>WNT</th>
      <td>1.000000</td>
      <td>160</td>
      <td>6</td>
      <td>{WNT3A_FZD3_LRP5, WNT3A_FZD2_LRP5, WNT10B_FZD4...</td>
      <td>Pattern_2</td>
    </tr>
    <tr>
      <th>XCR</th>
      <td>1.000000</td>
      <td>2</td>
      <td>0</td>
      <td>{}</td>
      <td>Pattern_2</td>
    </tr>
    <tr>
      <th>ncWNT</th>
      <td>0.894981</td>
      <td>19</td>
      <td>2</td>
      <td>{WNT5B_FZD2, WNT5B_FZD3}</td>
      <td>Pattern_2</td>
    </tr>
  </tbody>
</table>
<p>438 rows × 5 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">result_select</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">result_select</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(69, 5)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fisher_p</th>
      <th>pathway_size</th>
      <th>selected</th>
      <th>selected_inters</th>
      <th>name</th>
    </tr>
    <tr>
      <th>1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>WNT</th>
      <td>5.913285e-30</td>
      <td>160</td>
      <td>125</td>
      <td>{WNT7B_FZD5_LRP5, WNT10B_FZD9_LRP5, WNT7B_FZD8...</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>LAMININ</th>
      <td>9.522834e-01</td>
      <td>143</td>
      <td>45</td>
      <td>{LAMA3_ITGA2_ITGB1, LAMC2_ITGA6_ITGB1, LAMC2_I...</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>SEMA3</th>
      <td>5.213823e-04</td>
      <td>39</td>
      <td>25</td>
      <td>{SEMA3D_NRP2_PLXNA3, SEMA3D_NRP2_PLXNA2, SEMA3...</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>BMP</th>
      <td>9.133332e-01</td>
      <td>54</td>
      <td>16</td>
      <td>{BMP8A_BMPR1A_BMPR2, BMP6_BMPR1A_BMPR2, BMP6_B...</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>EPHB</th>
      <td>3.487620e-06</td>
      <td>16</td>
      <td>15</td>
      <td>{EFNB1_EPHB1, EFNB1_EPHB2, EFNB1_EPHB3, EFNB3_...</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>APP</th>
      <td>3.737821e-01</td>
      <td>1</td>
      <td>1</td>
      <td>{APP_CD74}</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>LIGHT</th>
      <td>6.080587e-01</td>
      <td>2</td>
      <td>1</td>
      <td>{TNFSF14_LTBR}</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>MHC-II</th>
      <td>9.943604e-01</td>
      <td>11</td>
      <td>1</td>
      <td>{HLA-DRA_CD4}</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>MPZ</th>
      <td>3.737821e-01</td>
      <td>1</td>
      <td>1</td>
      <td>{MPZL1_MPZL1}</td>
      <td>Pattern_0</td>
    </tr>
    <tr>
      <th>IL6</th>
      <td>6.080587e-01</td>
      <td>2</td>
      <td>1</td>
      <td>{IL6_IL6R_IL6ST}</td>
      <td>Pattern_0</td>
    </tr>
  </tbody>
</table>
<p>69 rows × 5 columns</p>
</div></div>
</div>
<p>Confusion matrix heatmap of <code class="docutils literal notranslate"><span class="pre">WNT</span></code> in <code class="docutils literal notranslate"><span class="pre">Pattern0</span></code>, using <code class="docutils literal notranslate"><span class="pre">save_path='WNT_Pattern0.pdf'</span></code> to save it to PDF file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[83]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fst</span><span class="o">.</span><span class="n">plot_conf_mat</span><span class="p">(</span><span class="n">result_pattern_all</span><span class="p">,</span> <span class="n">pattern_name</span><span class="o">=</span><span class="s1">&#39;Pattern_0&#39;</span><span class="p">,</span> <span class="n">pathway_name</span><span class="o">=</span><span class="s1">&#39;WNT&#39;</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="c1"># plot_conf_mat(result_pattern_all, pattern_name=&#39;Pattern_0&#39;, pathway_name=&#39;WNT&#39;, save_path=&#39;WNT_Pattern0.pdf&#39;)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_79_0.png" src="_images/NPC_LRI_CCC_79_0.png" />
</div>
</div>
<p>Dot_path of all pathways in selected Pattern, using <code class="docutils literal notranslate"><span class="pre">pdf='mel_DE_enrichment_p0_spot'</span></code> to save it to PDF file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fst</span><span class="o">.</span><span class="n">dot_path</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">,</span> <span class="n">dic</span><span class="o">=</span><span class="n">dic</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_81_0.png" src="_images/NPC_LRI_CCC_81_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_81_1.png" src="_images/NPC_LRI_CCC_81_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_81_2.png" src="_images/NPC_LRI_CCC_81_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[89]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fst</span><span class="o">.</span><span class="n">dot_path</span><span class="p">(</span><span class="n">adata_impt_all</span><span class="p">,</span> <span class="n">dic</span><span class="o">=</span><span class="n">dic</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Pattern_0&quot;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1"># fst.dot_path(adata_impt_all, dic=dic, groups=[&quot;Pattern_0&quot;], figsize=(7,20), pdf=&#39;mel_DE_enrichment_p0_spot&#39;)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/NPC_LRI_CCC_82_0.png" src="_images/NPC_LRI_CCC_82_0.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CRC16_Train_Impute.html" class="btn btn-neutral float-left" title="FineST in CRC Visium HD data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Lingyu Li.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>